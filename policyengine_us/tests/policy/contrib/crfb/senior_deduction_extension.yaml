- name: Integration test - senior deduction included in taxable income deductions when itemizing in 2029
  period: 2029
  reforms: policyengine_us.reforms.crfb.senior_deduction_extension.senior_deduction_extension
  input:
    gov.contrib.crfb.senior_deduction_extension.applies: true
    people:
      senior1:
        age: 67
      senior2:
        age: 69
    tax_units:
      tax_unit:
        members: [senior1, senior2]
        filing_status: JOINT
        adjusted_gross_income: 100_000
        tax_unit_itemizes: true
        itemized_taxable_income_deductions: 30_000
        qualified_business_income_deduction: 5_000
        wagering_losses_deduction: 0
    households:
      household:
        members: [senior1, senior2]
        state_code: CA
  output:
    additional_senior_deduction: 12_000
    # Total deductions when itemizing should include:
    # itemized_taxable_income_deductions: 30_000
    # qualified_business_income_deduction: 5_000
    # additional_senior_deduction: 12_000 (from extension)
    taxable_income_deductions_if_itemizing: 47_000

- name: Integration test - senior deduction included in taxable income deductions when not itemizing in 2029
  period: 2029
  reforms: policyengine_us.reforms.crfb.senior_deduction_extension.senior_deduction_extension
  input:
    gov.contrib.crfb.senior_deduction_extension.applies: true
    people:
      senior1:
        age: 67
      senior2:
        age: 69
    tax_units:
      tax_unit:
        members: [senior1, senior2]
        filing_status: JOINT
        adjusted_gross_income: 100_000
        tax_unit_itemizes: false
        qualified_business_income_deduction: 5_000
    households:
      household:
        members: [senior1, senior2]
        state_code: CA
  output:
    additional_senior_deduction: 12_000
    # Total deductions when not itemizing should include:
    # standard_deduction: 38_300 (joint filing in 2029, includes additional standard deduction for seniors)
    # qualified_business_income_deduction: 5_000
    # additional_senior_deduction: 12_000 (from extension)
    taxable_income_deductions_if_not_itemizing: 55_300

- name: Integration test - no senior deduction in 2029 without extension
  period: 2029
  reforms: []
  input:
    people:
      senior1:
        age: 67
      senior2:
        age: 69
    tax_units:
      tax_unit:
        members: [senior1, senior2]
        filing_status: JOINT
        adjusted_gross_income: 100_000
        tax_unit_itemizes: true
        itemized_taxable_income_deductions: 30_000
        qualified_business_income_deduction: 5_000
        wagering_losses_deduction: 0
    households:
      household:
        members: [senior1, senior2]
        state_code: CA
  output:
    additional_senior_deduction: 12_000
    # Without extension, senior deduction is calculated but NOT included in deductions for 2029
    taxable_income_deductions_if_itemizing: 35_000

- name: Integration test - extension continues working in 2035
  period: 2035
  reforms: policyengine_us.reforms.crfb.senior_deduction_extension.senior_deduction_extension
  input:
    gov.contrib.crfb.senior_deduction_extension.applies: true
    people:
      senior:
        age: 70
    tax_units:
      tax_unit:
        members: [senior]
        filing_status: SINGLE
        adjusted_gross_income: 50_000
        tax_unit_itemizes: false
        qualified_business_income_deduction: 2_000
    households:
      household:
        members: [senior]
        state_code: CA
  output:
    additional_senior_deduction: 6_000
    # Total deductions should include:
    # basic_standard_deduction: 19_600 (single filing in 2035)
    # additional_standard_deduction: 2_450 (single senior aged deduction in 2035)
    # qualified_business_income_deduction: 2_000
    # additional_senior_deduction: 6_000 (from extension)
    taxable_income_deductions_if_not_itemizing: 30_050
