- name: Single filer with one dependent in Alabama
  period: 2024
  reforms: policyengine_us.reforms.state_dependent_exemptions.repeal_state_dependent_exemptions.repeal_state_dependent_exemptions
  input:
    gov.contrib.repeal_state_dependent_exemptions.in_effect: true
    people: 
      person1:
        age: 38
      person2:
        age: 5
    tax_units:
      tax_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    al_dependent_exemption: 0

- name: Reform not active
  period: 2024
  input:
    gov.contrib.repeal_state_dependent_exemptions.in_effect: false
    people: 
      person1:
        age: 38
      person2:
        age: 5
    tax_units:
      tax_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    al_dependent_exemption: 1_000

- name: Joint filers with one dependent in Vermont
  period: 2024
  reforms: policyengine_us.reforms.state_dependent_exemptions.repeal_state_dependent_exemptions.repeal_state_dependent_exemptions
  input:
    gov.contrib.repeal_state_dependent_exemptions.in_effect: true
    people: 
      person1:
        age: 38
      person2:
        age: 38
      person3:
        age: 5
    tax_units:
      tax_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: VT
  output:
    vt_personal_exemptions: 10_200

- name: Joint filers with one dependent in Vermont - reform not in effect
  period: 2024
  input:
    gov.contrib.repeal_state_dependent_exemptions.in_effect: false
    people:
      person1:
        age: 38
      person2:
        age: 38
      person3:
        age: 5
    tax_units:
      tax_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: VT
  output:
    vt_personal_exemptions: 15_300

# Test for KY family size tax credit rate - verifies state_group_str is used correctly
# This test ensures state_group is derived from state_code, not set explicitly
- name: Kentucky family size tax credit with reform - state_group derived from state_code
  period: 2024
  reforms: policyengine_us.reforms.state_dependent_exemptions.repeal_state_dependent_exemptions.repeal_state_dependent_exemptions
  input:
    gov.contrib.repeal_state_dependent_exemptions.in_effect: true
    people:
      person1:
        age: 38
        employment_income: 20_000
    tax_units:
      tax_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    # With 20k income vs 15,060 FPG for 1 person in 2024, income/FPG ratio = 132.8%
    # The rate scale: 130% -> 0.1, 133% -> 0
    # Since 132.8% is between 130% and 133%, the rate is 0.1
    ky_family_size_tax_credit_rate: 0.1
