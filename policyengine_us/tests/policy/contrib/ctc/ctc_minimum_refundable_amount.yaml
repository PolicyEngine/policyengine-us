# - name: Reform not active - no minimum refundable amount
#   period: 2024
#   reforms: policyengine_us.reforms.ctc.ctc_minimum_refundable_amount.ctc_minimum_refundable_amount
#   input:
#     gov.contrib.ctc.minimum_refundable.in_effect: false
#     age: 8
#     ctc_qualifying_child: true
#   output:
#     ctc_minimum_refundable_amount: 0

# - name: Child under 6 with minimum amount
#   period: 2024
#   reforms: policyengine_us.reforms.ctc.ctc_minimum_refundable_amount.ctc_minimum_refundable_amount
#   input:
#     gov.contrib.ctc.minimum_refundable.in_effect: true
#     gov.contrib.ctc.minimum_refundable.amount[0].amount: 500
#     gov.contrib.ctc.minimum_refundable.amount[1].amount: 300
#     age: 4
#     ctc_qualifying_child: true
#   output:
#     ctc_minimum_refundable_amount: 500

# - name: Child exactly age 6 with minimum amount
#   period: 2024
#   reforms: policyengine_us.reforms.ctc.ctc_minimum_refundable_amount.ctc_minimum_refundable_amount
#   input:
#     gov.contrib.ctc.minimum_refundable.in_effect: true
#     gov.contrib.ctc.minimum_refundable.amount[0].amount: 500
#     gov.contrib.ctc.minimum_refundable.amount[1].amount: 300
#     age: 6
#     ctc_qualifying_child: true
#   output:
#     ctc_minimum_refundable_amount: 300

# - name: Child over 6 with minimum amount
#   period: 2024
#   reforms: policyengine_us.reforms.ctc.ctc_minimum_refundable_amount.ctc_minimum_refundable_amount
#   input:
#     gov.contrib.ctc.minimum_refundable.in_effect: true
#     gov.contrib.ctc.minimum_refundable.amount[0].amount: 500
#     gov.contrib.ctc.minimum_refundable.amount[1].amount: 300
#     age: 10
#     ctc_qualifying_child: true
#   output:
#     ctc_minimum_refundable_amount: 300

# - name: Non-qualifying child gets zero
#   period: 2024
#   reforms: policyengine_us.reforms.ctc.ctc_minimum_refundable_amount.ctc_minimum_refundable_amount
#   input:
#     gov.contrib.ctc.minimum_refundable.in_effect: true
#     gov.contrib.ctc.minimum_refundable.amount[0].amount: 500
#     gov.contrib.ctc.minimum_refundable.amount[1].amount: 300
#     age: 8
#     ctc_qualifying_child: false
#   output:
#     ctc_minimum_refundable_amount: 0

# - name: Edge case - different bracket amounts
#   period: 2024
#   reforms: policyengine_us.reforms.ctc.ctc_minimum_refundable_amount.ctc_minimum_refundable_amount
#   input:
#     gov.contrib.ctc.minimum_refundable.in_effect: true
#     gov.contrib.ctc.minimum_refundable.amount[0].amount: 800
#     gov.contrib.ctc.minimum_refundable.amount[1].amount: 200
#     age: 3
#     ctc_qualifying_child: true
#   output:
#     ctc_minimum_refundable_amount: 800

# - name: Edge case - zero amounts in brackets
#   period: 2024
#   reforms: policyengine_us.reforms.ctc.ctc_minimum_refundable_amount.ctc_minimum_refundable_amount
#   input:
#     gov.contrib.ctc.minimum_refundable.in_effect: true
#     gov.contrib.ctc.minimum_refundable.amount[0].amount: 0
#     gov.contrib.ctc.minimum_refundable.amount[1].amount: 0
#     age: 5
#     ctc_qualifying_child: true
#   output:
#     ctc_minimum_refundable_amount: 0

# - name: Integration test - refundable CTC with tax unit having children
#   period: 2024
#   reforms: policyengine_us.reforms.ctc.ctc_minimum_refundable_amount.ctc_minimum_refundable_amount
#   input:
#     people:
#       person1:
#         age: 40
#         is_tax_unit_head: true
#       child1:
#         age: 4
#         ctc_qualifying_child: true
#       child2:
#         age: 8
#         ctc_qualifying_child: true
#     tax_units:
#       tax_unit:
#         members: [person1, child1, child2]
#         ctc_refundable_maximum: 2_000
#         ctc: 3_000
#         ctc_phase_in: 1_000
#         ctc_limiting_tax_liability: 500
#         ctc_phase_out: 0
#     households:
#       household:
#         members: [person1, child1, child2]
#     gov.contrib.ctc.minimum_refundable.in_effect: true
#     gov.contrib.ctc.minimum_refundable.amount[0].amount: 600
#     gov.contrib.ctc.minimum_refundable.amount[1].amount: 400
#   output:
#     refundable_ctc: 1_000

# - name: Integration test - phase-out affects total refundable amount
#   period: 2024
#   reforms: policyengine_us.reforms.ctc.ctc_minimum_refundable_amount.ctc_minimum_refundable_amount
#   input:
#     people:
#       person1:
#         age: 40
#         is_tax_unit_head: true
#       child1:
#         age: 5
#         ctc_qualifying_child: true
#     tax_units:
#       tax_unit:
#         members: [person1, child1]
#         ctc_refundable_maximum: 1_000
#         ctc: 2_500
#         ctc_phase_in: 300
#         ctc_limiting_tax_liability: 200
#         ctc_phase_out: 500
#     households:
#       household:
#         members: [person1, child1]
#     gov.contrib.ctc.minimum_refundable.in_effect: true
#     gov.contrib.ctc.minimum_refundable.amount[0].amount: 800
#     gov.contrib.ctc.minimum_refundable.amount[1].amount: 500
#   output:
#     refundable_ctc: 300

- name: Integration test - no earnings, minimum amount should apply
  period: 2024
  reforms: policyengine_us.reforms.ctc.ctc_minimum_refundable_amount.ctc_minimum_refundable_amount
  input:
    gov.contrib.ctc.minimum_refundable.in_effect: true
    gov.contrib.ctc.minimum_refundable.amount[0].amount: 800
    gov.contrib.ctc.minimum_refundable.amount[1].amount: 500
    people:
      person1:
        age: 40
        is_tax_unit_head: true
        employment_income: 0
      child1:
        age: 5
        ctc_qualifying_child: true
    tax_units:
      tax_unit:
        members: [person1, child1]
    households:
      household:
        members: [person1, child1]
  output:
    ctc_minimum_refundable_amount: [0, 800]
    refundable_ctc: 800
