# Integration test for Medicare Savings Program
# Tests full pipeline from income to benefit calculation

- name: QMB eligible senior - full integration
  period: 2024-01
  input:
    people:
      senior:
        age: 67
        medicare_quarters_of_coverage: 40  # Premium-free Part A
    tax_units:
      tax_unit:
        members: [senior]
        adjusted_gross_income: 12_000  # $1,000/month
    spm_units:
      spm_unit:
        members: [senior]
        spm_unit_cash_assets: 5_000
    households:
      household:
        members: [senior]
        state_code: IL
  output:
    is_medicare_eligible: [true]
    msp_countable_income: [1_000]
    msp_income_eligible: [true]
    msp_asset_eligible: [true]
    msp_eligible: [true]
    msp_category: [QMB]
    # With 40+ quarters (default), Part A is free, so benefit is just Part B
    msp_benefit_value: [174.70]
    msp: [174.70]
    il_msp: [174.70]

- name: Married couple - both Medicare eligible
  period: 2024-01
  input:
    people:
      person1:
        age: 68
        medicare_quarters_of_coverage: 40
      person2:
        age: 66
        medicare_quarters_of_coverage: 40
    tax_units:
      tax_unit:
        members: [person1, person2]
        adjusted_gross_income: 18_000  # $1,500/month combined
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_cash_assets: 10_000  # Under couple limit of $14,130
    households:
      household:
        members: [person1, person2]
        state_code: IL
  output:
    # Both should be QMB eligible
    # FPL for 2 people in 2024: $15,060 + $5,380 = $20,440/year
    # Combined income: $18,000/year = $1,500/month
    # 100% FPL monthly = $1,703.33/month
    # $1,500 < $1,703.33 so both are QMB eligible
    is_medicare_eligible: [true, true]
    msp_eligible: [true, true]
    msp_category: [QMB, QMB]
    msp_benefit_value: [174.70, 174.70]
    il_msp: [349.40]  # Sum of both benefits

- name: Not eligible - income too high
  period: 2024-01
  input:
    people:
      person:
        age: 70
        medicare_quarters_of_coverage: 40
    tax_units:
      tax_unit:
        members: [person]
        adjusted_gross_income: 30_000  # $2,500/month = 199% FPL
    spm_units:
      spm_unit:
        members: [person]
        spm_unit_cash_assets: 5_000
    households:
      household:
        members: [person]
        state_code: IL
  output:
    is_medicare_eligible: [true]
    msp_eligible: [false]
    msp_category: [NONE]
    msp_benefit_value: [0]
    msp: [0]
    il_msp: [0]
