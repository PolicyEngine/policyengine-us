# Unit tests for Iowa FIP countable income
# Countable income calculation:
# 1. Apply 20% earned income deduction
# 2. Apply 58% work incentive disregard to remaining earned income
# 3. Add unearned income (no deductions)
# Reference: https://www.legis.iowa.gov/docs/iac/chapter/01-07-2026.441.41.pdf

- name: Case 1, zero income.
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income: 0
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: IA
  output:
    ia_fip_countable_income: 0

- name: Case 2, earned income only ($800/month).
  period: 2025
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 30
        employment_income: 9_600
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: IA
  output:
    # Gross earned: $9,600
    # 20% deduction: $9,600 * 0.20 = $1,920
    # Remaining: $9,600 - $1,920 = $7,680
    # 58% work incentive: $7,680 * 0.58 = $4,454.40
    # Countable earned: $7,680 - $4,454.40 = $3,225.60
    ia_fip_countable_income: 3_225.60

- name: Case 3, unearned income only.
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income: 0
        social_security: 4_800
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: IA
  output:
    # Unearned income has no deductions
    # Countable = $4,800
    ia_fip_countable_income: 4_800

- name: Case 4, mixed earned and unearned income.
  period: 2025
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 30
        employment_income: 6_000
        social_security: 2_400
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: IA
  output:
    # Gross earned: $6,000
    # 20% deduction: $6,000 * 0.20 = $1,200
    # Remaining: $6,000 - $1,200 = $4,800
    # 58% work incentive: $4,800 * 0.58 = $2,784
    # Countable earned: $4,800 - $2,784 = $2,016
    # Total countable: $2,016 + $2,400 = $4,416
    ia_fip_countable_income: 4_416

- name: Case 5, low earned income ($600/month).
  period: 2025
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 25
        employment_income: 7_200
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: IA
  output:
    # Gross earned: $7,200
    # 20% deduction: $7,200 * 0.20 = $1,440
    # Remaining: $7,200 - $1,440 = $5,760
    # 58% work incentive: $5,760 * 0.58 = $3,340.80
    # Countable earned: $5,760 - $3,340.80 = $2,419.20
    ia_fip_countable_income: 2_419.20

- name: Case 6, high earned income ($2,000/month).
  period: 2025
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 30
        employment_income: 24_000
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: IA
  output:
    # Gross earned: $24,000
    # 20% deduction: $24,000 * 0.20 = $4,800
    # Remaining: $24,000 - $4,800 = $19,200
    # 58% work incentive: $19,200 * 0.58 = $11,136
    # Countable earned: $19,200 - $11,136 = $8,064
    ia_fip_countable_income: 8_064

- name: Case 7, multiple earners in household.
  period: 2025
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 35
        employment_income: 10_000
      person2:
        age: 33
        employment_income: 2_000
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: IA
  output:
    # Gross earned: $10,000 + $2,000 = $12,000
    # 20% deduction: $12,000 * 0.20 = $2,400
    # Remaining: $12,000 - $2,400 = $9,600
    # 58% work incentive: $9,600 * 0.58 = $5,568
    # Countable earned: $9,600 - $5,568 = $4,032
    ia_fip_countable_income: 4_032

- name: Case 8, non-Iowa state gets zero.
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income: 9_600
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: IL
  output:
    # defined_for StateCode.IA, other states return 0
    ia_fip_countable_income: 0
