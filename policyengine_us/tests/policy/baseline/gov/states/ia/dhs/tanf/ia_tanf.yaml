# Iowa TANF (Family Investment Program) benefit tests
# Per 441 IAC 41.27(239B) and 41.28(239B)

- name: Unit test - eligible household receives benefit
  period: 2025
  input:
    ia_tanf_payment_standard: 5_112
    ia_tanf_countable_income: 3_225.60
    ia_tanf_eligible: true
    state_code: IA
  output:
    ia_tanf: 1_886.40

- name: Unit test - countable income exceeds payment standard
  period: 2025
  input:
    ia_tanf_payment_standard: 5_112
    ia_tanf_countable_income: 6_000
    ia_tanf_eligible: true
    state_code: IA
  output:
    ia_tanf: 0

- name: Unit test - ineligible household receives no benefit
  period: 2025
  input:
    ia_tanf_payment_standard: 5_112
    ia_tanf_countable_income: 3_000
    ia_tanf_eligible: false
    state_code: IA
  output:
    ia_tanf: 0

- name: Integration test - family of 3 with $800/month earnings
  # Example from 441 IAC 41.27(239B) documentation
  # Family of 3 with one employed parent earning $800/month gross
  # Calculations (annual):
  # - Gross Income: $9,600
  # - 20% earned income deduction: $9,600 * 0.20 = $1,920
  # - Net after 20%: $9,600 - $1,920 = $7,680
  # - 58% work incentive: $7,680 * 0.58 = $4,454.40
  # - Countable income: $7,680 - $4,454.40 = $3,225.60
  # - Payment standard for 3: $426/month * 12 = $5,112/year
  # - Benefit: $5,112 - $3,225.60 = $1,886.40/year
  period: 2025
  absolute_error_margin: 1
  input:
    people:
      parent:
        age: 30
        employment_income: 9_600
        is_tax_unit_head_or_spouse: true
      child1:
        age: 5
        employment_income: 0
        is_tax_unit_dependent: true
      child2:
        age: 3
        employment_income: 0
        is_tax_unit_dependent: true
    spm_units:
      spm_unit:
        members: [parent, child1, child2]
    tax_units:
      tax_unit:
        members: [parent, child1, child2]
    households:
      household:
        members: [parent, child1, child2]
        state_code: IA
  output:
    ia_tanf_standard_of_need: 10_188
    ia_tanf_payment_standard: 5_112
    ia_tanf_gross_earned_income: 9_600
    ia_tanf_gross_income: 9_600
    ia_tanf_countable_income: 3_225.60
    ia_tanf_gross_income_eligible: true
    ia_tanf_net_income_eligible: true
    ia_tanf_payment_standard_eligible: true
    ia_tanf_income_eligible: true
    ia_tanf_eligible: true
    ia_tanf: 1_886.40

- name: Integration test - family exceeds gross income limit
  # Family of 2 with $2,000/month earnings
  # Gross income limit: $719 * 1.85 * 12 = $15,961.80/year
  # Gross income: $24,000/year > $15,961.80 - FAIL Test 1
  period: 2025
  absolute_error_margin: 1
  input:
    people:
      parent:
        age: 30
        employment_income: 24_000
        is_tax_unit_head_or_spouse: true
      child:
        age: 5
        employment_income: 0
        is_tax_unit_dependent: true
    spm_units:
      spm_unit:
        members: [parent, child]
    tax_units:
      tax_unit:
        members: [parent, child]
    households:
      household:
        members: [parent, child]
        state_code: IA
  output:
    ia_tanf_standard_of_need: 8_628
    ia_tanf_gross_income: 24_000
    ia_tanf_gross_income_eligible: false
    ia_tanf_income_eligible: false
    ia_tanf_eligible: false
    ia_tanf: 0
