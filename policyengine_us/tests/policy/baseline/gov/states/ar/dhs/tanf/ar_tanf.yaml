# Unit tests for ar_tanf (final benefit amount)
# Benefit calculation:
# 1. If not eligible: $0
# 2. If gross income < $446: benefit = max(payment_standard - countable_income, 0)
# 3. If gross income >= $446: benefit = max(payment_standard * 0.5 - countable_income, 0)

- name: Case 1, ineligible receives zero.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        tanf_gross_earned_income: 0
        tanf_gross_unearned_income: 0
    households:
      household:
        members: [person1]
        state_code: AR
    spm_units:
      spm_unit:
        members: [person1]
        ar_tanf_eligible: false
        ar_tanf_maximum_benefit: 204
        ar_tanf_countable_income: 0
  output:
    ar_tanf: 0
    # Not eligible -> no benefit

- name: Case 2, eligible with zero income receives full benefit.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        tanf_gross_earned_income: 0
        tanf_gross_unearned_income: 0
    households:
      household:
        members: [person1]
        state_code: AR
    spm_units:
      spm_unit:
        members: [person1]
        ar_tanf_eligible: true
        ar_tanf_maximum_benefit: 204
        ar_tanf_countable_income: 0
  output:
    ar_tanf: 204
    # max(204 - 0, 0) = 204

- name: Case 3, eligible with countable income below payment standard.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        tanf_gross_earned_income: 400
        tanf_gross_unearned_income: 0
    households:
      household:
        members: [person1]
        state_code: AR
    spm_units:
      spm_unit:
        members: [person1]
        ar_tanf_eligible: true
        ar_tanf_maximum_benefit: 204
        ar_tanf_countable_income: 128
  output:
    ar_tanf: 76
    # Gross income 400 < 446 trigger, so full payment standard applies
    # max(204 - 128, 0) = 76

- name: Case 4, gross income at trigger causes 50 percent reduction.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        tanf_gross_earned_income: 446
        tanf_gross_unearned_income: 0
    households:
      household:
        members: [person1]
        state_code: AR
    spm_units:
      spm_unit:
        members: [person1]
        ar_tanf_eligible: true
        ar_tanf_maximum_benefit: 204
        ar_tanf_countable_income: 0
  output:
    ar_tanf: 102
    # Gross income 446 >= 446 trigger, so 50% reduction
    # max(204 * 0.5 - 0, 0) = max(102 - 0, 0) = 102

- name: Case 5, gross income above trigger with countable income.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        tanf_gross_earned_income: 500
        tanf_gross_unearned_income: 0
    households:
      household:
        members: [person1]
        state_code: AR
    spm_units:
      spm_unit:
        members: [person1]
        ar_tanf_eligible: true
        ar_tanf_maximum_benefit: 162
        ar_tanf_countable_income: 50
  output:
    ar_tanf: 31
    # Gross income 500 >= 446 trigger, so 50% reduction
    # max(162 * 0.5 - 50, 0) = max(81 - 50, 0) = 31

- name: Case 6, benefit would be negative clipped to zero.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        tanf_gross_earned_income: 0
        tanf_gross_unearned_income: 0
    households:
      household:
        members: [person1]
        state_code: AR
    spm_units:
      spm_unit:
        members: [person1]
        ar_tanf_eligible: true
        ar_tanf_maximum_benefit: 81
        ar_tanf_countable_income: 100
  output:
    ar_tanf: 0
    # max(81 - 100, 0) = max(-19, 0) = 0
