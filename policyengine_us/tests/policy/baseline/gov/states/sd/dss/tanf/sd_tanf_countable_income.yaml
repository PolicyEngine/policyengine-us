# Unit tests for South Dakota TANF countable income
# Formula: Countable Earned Income + Unearned Income
# Earned income gets $90 + 20% disregard; unearned is counted fully
# Source: NCCP TANF Profile - South Dakota
# https://www.nccp.org/wp-content/uploads/2024/08/TANF-profile-South-Dakota-.pdf#page=1
# Note: Uses employment_income_before_lsr for earned income (federal TANF baseline)

- name: Case 1, only earned income $500 per month.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 6_000  # $500/month
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: SD
  output:
    # Countable earned: (500 - 90) x 0.80 = $328
    # Unearned: $0
    # Total countable: $328 + $0 = $328
    sd_tanf_countable_income: 328

- name: Case 2, only unearned income $200 per month.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        social_security: 2_400  # $200/month
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: SD
  output:
    # Countable earned: $0
    # Unearned: $200 (counted fully)
    # Total countable: $0 + $200 = $200
    sd_tanf_countable_income: 200

- name: Case 3, combined earned and unearned income.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 6_000  # $500/month earned
        social_security: 2_400  # $200/month unearned
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: SD
  output:
    # Countable earned: (500 - 90) x 0.80 = $328
    # Unearned: $200
    # Total countable: $328 + $200 = $528
    sd_tanf_countable_income: 528

- name: Case 4, no income.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: SD
  output:
    # Countable earned: $0
    # Unearned: $0
    # Total countable: $0
    sd_tanf_countable_income: 0

- name: Case 5, earned income below deduction threshold with unearned.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 600  # $50/month
        child_support_received: 1_200  # $100/month
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: SD
  output:
    # Gross earned: $50
    # After $90 deduction: max(50 - 90, 0) = $0
    # Countable earned: $0 x 0.80 = $0
    # Unearned: $100
    # Total countable: $0 + $100 = $100
    sd_tanf_countable_income: 100

- name: Case 6, documentation example with earned and unearned.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 4_800  # $400/month
        social_security: 1_200  # $100/month
      person2:
        age: 5
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: SD
  output:
    # Gross earned: $400
    # After $90 deduction: max(400 - 90, 0) = $310
    # Countable earned: $310 x 0.80 = $248
    # Unearned: $100
    # Total countable: $248 + $100 = $348
    sd_tanf_countable_income: 348

# =============================================================================
# EDGE CASES - Boundary and Extreme Value Testing
# =============================================================================

- name: Case 7, edge case - high unearned income only ($2,000 per month).
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        social_security: 24_000  # $2,000/month unearned only
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: SD
  output:
    # Countable earned: $0
    # Unearned: $2,000 (counted fully - no disregard on unearned)
    # Total countable: $0 + $2,000 = $2,000
    # Edge case: verifies unearned is counted dollar-for-dollar even at high values
    sd_tanf_countable_income: 2_000

- name: Case 8, edge case - earned at boundary ($90) plus high unearned.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 1_080  # $90/month - exactly at flat deduction
        social_security: 12_000  # $1,000/month unearned
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: SD
  output:
    # Gross earned: $90
    # After $90 deduction: max(90 - 90, 0) = $0
    # Countable earned: $0 x 0.80 = $0
    # Unearned: $1,000
    # Total countable: $0 + $1,000 = $1,000
    # Edge case: earned income boundary with substantial unearned
    sd_tanf_countable_income: 1_000

- name: Case 9, edge case - earned just above boundary ($91) plus unearned.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 1_092  # $91/month - just above flat deduction
        social_security: 6_000  # $500/month unearned
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: SD
  output:
    # Gross earned: $91
    # After $90 deduction: max(91 - 90, 0) = $1
    # Countable earned: $1 x 0.80 = $0.80
    # Unearned: $500
    # Total countable: $0.80 + $500 = $500.80
    # Edge case: tiny countable earned plus unearned
    sd_tanf_countable_income: 500.8

- name: Case 10, edge case - very high combined income.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 36_000  # $3,000/month earned
        social_security: 12_000  # $1,000/month unearned
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: SD
  output:
    # Gross earned: $3,000
    # After $90 deduction: max(3000 - 90, 0) = $2,910
    # Countable earned: $2,910 x 0.80 = $2,328
    # Unearned: $1,000
    # Total countable: $2,328 + $1,000 = $3,328
    # Edge case: ensures formula handles very high combined amounts
    sd_tanf_countable_income: 3_328

- name: Case 11, edge case - multiple unearned income sources.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        social_security: 6_000  # $500/month
        child_support_received: 3_600  # $300/month
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: SD
  output:
    # Countable earned: $0
    # Unearned: $500 + $300 = $800 (all counted fully)
    # Total countable: $0 + $800 = $800
    # Edge case: verifies multiple unearned sources aggregated correctly
    # Note: SSI is excluded from TANF unearned income per federal baseline
    sd_tanf_countable_income: 800
