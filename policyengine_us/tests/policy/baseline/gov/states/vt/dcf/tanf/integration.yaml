# Vermont TANF (Reach Up) Integration Tests
# Tests complete benefit calculation pipeline
# Source: 33 V.S.A. Chapter 11, Code Vt. R. 13-170-220-X

- name: Case 1, family of 3 non-Chittenden with earnings.
  # Example from documentation
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 12_000  # $1,000/month
        is_tax_unit_head_or_spouse: true
        immigration_status: CITIZEN
      person2:
        age: 8
        employment_income_before_lsr: 0
        is_tax_unit_dependent: true
        immigration_status: CITIZEN
      person3:
        age: 5
        employment_income_before_lsr: 0
        is_tax_unit_dependent: true
        immigration_status: CITIZEN
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_size: 3
        housing_cost: 6_000  # $500/month (capped at $400)
    tax_units:
      tax_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: VT
        county: WASHINGTON_COUNTY_VT
  output:
    # Basic needs for size 3: $1,030
    vt_tanf_basic_needs_allowance: 1_030

    # Housing: min($500, $400) = $400 (non-Chittenden max)
    vt_tanf_housing_allowance: 400

    # Payment standard: ($1,030 + $400) x 0.496 = $709.28 -> $709
    vt_tanf_payment_standard: 709

    # Earned income disregard: $350 + ($1,000 - $350) x 0.25 = $512.50
    # Countable earned: $1,000 - $512.50 = $487.50
    vt_tanf_countable_earned_income: 487.5

    # No unearned income
    vt_tanf_countable_unearned_income: 0

    # Total countable: $487.50
    vt_tanf_countable_income: 487.5

    # Eligible: true
    vt_tanf_eligible: true

    # Benefit: $709 - $487.50 = $221.50 -> $221
    vt_tanf: 221

- name: Case 2, family of 3 Chittenden with no income.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 28
        employment_income_before_lsr: 0
        is_tax_unit_head_or_spouse: true
        immigration_status: CITIZEN
      person2:
        age: 6
        employment_income_before_lsr: 0
        is_tax_unit_dependent: true
        immigration_status: CITIZEN
      person3:
        age: 3
        employment_income_before_lsr: 0
        is_tax_unit_dependent: true
        immigration_status: CITIZEN
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_size: 3
        housing_cost: 14_400  # $1,200/month (capped at $450)
    tax_units:
      tax_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: VT
        county: CHITTENDEN_COUNTY_VT
  output:
    # Basic needs for size 3: $1,030
    vt_tanf_basic_needs_allowance: 1_030

    # Housing: min($1,200, $450) = $450 (Chittenden max)
    vt_tanf_housing_allowance: 450

    # Payment standard: ($1,030 + $450) x 0.496 = $734.08 -> $734
    vt_tanf_payment_standard: 734

    # No earned income
    vt_tanf_countable_earned_income: 0

    # No unearned income
    vt_tanf_countable_unearned_income: 0

    # Total countable: $0
    vt_tanf_countable_income: 0

    # Eligible: true
    vt_tanf_eligible: true

    # Benefit: $734 - $0 = $734 (full benefit)
    vt_tanf: 734

- name: Case 3, single parent with child support and earnings.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 32
        employment_income_before_lsr: 6_000  # $500/month
        child_support_received: 1_800  # $150/month
        is_tax_unit_head_or_spouse: true
        immigration_status: CITIZEN
      person2:
        age: 10
        employment_income_before_lsr: 0
        is_tax_unit_dependent: true
        immigration_status: CITIZEN
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_size: 2
        housing_cost: 4_800  # $400/month
    tax_units:
      tax_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: VT
        county: RUTLAND_COUNTY_VT
  output:
    # Basic needs for size 2: $879
    vt_tanf_basic_needs_allowance: 879

    # Housing: min($400, $400) = $400 (non-Chittenden max)
    vt_tanf_housing_allowance: 400

    # Payment standard: ($879 + $400) x 0.496 = $634.30 -> $634
    vt_tanf_payment_standard: 634

    # Earned income disregard: $350 + ($500 - $350) x 0.25 = $387.50
    # Countable earned: $500 - $387.50 = $112.50
    vt_tanf_countable_earned_income: 112.5

    # Child support: $150 - $100 disregard = $50
    vt_tanf_countable_unearned_income: 50

    # Total countable: $112.50 + $50 = $162.50
    vt_tanf_countable_income: 162.5

    # Eligible: true
    vt_tanf_eligible: true

    # Benefit: $634 - $162.50 = $471.50 -> $471
    vt_tanf: 471

- name: Case 4, two-parent family with higher earnings.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 35
        employment_income_before_lsr: 18_000  # $1,500/month
        is_tax_unit_head_or_spouse: true
        immigration_status: CITIZEN
      person2:
        age: 33
        employment_income_before_lsr: 0
        is_tax_unit_head_or_spouse: true
        immigration_status: CITIZEN
      person3:
        age: 12
        employment_income_before_lsr: 0
        is_tax_unit_dependent: true
        immigration_status: CITIZEN
      person4:
        age: 9
        employment_income_before_lsr: 0
        is_tax_unit_dependent: true
        immigration_status: CITIZEN
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4]
        spm_unit_size: 4
        housing_cost: 9_600  # $800/month (capped at $400)
    tax_units:
      tax_unit:
        members: [person1, person2, person3, person4]
    households:
      household:
        members: [person1, person2, person3, person4]
        state_code: VT
        county: WINDSOR_COUNTY_VT
  output:
    # Basic needs for size 4: $1,162
    vt_tanf_basic_needs_allowance: 1_162

    # Housing: min($800, $400) = $400 (non-Chittenden max)
    vt_tanf_housing_allowance: 400

    # Payment standard: ($1,162 + $400) x 0.496 = $774.67 -> $774
    vt_tanf_payment_standard: 774

    # Earned income disregard: $350 + ($1,500 - $350) x 0.25 = $637.50
    # Countable earned: $1,500 - $637.50 = $862.50
    vt_tanf_countable_earned_income: 862.5

    # No unearned income
    vt_tanf_countable_unearned_income: 0

    # Total countable: $862.50
    vt_tanf_countable_income: 862.5

    # Income exceeds payment standard
    vt_tanf_eligible: true

    # Benefit: $774 - $862.50 = -$88.50 -> $0
    vt_tanf: 0

- name: Case 5, family of 5 Chittenden with mixed income.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 40
        employment_income_before_lsr: 9_600  # $800/month
        social_security: 0
        is_tax_unit_head_or_spouse: true
        immigration_status: CITIZEN
      person2:
        age: 38
        employment_income_before_lsr: 0
        social_security: 2_400  # $200/month
        is_tax_unit_head_or_spouse: true
        immigration_status: CITIZEN
      person3:
        age: 15
        employment_income_before_lsr: 0
        is_tax_unit_dependent: true
        immigration_status: CITIZEN
      person4:
        age: 11
        employment_income_before_lsr: 0
        is_tax_unit_dependent: true
        immigration_status: CITIZEN
      person5:
        age: 7
        employment_income_before_lsr: 0
        is_tax_unit_dependent: true
        immigration_status: CITIZEN
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5]
        spm_unit_size: 5
        housing_cost: 15_600  # $1,300/month (capped at $450)
    tax_units:
      tax_unit:
        members: [person1, person2, person3, person4, person5]
    households:
      household:
        members: [person1, person2, person3, person4, person5]
        state_code: VT
        county: CHITTENDEN_COUNTY_VT
  output:
    # Basic needs for size 5: $1,247
    vt_tanf_basic_needs_allowance: 1_247

    # Housing: min($1,300, $450) = $450 (Chittenden max)
    vt_tanf_housing_allowance: 450

    # Payment standard: ($1,247 + $450) x 0.496 = $841.712
    vt_tanf_payment_standard: 841

    # Earned income disregard: $350 + ($800 - $350) x 0.25 = $462.50
    # Countable earned: $800 - $462.50 = $337.50
    vt_tanf_countable_earned_income: 337.5

    # Social security: $200 (no disregard)
    vt_tanf_countable_unearned_income: 200

    # Total countable: $337.50 + $200 = $537.50
    vt_tanf_countable_income: 537.5

    # Eligible: true
    vt_tanf_eligible: true

    # Benefit: $841.712 - $537.50 = $304.21
    vt_tanf: 304

- name: Case 6, pregnant woman with no children.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 25
        employment_income_before_lsr: 0
        is_pregnant: true
        is_tax_unit_head_or_spouse: true
        immigration_status: CITIZEN
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_size: 1
        housing_cost: 4_800  # $400/month
    tax_units:
      tax_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: VT
        county: LAMOILLE_COUNTY_VT
  output:
    # Basic needs for size 1: $644
    vt_tanf_basic_needs_allowance: 644

    # Housing: min($400, $400) = $400 (non-Chittenden max)
    vt_tanf_housing_allowance: 400

    # Payment standard: ($644 + $400) x 0.496 = $517.82 -> $517
    vt_tanf_payment_standard: 517

    # No income
    vt_tanf_countable_earned_income: 0
    vt_tanf_countable_unearned_income: 0
    vt_tanf_countable_income: 0

    # Eligible: true (pregnant women may qualify)
    vt_tanf_eligible: true

    # Benefit: $517 - $0 = $517
    vt_tanf: 517

- name: Case 7, benefit just above minimum threshold.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 10_800  # $900/month
        is_tax_unit_head_or_spouse: true
        immigration_status: CITIZEN
      person2:
        age: 4
        employment_income_before_lsr: 0
        is_tax_unit_dependent: true
        immigration_status: CITIZEN
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_size: 2
        housing_cost: 4_800  # $400/month
    tax_units:
      tax_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: VT
        county: ORLEANS_COUNTY_VT
  output:
    # Basic needs for size 2: $879
    vt_tanf_basic_needs_allowance: 879

    # Housing: min($400, $400) = $400
    vt_tanf_housing_allowance: 400

    # Payment standard: ($879 + $400) x 0.496 = $634.30 -> $634
    vt_tanf_payment_standard: 634

    # Earned income disregard: $350 + ($900 - $350) x 0.25 = $487.50
    # Countable earned: $900 - $487.50 = $412.50
    vt_tanf_countable_earned_income: 412.5

    # No unearned income
    vt_tanf_countable_unearned_income: 0

    # Total countable: $412.50
    vt_tanf_countable_income: 412.5

    # Eligible: true
    vt_tanf_eligible: true

    # Benefit: $634 - $412.50 = $221.50 -> $221
    vt_tanf: 221
