# Integration tests for NH FANF (Financial Assistance to Needy Families)
# Tests the complete benefit calculation pipeline with real-world scenarios
# Note: Tests default to applicant status (20% earned income disregard)
# Recipients get 75% disregard per Cliff Effect Initiative (Sept 2022)
# Sources: RSA 167:77-g; FAM 601; FAM 603; SR 97-03; BFA SR 22-28

- name: Case 1, single parent with one child, no income, maximum benefit.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 500
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    nh_fanf_payment_standard: 1_022
    nh_fanf_countable_earned_income: 0
    nh_fanf_countable_income: 0
    nh_fanf_income_eligible: true
    nh_fanf_resources_eligible: true
    nh_fanf_eligible: true
    nh_fanf: 1_022

- name: Case 2, applicant with earnings, 20 percent disregard.
  period: 2024-01
  input:
    people:
      person1:
        age: 28
        employment_income_before_lsr: 12_000  # $1,000/month
      person2:
        age: 7
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 200
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    nh_fanf_payment_standard: 1_022
    # Applicant: 1,000 * 0.80 = 800
    nh_fanf_countable_earned_income: 800
    nh_fanf_countable_income: 800
    nh_fanf_income_eligible: true
    nh_fanf_resources_eligible: true
    nh_fanf_eligible: true
    # 1,022 - 800 = 222
    nh_fanf: 222

- name: Case 3, income above threshold, ineligible.
  period: 2024-01
  input:
    people:
      person1:
        age: 35
        employment_income_before_lsr: 36_000  # $3,000/month
      person2:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 0
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    nh_fanf_payment_standard: 1_022
    # Applicant: 3,000 * 0.80 = 2,400 > 1,022
    nh_fanf_countable_earned_income: 2_400
    nh_fanf_countable_income: 2_400
    nh_fanf_income_eligible: false
    nh_fanf_eligible: false
    nh_fanf: 0

- name: Case 4, resources over limit, ineligible.
  period: 2024-01
  input:
    people:
      person1:
        age: 29
      person2:
        age: 4
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 2_000
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    nh_fanf_resources_eligible: false
    nh_fanf_eligible: false
    nh_fanf: 0

- name: Case 5, SSI recipient excluded from income.
  period: 2024-01
  input:
    people:
      person1:
        age: 40
        ssi: 10_000
      person2:
        age: 12
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 300
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    # SSI excluded
    nh_fanf_countable_income: 0
    nh_fanf_eligible: true
    nh_fanf: 1_022

- name: Case 6, earned and unearned income combined.
  period: 2024-01
  input:
    people:
      person1:
        age: 38
        employment_income_before_lsr: 9_600  # $800/month
        social_security: 2_400  # $200/month
      person2:
        age: 36
      person3:
        age: 14
      person4:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4]
        spm_unit_assets: 900
    households:
      household:
        members: [person1, person2, person3, person4]
        state_code: NH
  output:
    nh_fanf_payment_standard: 1_560
    # Applicant: 800 * 0.80 = 640 earned + 200 unearned = 840
    nh_fanf_countable_earned_income: 640
    nh_fanf_countable_income: 840
    nh_fanf_eligible: true
    # 1,560 - 840 = 720
    nh_fanf: 720

- name: Case 7, recipient with 75 percent earned income disregard.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 12_000  # $1,000/month
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 500
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    # Recipient: 1,000 * 0.25 = 250
    nh_fanf_countable_earned_income: 250
    nh_fanf_countable_income: 250
    nh_fanf_eligible: true
    # 1,022 - 250 = 772
    nh_fanf: 772

- name: Case 8, recipient with higher resource limit.
  period: 2024-01
  input:
    people:
      person1:
        age: 35
      person2:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 3_000
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    # Recipient limit: $5,000; assets $3,000 passes
    nh_fanf_resources_eligible: true
    nh_fanf_eligible: true
    nh_fanf: 1_022

- name: Case 9, recipient with child care deduction.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 24_000  # $2,000/month
      person2:
        age: 3
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 500
        is_tanf_enrolled: true
        childcare_expenses: 3_600
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    # Recipient: 2,000 * 0.25 = 500
    # Child care: $200
    # Countable: 500 - 200 = 300
    nh_fanf_child_care_deduction: 200
    nh_fanf_countable_earned_income: 300
    nh_fanf_countable_income: 300
    nh_fanf_eligible: true
    # 1,022 - 300 = 722
    nh_fanf: 722

- name: Case 10, large 8-person household.
  period: 2024-01
  input:
    people:
      person1:
        age: 40
      person2:
        age: 38
      person3:
        age: 16
      person4:
        age: 14
      person5:
        age: 12
      person6:
        age: 10
      person7:
        age: 8
      person8:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5, person6, person7, person8]
        spm_unit_assets: 800
    households:
      household:
        members: [person1, person2, person3, person4, person5, person6, person7, person8]
        state_code: NH
  output:
    # 8-person payment standard: 2,636
    nh_fanf_payment_standard: 2_636
    nh_fanf_eligible: true
    nh_fanf: 2_636

- name: Case 11, applicant with child care deduction.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 24_000  # $2,000/month
      person2:
        age: 3
      person3:
        age: 7
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_assets: 500
        is_tanf_enrolled: false
        childcare_expenses: 6_000
    households:
      household:
        members: [person1, person2, person3]
        state_code: NH
  output:
    nh_fanf_payment_standard: 1_291
    # Applicant: 2,000 * 0.80 = 1,600
    # Child care: $200 (age 3) + $175 (age 7) = $375
    # Countable: 1,600 - 375 = 1,225
    nh_fanf_child_care_deduction: 375
    nh_fanf_countable_earned_income: 1_225
    nh_fanf_countable_income: 1_225
    nh_fanf_eligible: true
    # 1,291 - 1,225 = 66
    nh_fanf: 66

- name: Case 12, child care deduction brings countable to zero.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 2_400  # $200/month
      person2:
        age: 3
      person3:
        age: 4
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_assets: 500
        is_tanf_enrolled: true
        childcare_expenses: 4_800
    households:
      household:
        members: [person1, person2, person3]
        state_code: NH
  output:
    nh_fanf_payment_standard: 1_291
    # Recipient: 200 * 0.25 = 50
    # Child care (part-time): 2 * $100 = $200
    # Countable: max(50 - 200, 0) = 0
    nh_fanf_child_care_deduction: 200
    nh_fanf_countable_earned_income: 0
    nh_fanf_countable_income: 0
    nh_fanf_eligible: true
    nh_fanf: 1_291

- name: Case 13, multiple earners in household.
  period: 2024-01
  input:
    people:
      person1:
        age: 35
        employment_income_before_lsr: 6_000  # $500/month
      person2:
        age: 33
        employment_income_before_lsr: 6_000  # $500/month
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_assets: 500
    households:
      household:
        members: [person1, person2, person3]
        state_code: NH
  output:
    nh_fanf_payment_standard: 1_291
    # Applicant: (500 + 500) * 0.80 = 800
    nh_fanf_countable_earned_income: 800
    nh_fanf_countable_income: 800
    nh_fanf_eligible: true
    # 1,291 - 800 = 491
    nh_fanf: 491

- name: Case 14, applicant with $1000 per month earnings.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 12_000  # $1,000/month
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 500
        is_tanf_enrolled: false
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    # Applicant: 1,000 * 0.80 = 800
    nh_fanf_countable_earned_income: 800
    nh_fanf_countable_income: 800
    nh_fanf_eligible: true
    # 1,022 - 800 = 222
    nh_fanf: 222

- name: Case 15, recipient with same $1000 per month earnings.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 12_000  # $1,000/month
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 500
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    # Recipient: 1,000 * 0.25 = 250 (75% disregard)
    nh_fanf_countable_earned_income: 250
    nh_fanf_countable_income: 250
    nh_fanf_eligible: true
    # 1,022 - 250 = 772 (vs 222 for applicant - $550 more benefit!)
    nh_fanf: 772
