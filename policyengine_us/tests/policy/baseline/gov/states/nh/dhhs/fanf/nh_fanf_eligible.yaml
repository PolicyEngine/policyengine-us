# Tests for NH FANF overall eligibility
# Eligibility requires: income eligible AND resources eligible AND demographic eligible
# AND immigration eligible (at least one citizen or qualified noncitizen)
# Source: RSA 167:79; FAM 203

- name: Case 1, all criteria met is eligible.
  period: 2024-01
  input:
    state_code: NH
    nh_fanf_income_eligible: true
    nh_fanf_resources_eligible: true
    is_demographic_tanf_eligible: true
  output:
    nh_fanf_eligible: true

- name: Case 2, income ineligible.
  period: 2024-01
  input:
    state_code: NH
    nh_fanf_income_eligible: false
    nh_fanf_resources_eligible: true
    is_demographic_tanf_eligible: true
  output:
    nh_fanf_eligible: false

- name: Case 3, resources ineligible.
  period: 2024-01
  input:
    state_code: NH
    nh_fanf_income_eligible: true
    nh_fanf_resources_eligible: false
    is_demographic_tanf_eligible: true
  output:
    nh_fanf_eligible: false

- name: Case 4, demographic ineligible.
  period: 2024-01
  input:
    state_code: NH
    nh_fanf_income_eligible: true
    nh_fanf_resources_eligible: true
    is_demographic_tanf_eligible: false
  output:
    nh_fanf_eligible: false

- name: Case 5, all criteria fail.
  period: 2024-01
  input:
    state_code: NH
    nh_fanf_income_eligible: false
    nh_fanf_resources_eligible: false
    is_demographic_tanf_eligible: false
  output:
    nh_fanf_eligible: false

# --- Edge Case Tests ---

- name: Edge case, citizen parent with citizen child.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        immigration_status: CITIZEN
      person2:
        age: 5
        immigration_status: CITIZEN
    spm_units:
      spm_unit:
        members: [person1, person2]
        nh_fanf_income_eligible: true
        nh_fanf_resources_eligible: true
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    # Both are citizens - immigration eligible
    nh_fanf_eligible: true

- name: Edge case, legal permanent resident parent with citizen child.
  period: 2024-01
  input:
    people:
      person1:
        age: 28
        immigration_status: LEGAL_PERMANENT_RESIDENT
      person2:
        age: 4
        immigration_status: CITIZEN
    spm_units:
      spm_unit:
        members: [person1, person2]
        nh_fanf_income_eligible: true
        nh_fanf_resources_eligible: true
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    # At least one is a qualified immigrant - immigration eligible
    nh_fanf_eligible: true

- name: Edge case, refugee parent with child.
  period: 2024-01
  input:
    people:
      person1:
        age: 32
        immigration_status: REFUGEE
      person2:
        age: 7
        immigration_status: REFUGEE
    spm_units:
      spm_unit:
        members: [person1, person2]
        nh_fanf_income_eligible: true
        nh_fanf_resources_eligible: true
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    # Refugees are qualified noncitizens - eligible
    nh_fanf_eligible: true

- name: Edge case, income and resources both fail.
  period: 2024-01
  input:
    state_code: NH
    nh_fanf_income_eligible: false
    nh_fanf_resources_eligible: false
    is_demographic_tanf_eligible: true
  output:
    nh_fanf_eligible: false

- name: Edge case, only demographic fails.
  period: 2024-01
  input:
    state_code: NH
    nh_fanf_income_eligible: true
    nh_fanf_resources_eligible: true
    is_demographic_tanf_eligible: false
  output:
    nh_fanf_eligible: false

- name: Edge case, full household scenario with all eligible criteria.
  period: 2024-01
  input:
    people:
      person1:
        age: 35
        immigration_status: CITIZEN
      person2:
        age: 12
        immigration_status: CITIZEN
      person3:
        age: 8
        immigration_status: CITIZEN
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_assets: 500
        nh_fanf_countable_income: 500
    households:
      household:
        members: [person1, person2, person3]
        state_code: NH
  output:
    # Payment standard for 3 = 1,291
    # Income 500 <= 1,291 -> income eligible
    # Resources 500 <= 1,000 -> resources eligible
    # Has children under 18 -> demographic eligible
    # All citizens -> immigration eligible
    nh_fanf_eligible: true
