# Tests for NH FANF countable earned income
# NH applies different earned income disregard rates:
# - Applicants: 20% disregard (keep 80%)
# - Recipients: 75% disregard (keep 25%) as of Sept 2022 Cliff Effect Initiative
# Child care deduction is also applied to earned income
# Source: SR 97-03; FAM 603.01; BFA SR 22-28

- name: Case 1, zero earned income.
  period: 2024-01
  input:
    state_code: NH
  output:
    nh_fanf_countable_earned_income: 0

- name: Case 2, applicant with earned income, 20 percent disregard.
  period: 2024-01
  input:
    state_code: NH
    is_tanf_enrolled: false
    tanf_gross_earned_income: 1_000
  output:
    # Applicant: 1,000 * (1 - 0.20) = 800
    nh_fanf_countable_earned_income: 800

- name: Case 3, recipient with earned income, 75 percent disregard.
  period: 2024-01
  input:
    state_code: NH
    is_tanf_enrolled: true
    tanf_gross_earned_income: 1_000
  output:
    # Recipient: 1,000 * (1 - 0.75) = 250
    nh_fanf_countable_earned_income: 250

- name: Case 4, applicant with child care deduction.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 24_000  # $2,000/month gross
      person2:
        age: 3
    spm_units:
      spm_unit:
        members: [person1, person2]
        is_tanf_enrolled: false
        childcare_expenses: 3_600  # $300/month
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    # Applicant: 2,000 * (1 - 0.20) = 1,600
    # Child care max (under 6, full-time): $200
    # Countable: 1,600 - 200 = 1,400
    nh_fanf_countable_earned_income: 1_400

- name: Case 5, recipient with child care deduction.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 24_000
      person2:
        age: 3
    spm_units:
      spm_unit:
        members: [person1, person2]
        is_tanf_enrolled: true
        childcare_expenses: 3_600
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    # Recipient: 2,000 * (1 - 0.75) = 500
    # Child care: $200
    # Countable: 500 - 200 = 300
    nh_fanf_countable_earned_income: 300

- name: Case 6, child care deduction exceeds income, capped at zero.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 2_400  # $200/month gross
      person2:
        age: 3
    spm_units:
      spm_unit:
        members: [person1, person2]
        is_tanf_enrolled: true
        childcare_expenses: 2_400
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    # Recipient: 200 * (1 - 0.75) = 50
    # Child care (part-time): $100
    # Countable: max(50 - 100, 0) = 0
    nh_fanf_countable_earned_income: 0

- name: Case 7, child care deduction exactly equals after-disregard income.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 9_600  # $800/month gross
      person2:
        age: 3
    spm_units:
      spm_unit:
        members: [person1, person2]
        is_tanf_enrolled: true
        childcare_expenses: 3_600
    households:
      household:
        members: [person1, person2]
        state_code: NH
  output:
    # Recipient: 800 * (1 - 0.75) = 200
    # Child care (full-time, under 6): $200
    # Countable: 200 - 200 = 0
    nh_fanf_countable_earned_income: 0
