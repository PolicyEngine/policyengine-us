# North Dakota TANF Time Limited Percentage (TLP) Deduction Unit Tests
#
# The TLP disregard is applied to earned income AFTER the Standard
# Employment Expense Allowance (SEE). Formula:
#   TLP = max(gross_earned - SEE, 0) * 50%
#
# Where SEE = max(gross_earned * 27%, $180)
#
# Source: https://www.nd.gov/dhs/policymanuals/40019/400_19_145_15.htm

- name: Case 1, zero income results in zero TLP deduction.
  period: 2024-01
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 30
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: ND
  output:
    # Gross earned: $0
    # SEE: max($0 * 0.27, $180) = $180
    # After SEE: max($0 - $180, 0) = $0
    # TLP: $0 * 0.50 = $0
    nd_tanf_time_limited_percentage_deduction: 0

- name: Case 2, low income where SEE exceeds gross (TLP is zero).
  period: 2024-01
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 30
        # Monthly: $100; Annual: $1,200
        employment_income_before_lsr: 1_200
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: ND
  output:
    # Gross earned: $1,200 / 12 = $100
    # SEE: max($100 * 0.27, $180) = max($27, $180) = $180
    # After SEE: max($100 - $180, 0) = $0
    # TLP: $0 * 0.50 = $0
    nd_tanf_time_limited_percentage_deduction: 0

- name: Case 3, income at SEE minimum crossover point ($667).
  period: 2024-01
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 30
        # Monthly: $667; Annual: $8,004
        # At $667, 27% = $180.09 which exceeds minimum
        employment_income_before_lsr: 8_004
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: ND
  output:
    # Gross earned: $8,004 / 12 = $667
    # SEE: max($667 * 0.27, $180) = max($180.09, $180) = $180.09
    # After SEE: max($667 - $180.09, 0) = $486.91
    # TLP: $486.91 * 0.50 = $243.455
    nd_tanf_time_limited_percentage_deduction: 243.455

- name: Case 4, moderate income with percentage SEE.
  period: 2024-01
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 30
        # Monthly: $1,000; Annual: $12,000
        employment_income_before_lsr: 12_000
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: ND
  output:
    # Gross earned: $12,000 / 12 = $1,000
    # SEE: max($1,000 * 0.27, $180) = max($270, $180) = $270
    # After SEE: max($1,000 - $270, 0) = $730
    # TLP: $730 * 0.50 = $365
    nd_tanf_time_limited_percentage_deduction: 365

- name: Case 5, higher income with percentage SEE.
  period: 2024-01
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 30
        # Monthly: $1,500; Annual: $18,000
        employment_income_before_lsr: 18_000
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: ND
  output:
    # Gross earned: $18,000 / 12 = $1,500
    # SEE: max($1,500 * 0.27, $180) = max($405, $180) = $405
    # After SEE: max($1,500 - $405, 0) = $1,095
    # TLP: $1,095 * 0.50 = $547.50
    nd_tanf_time_limited_percentage_deduction: 547.50

- name: Case 6, income exactly at minimum SEE threshold ($500).
  period: 2024-01
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 30
        # Monthly: $500; Annual: $6,000
        employment_income_before_lsr: 6_000
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: ND
  output:
    # Gross earned: $6,000 / 12 = $500
    # SEE: max($500 * 0.27, $180) = max($135, $180) = $180
    # After SEE: max($500 - $180, 0) = $320
    # TLP: $320 * 0.50 = $160
    nd_tanf_time_limited_percentage_deduction: 160

- name: Case 7, multiple earners in household.
  period: 2024-01
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 35
        # Monthly: $1,000; Annual: $12,000
        employment_income_before_lsr: 12_000
      person2:
        age: 33
        # Monthly: $800; Annual: $9,600
        employment_income_before_lsr: 9_600
      person3:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: ND
  output:
    # Combined gross earned: ($12,000 + $9,600) / 12 = $1,800
    # SEE: max($1,800 * 0.27, $180) = max($486, $180) = $486
    # After SEE: max($1,800 - $486, 0) = $1,314
    # TLP: $1,314 * 0.50 = $657
    nd_tanf_time_limited_percentage_deduction: 657
