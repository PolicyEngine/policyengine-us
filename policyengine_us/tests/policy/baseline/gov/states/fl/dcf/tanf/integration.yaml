# Florida TCA Integration Tests
# Comprehensive end-to-end tests for Temporary Cash Assistance program
# Sources: Florida Statutes 414.095, FAC 65A-4

# 2024 FPL values (Contiguous US):
# 1 person: $15,060/year = $1,255/month; 185% = $2,321.75/month
# 2 people: $20,440/year; 185% = $3,151.17/month
# 3 people: $25,820/year; 185% = $3,980.58/month

# Payment Standard Table (>$50 shelter tier):
# Size 2: $241, Size 3: $303, Size 4: $364

- name: Case 1, single parent with one child, zero income, full benefit.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
        rent: 12_000  # $1,000/month (>$50 shelter tier)
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: FL
  output:
    # Income calculations
    fl_tca_countable_earned_income: 0
    # No earned income
    fl_tca_countable_income: 0
    # Total: 0 + 0 = 0

    # Eligibility tests
    fl_tca_gross_income_eligible: true
    # Adjusted gross: 0 < 185% FPL ($3,151) -> Pass
    fl_tca_net_income_eligible: true
    # Countable: 0 < payment standard ($241) -> Pass
    fl_tca_eligible: true

    # Benefit calculation
    fl_tca_payment_standard: 241
    # Size 2, >$50 shelter
    fl_tca: 241
    # Benefit: 241 - 0 = $241

- name: Case 2, single parent with earnings and child.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 6_000  # $500/month
        rent: 12_000
      person2:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: FL
  output:
    # Income calculations
    fl_tca_countable_earned_income: 150
    # Earned: $500/month
    # Disregard: $200 + 50% of (500-200) = $200 + $150 = $350
    # Countable: 500 - 350 = 150 (or: max(500-200,0) * 0.5 = 150)
    fl_tca_countable_income: 150
    # 150 + 0 = 150

    # Eligibility tests
    fl_tca_gross_income_eligible: true
    # Gross: 500 - 90 = 410 < $3,151 -> Pass
    fl_tca_net_income_eligible: true
    # Countable: 150 < 241 -> Pass
    fl_tca_eligible: true

    # Benefit calculation
    fl_tca_payment_standard: 241
    fl_tca: 91
    # Benefit: 241 - 150 = $91

- name: Case 3, family of 3 with zero shelter obligation.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        rent: 0  # Zero shelter tier
      person2:
        age: 10
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: FL
  output:
    fl_tca_countable_income: 0
    fl_tca_gross_income_eligible: true
    fl_tca_net_income_eligible: true
    fl_tca_eligible: true
    fl_tca_payment_standard: 198
    # Size 3, $0 shelter tier -> $198
    fl_tca: 198

- name: Case 4, family of 3 with $25 shelter obligation.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        rent: 300  # $25/month ($1-$50 shelter tier)
      person2:
        age: 10
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: FL
  output:
    fl_tca_countable_income: 0
    fl_tca_gross_income_eligible: true
    fl_tca_net_income_eligible: true
    fl_tca_eligible: true
    fl_tca_payment_standard: 258
    # Size 3, $1-$50 shelter tier -> $258
    fl_tca: 258

- name: Case 5, family of 3 with $100 shelter obligation.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        rent: 1_200  # $100/month (>$50 shelter tier)
      person2:
        age: 10
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: FL
  output:
    fl_tca_countable_income: 0
    fl_tca_gross_income_eligible: true
    fl_tca_net_income_eligible: true
    fl_tca_eligible: true
    fl_tca_payment_standard: 303
    # Size 3, >$50 shelter tier -> $303
    fl_tca: 303

- name: Case 6, income exceeds net income limit but passes gross test.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 12_000  # $1,000/month
        rent: 12_000
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: FL
  output:
    # Income calculations
    fl_tca_countable_earned_income: 400
    # max(1000-200, 0) * 0.5 = 400
    fl_tca_countable_income: 400

    # Eligibility tests
    fl_tca_gross_income_eligible: true
    # 1000 - 90 = 910 < $3,151 -> Pass
    fl_tca_net_income_eligible: false
    # 400 > $241 -> Fail
    fl_tca_eligible: false
    # Failed net test

    # Benefit
    fl_tca_payment_standard: 241
    fl_tca: 0
    # Ineligible -> $0

- name: Case 7, income exceeds gross income limit.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 48_000  # $4,000/month
        rent: 12_000
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: FL
  output:
    fl_tca_countable_earned_income: 1_900
    # max(4000-200, 0) * 0.5 = 1,900
    fl_tca_countable_income: 1_900
    fl_tca_gross_income_eligible: false
    # 4000 - 90 = 3910 > $3,151 -> Fail
    fl_tca_net_income_eligible: false
    # 1900 > $241 -> Also fails
    fl_tca_eligible: false
    fl_tca: 0

- name: Case 8, benefit below $10 minimum.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        social_security: 2_820  # $235/month annual  # Unearned income
        rent: 12_000
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: FL
  output:
    fl_tca_countable_earned_income: 0
    fl_tca_countable_income: 235
    fl_tca_gross_income_eligible: true
    # 235 < $3,151 -> Pass
    fl_tca_net_income_eligible: true
    # 235 < $241 -> Pass
    fl_tca_eligible: true
    fl_tca_payment_standard: 241
    fl_tca: 0
    # Calculated benefit: 241 - 235 = $6
    # $6 < $10 minimum -> $0

- name: Case 9, two parents with two children eligible.
  period: 2024-01
  input:
    people:
      person1:
        age: 35
        employment_income_before_lsr: 3_600  # $300/month
        rent: 12_000
      person2:
        age: 32
      person3:
        age: 10
      person4:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4]
    households:
      household:
        members: [person1, person2, person3, person4]
        state_code: FL
  output:
    fl_tca_countable_earned_income: 50
    # max(300-200, 0) * 0.5 = 50
    fl_tca_countable_income: 50
    fl_tca_gross_income_eligible: true
    # 300 - 90 = 210 < 185% FPL for 4 ($4,810) -> Pass
    fl_tca_net_income_eligible: true
    # 50 < $364 -> Pass
    fl_tca_eligible: true
    fl_tca_payment_standard: 364
    # Size 4, >$50 shelter
    fl_tca: 314
    # 364 - 50 = $314

- name: Case 10, mixed income sources with benefit below minimum.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 4_800  # $400/month
        social_security: 2_400  # $200/month annual
        rent: 12_000
      person2:
        age: 10
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: FL
  output:
    fl_tca_countable_earned_income: 100
    # max(400-200, 0) * 0.5 = 100
    fl_tca_countable_income: 300
    # 100 + 200 = 300
    fl_tca_gross_income_eligible: true
    # (400 - 90) + 200 = 510 < $3,981 -> Pass
    fl_tca_net_income_eligible: true
    # 300 < $303 -> Pass
    fl_tca_eligible: true
    fl_tca_payment_standard: 303
    fl_tca: 0
    # Calculated: 303 - 300 = $3
    # $3 < $10 minimum -> $0

- name: Case 11, larger family size 5 zero income.
  period: 2024-01
  input:
    people:
      person1:
        age: 35
        rent: 12_000
      person2:
        age: 12
      person3:
        age: 10
      person4:
        age: 8
      person5:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5]
    households:
      household:
        members: [person1, person2, person3, person4, person5]
        state_code: FL
  output:
    fl_tca_countable_income: 0
    fl_tca_gross_income_eligible: true
    fl_tca_net_income_eligible: true
    fl_tca_eligible: true
    fl_tca_payment_standard: 426
    # Size 5, >$50 shelter
    fl_tca: 426

# ============================================================
# Edge Case Integration Tests
# ============================================================

- name: Case 12, earned income exactly $200 full disregard.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 2_400  # $200/month exactly
        rent: 12_000
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: FL
  output:
    fl_tca_countable_earned_income: 0
    # max(200-200, 0) * 0.5 = 0
    fl_tca_countable_income: 0
    fl_tca_gross_income_eligible: true
    # 200 - 90 = 110 < $3,151 -> Pass
    fl_tca_net_income_eligible: true
    # 0 < 241 -> Pass
    fl_tca_eligible: true
    fl_tca_payment_standard: 241
    fl_tca: 241
    # Full benefit when earned income exactly at disregard

- name: Case 13, shelter cost exactly at $50 boundary.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        rent: 600  # $50/month exactly
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: FL
  output:
    fl_tca_countable_income: 0
    fl_tca_gross_income_eligible: true
    fl_tca_net_income_eligible: true
    fl_tca_eligible: true
    fl_tca_payment_standard: 205
    # $50 shelter is in $1-$50 tier -> $205
    fl_tca: 205

- name: Case 14, shelter cost $51 crosses to high tier.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        rent: 612  # $51/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: FL
  output:
    fl_tca_countable_income: 0
    fl_tca_gross_income_eligible: true
    fl_tca_net_income_eligible: true
    fl_tca_eligible: true
    fl_tca_payment_standard: 241
    # $51 shelter is in >$50 tier -> $241
    fl_tca: 241

- name: Case 15, benefit exactly at $10 minimum.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        social_security: 2_772  # $231/month annual
        rent: 12_000
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: FL
  output:
    fl_tca_countable_earned_income: 0
    fl_tca_countable_income: 231
    fl_tca_gross_income_eligible: true
    fl_tca_net_income_eligible: true
    # 231 < 241 -> Pass
    fl_tca_eligible: true
    fl_tca_payment_standard: 241
    fl_tca: 10
    # 241 - 231 = $10 (exactly at minimum)

- name: Case 16, benefit $9 below minimum.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        social_security: 2_784  # $232/month annual
        rent: 12_000
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: FL
  output:
    fl_tca_countable_earned_income: 0
    fl_tca_countable_income: 232
    fl_tca_gross_income_eligible: true
    fl_tca_net_income_eligible: true
    fl_tca_eligible: true
    fl_tca_payment_standard: 241
    fl_tca: 0
    # 241 - 232 = $9 < $10 minimum -> $0

- name: Case 17, multiple earners with varying income.
  period: 2024-01
  input:
    people:
      person1:
        age: 35
        employment_income_before_lsr: 3_600  # $300/month
        rent: 12_000
      person2:
        age: 33
        employment_income_before_lsr: 2_400  # $200/month
      person3:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: FL
  output:
    fl_tca_countable_earned_income: 150
    # Combined: 300 + 200 = 500
    # Countable: max(500-200, 0) * 0.5 = 150
    fl_tca_countable_income: 150
    fl_tca_gross_income_eligible: true
    # Per-earner $90 deduction:
    # Person1: max(300-90, 0) = 210
    # Person2: max(200-90, 0) = 110
    # Adjusted: 210 + 110 = 320 < $3,981 -> Pass
    fl_tca_net_income_eligible: true
    # 150 < 303 -> Pass
    fl_tca_eligible: true
    fl_tca_payment_standard: 303
    fl_tca: 153
    # 303 - 150 = $153

- name: Case 18, assets at limit with income.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 3_600  # $300/month
        rent: 12_000
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 2_000  # Exactly at limit
    households:
      household:
        members: [person1, person2]
        state_code: FL
  output:
    fl_tca_countable_earned_income: 50
    # max(300-200, 0) * 0.5 = 50
    fl_tca_countable_income: 50
    fl_tca_resource_eligible: true
    # 2,000 <= 2,000 -> Pass
    fl_tca_gross_income_eligible: true
    fl_tca_net_income_eligible: true
    fl_tca_eligible: true
    fl_tca_payment_standard: 241
    fl_tca: 191
    # 241 - 50 = $191

- name: Case 19, assets over limit ineligible.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        rent: 12_000
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 2_001  # One dollar over limit
    households:
      household:
        members: [person1, person2]
        state_code: FL
  output:
    fl_tca_countable_income: 0
    fl_tca_resource_eligible: false
    # 2,001 > 2,000 -> Fail
    fl_tca_gross_income_eligible: true
    fl_tca_net_income_eligible: true
    fl_tca_eligible: false
    # Failed resource test
    fl_tca: 0
