# Nebraska ADC Edge Case Tests
# Auto-generated edge case tests for comprehensive boundary coverage
#
# Key Formulas:
#   Need Standard: Lookup by family size (1-14), capped at 14
#   Payment Standard: Need Standard * 0.55
#   Countable Earned: Gross Earned * 0.50 (50% disregard)
#   Income Eligible: (countable_earned + unearned) < need_standard
#   Resources Eligible: resources <= limit ($4,000 for 1, $6,000 for 2+)
#   Maximum Benefit: min(gap, payment_standard) where gap = need_standard - countable_earned
#   Final Benefit: max(max_benefit - unearned, 0)
#   Minimum Rule: If final_benefit < $10, return $0

# =============================================================================
# INCOME BOUNDARY TESTS
# =============================================================================

- name: Case 1, income exactly at need standard threshold is ineligible.
  # Tests strict less-than comparison: countable_income < need_standard
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 17_784  # $1,482/month -> $741 countable
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_need_standard: 741
    ne_adc_countable_earned_income: 741
    # Gross: $17,784/12 = $1,482/month
    # After 50% disregard: $1,482 * 0.50 = $741
    ne_adc_income_eligible: false
    # Countable ($741) < Need Standard ($741) -> false (not strictly less)
    ne_adc_eligible: false
    ne_adc: 0

- name: Case 2, income one dollar below need standard threshold.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 17_760  # $1,480/month -> $740 countable
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_need_standard: 741
    ne_adc_countable_earned_income: 740
    # Gross: $17,760/12 = $1,480/month
    # After 50% disregard: $1,480 * 0.50 = $740
    ne_adc_income_eligible: true
    # Countable ($740) < Need Standard ($741) -> true
    ne_adc_eligible: true

- name: Case 3, income one dollar above need standard threshold.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 17_808  # $1,484/month -> $742 countable
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_need_standard: 741
    ne_adc_countable_earned_income: 742
    # Gross: $17,808/12 = $1,484/month
    # After 50% disregard: $1,484 * 0.50 = $742
    ne_adc_income_eligible: false
    # Countable ($742) < Need Standard ($741) -> false
    ne_adc_eligible: false
    ne_adc: 0

# =============================================================================
# RESOURCE BOUNDARY TESTS - SINGLE PERSON ($4,000 limit)
# =============================================================================

- name: Case 4, resources exactly at $4,000 limit for single person.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_assets: 4_000
    households:
      household:
        members: [person1]
        state_code: NE
  output:
    spm_unit_size: 1
    ne_adc_resources_eligible: true
    # Resources ($4,000) <= Limit ($4,000) -> true

- name: Case 5, resources one dollar above $4,000 limit for single person.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_assets: 4_001
    households:
      household:
        members: [person1]
        state_code: NE
  output:
    spm_unit_size: 1
    ne_adc_resources_eligible: false
    # Resources ($4,001) <= Limit ($4,000) -> false
    ne_adc_eligible: false

# =============================================================================
# RESOURCE BOUNDARY TESTS - TWO+ PERSONS ($6,000 limit)
# =============================================================================

- name: Case 6, resources exactly at $6,000 limit for family of 2.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 6_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    spm_unit_size: 2
    ne_adc_resources_eligible: true
    # Resources ($6,000) <= Limit ($6,000) -> true
    ne_adc_eligible: true

- name: Case 7, resources one dollar above $6,000 limit for family of 2.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 6_001
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    spm_unit_size: 2
    ne_adc_resources_eligible: false
    # Resources ($6,001) <= Limit ($6,000) -> false
    ne_adc_eligible: false

# =============================================================================
# ZERO VALUE TESTS
# =============================================================================

- name: Case 8, zero earned income.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_countable_earned_income: 0
    ne_adc_income_eligible: true
    ne_adc_eligible: true

- name: Case 9, zero resources.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 0
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_resources_eligible: true
    # Resources ($0) <= Limit ($6,000) -> true
    ne_adc_eligible: true

# =============================================================================
# FAMILY SIZE BOUNDARY TESTS
# =============================================================================

- name: Case 10, minimum family size of 1.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1]
        state_code: NE
  output:
    spm_unit_size: 1
    ne_adc_need_standard: 601
    # Need standard for size 1 = $601
    ne_adc_payment_standard: 331
    # Payment standard = $601 * 0.55 = $330.55, rounded up to $331

- name: Case 11, maximum family size of 14.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 35
      person2:
        age: 33
      person3:
        age: 17
      person4:
        age: 16
      person5:
        age: 15
      person6:
        age: 14
      person7:
        age: 13
      person8:
        age: 12
      person9:
        age: 11
      person10:
        age: 10
      person11:
        age: 9
      person12:
        age: 8
      person13:
        age: 7
      person14:
        age: 6
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10, person11, person12, person13, person14]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10, person11, person12, person13, person14]
        state_code: NE
  output:
    spm_unit_size: 14
    ne_adc_need_standard: 2_421
    # Need standard for size 14 = $2,421
    ne_adc_payment_standard: 1_332
    # Payment standard = $2,421 * 0.55 = $1,331.55, rounded up to $1,332

- name: Case 12, family size 15 exceeds parameter table caps at 14.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 35
      person2:
        age: 33
      person3:
        age: 17
      person4:
        age: 16
      person5:
        age: 15
      person6:
        age: 14
      person7:
        age: 13
      person8:
        age: 12
      person9:
        age: 11
      person10:
        age: 10
      person11:
        age: 9
      person12:
        age: 8
      person13:
        age: 7
      person14:
        age: 6
      person15:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10, person11, person12, person13, person14, person15]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10, person11, person12, person13, person14, person15]
        state_code: NE
  output:
    spm_unit_size: 15
    ne_adc_need_standard: 2_421
    # Size 15 capped to 14, need standard for size 14 = $2,421
    ne_adc_payment_standard: 1_332
    # Payment standard = $2,421 * 0.55 = $1,331.55, rounded up to $1,332

# =============================================================================
# MINIMUM PAYMENT RULE TESTS
# =============================================================================

- name: Case 13, benefit exactly at $10 minimum threshold.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
        social_security: 3_846.60  # $320.55/month unearned
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_need_standard: 741
    ne_adc_payment_standard: 408
    # Payment standard = $741 * 0.55 = $407.55, rounded up to $408
    ne_adc_maximum_benefit: 408
    # Gap = $741 - $0 = $741
    # Benefit = min($741, $408) = $408
    ne_adc: 87.45
    # Final = $408 - $320.55 = $87.45
    # $87.45 >= $10 minimum -> $87.45

- name: Case 14, benefit below $10 minimum rounds up to $10.
  # Per Neb. Rev. Stat. 43-512: no payments less than $10/month
  # If benefit > 0 but < $10, return $10
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
        social_security: 4_800  # $400/month unearned
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_need_standard: 741
    ne_adc_payment_standard: 408
    # Payment standard = $741 * 0.55 = $407.55, rounded up to $408
    ne_adc_maximum_benefit: 408
    ne_adc: 10
    # Final = $408 - $400 = $8
    # $8 < $10 minimum, but > $0 -> rounds up to $10

- name: Case 15, calculated benefit of $5 is below minimum rounds up to $10.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
        social_security: 4_836  # $403/month unearned
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_payment_standard: 408
    # Payment standard = $741 * 0.55 = $407.55, rounded up to $408
    ne_adc_maximum_benefit: 408
    ne_adc: 10
    # Final = $408 - $403 = $5
    # $5 < $10 minimum, but > $0 -> rounds up to $10

- name: Case 16, zero benefit from ineligibility stays zero not minimum.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 24_000  # $2,000/month -> $1,000 countable
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_need_standard: 741
    ne_adc_countable_earned_income: 1_000
    ne_adc_income_eligible: false
    # Countable ($1,000) >= Need Standard ($741) -> ineligible
    ne_adc_eligible: false
    ne_adc: 0
    # Zero from ineligibility, not from minimum payment rule

# =============================================================================
# GAP BUDGETING EDGE CASES
# =============================================================================

- name: Case 17, gap less than payment standard benefit equals gap.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 8_400  # $700/month -> $350 countable
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_need_standard: 741
    ne_adc_payment_standard: 408
    # Payment standard = $741 * 0.55 = $407.55 ~ $408
    ne_adc_countable_earned_income: 350
    # Gross = $700, after 50% disregard = $350
    ne_adc_maximum_benefit: 391
    # Gap = $741 - $350 = $391
    # Benefit = min($391, $408) = $391 (gap < payment standard)
    ne_adc: 391
    # Final = $391 - $0 = $391

- name: Case 18, gap greater than payment standard benefit equals payment standard.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_need_standard: 741
    ne_adc_payment_standard: 408
    ne_adc_countable_earned_income: 0
    ne_adc_maximum_benefit: 408
    # Gap = $741 - $0 = $741
    # Benefit = min($741, $408) = $408 (gap > payment standard)
    ne_adc: 408
    # Final = $408 - $0 = $408

- name: Case 19, gap equals payment standard exactly.
  # Need to find earned income where gap = payment_standard
  # For size 2: need_standard = $741, payment_standard = $407.55
  # Gap = need_standard - countable_earned = payment_standard
  # $741 - countable = $407.55
  # countable = $333.45
  # gross * 0.50 = $333.45 -> gross = $666.90/month = $8,002.80/year
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 8_004  # $667/month -> $333.50 countable
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_need_standard: 741
    ne_adc_payment_standard: 408
    ne_adc_countable_earned_income: 333.5
    # Gross = $667, after 50% disregard = $333.50
    ne_adc_maximum_benefit: 407.5
    # Gap = $741 - $333.50 = $407.50
    # Benefit = min($407.50, $407.55) = $407.50 (gap ~ payment standard)
    ne_adc: 407.5
    # Final = $407.50 - $0 = $407.50

# =============================================================================
# EARNED INCOME DISREGARD EDGE CASES
# =============================================================================

- name: Case 20, very small earned income disregard applied.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 24  # $2/month gross
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_countable_earned_income: 1
    # Gross = $2, after 50% disregard = $1
    ne_adc_income_eligible: true

- name: Case 21, large earned income 50 percent disregard.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 60_000  # $5,000/month gross
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_countable_earned_income: 2_500
    # Gross = $5,000, after 50% disregard = $2,500
    ne_adc_income_eligible: false
    # Countable ($2,500) >= Need Standard ($741) -> ineligible
    ne_adc_eligible: false

# =============================================================================
# UNEARNED INCOME EDGE CASES
# =============================================================================

- name: Case 22, unearned income exactly wipes out max benefit.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
        social_security: 4_896  # $408/month unearned = payment standard
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_payment_standard: 408
    ne_adc_maximum_benefit: 408
    # Gap = $741 - $0 = $741
    # Benefit = min($741, $408) = $408
    ne_adc: 0
    # Final = $408 - $408 = $0
    # Would be $0 anyway (no negative benefits)

- name: Case 23, unearned income exceeds max benefit no negative.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
        social_security: 6_000  # $500/month unearned > payment standard
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_payment_standard: 408
    ne_adc_maximum_benefit: 408
    ne_adc: 0
    # Final = $408 - $500 = -$92 -> $0 (no negative benefits)

# =============================================================================
# MIXED INCOME BOUNDARY TESTS
# =============================================================================

- name: Case 24, mixed income exactly at threshold.
  # Countable = earned_after_disregard + unearned = need_standard
  # For size 3: need_standard = $881
  # Say earned = $600/month -> countable_earned = $300
  # Need unearned = $881 - $300 = $581, but that makes countable >= need_standard
  # For strict <, need total < $881
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 8_400  # $700/month -> $350 countable earned
        social_security: 6_372  # $531/month unearned
      person2:
        age: 10
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2, person3]
        state_code: NE
  output:
    ne_adc_need_standard: 881
    ne_adc_countable_earned_income: 350
    # Gross = $700, after 50% disregard = $350
    ne_adc_income_eligible: false
    # Total countable = $350 + $531 = $881
    # Countable ($881) < Need Standard ($881) -> false
    ne_adc_eligible: false

# =============================================================================
# RESOURCE BOUNDARY TESTS - ONE DOLLAR BELOW THRESHOLD
# =============================================================================

- name: Case 25, resources one dollar below $4,000 limit for single person.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_assets: 3_999
    households:
      household:
        members: [person1]
        state_code: NE
  output:
    spm_unit_size: 1
    ne_adc_resources_eligible: true
    # Resources ($3,999) <= Limit ($4,000) -> true

- name: Case 26, resources one dollar below $6,000 limit for family of 2.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 5_999
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    spm_unit_size: 2
    ne_adc_resources_eligible: true
    # Resources ($5,999) <= Limit ($6,000) -> true
    ne_adc_eligible: true

# =============================================================================
# DEMOGRAPHIC ELIGIBILITY EDGE CASES
# =============================================================================

- name: Case 27, household with only adults fails demographic eligibility.
  # Two adults (ages 30 and 35) with no children or pregnant persons
  # Fails is_demographic_tanf_eligible because no one meets age limit
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        is_pregnant: false
        employment_income_before_lsr: 0
      person2:
        age: 35
        is_pregnant: false
        employment_income_before_lsr: 0
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    is_demographic_tanf_eligible: false
    # No eligible children (both adults over age limit) and no pregnant persons
    ne_adc_eligible: false
    # Fails demographic eligibility even if income/resources pass
    ne_adc: 0

# =============================================================================
# STATE RESIDENCY EDGE CASES
# =============================================================================

- name: Case 28, non-Nebraska state returns zero benefit.
  # Family in Texas should get zero Nebraska ADC benefit
  # The defined_for = StateCode.NE constraint applies
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: TX
  output:
    ne_adc: 0
    # Family in Texas, not Nebraska -> ne_adc benefit is $0
