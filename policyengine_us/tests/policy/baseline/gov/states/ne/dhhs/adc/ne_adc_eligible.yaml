# Nebraska ADC Eligibility Tests
# Eligibility requires:
# 1. Net earned income (after disregard) < Need Standard
#    - Initial applicants: 20% disregard (countable = 80%)
#    - Ongoing recipients: 50% disregard (countable = 50%)
# 2. Resources within limits ($4,000 for 1 person, $6,000 for 2+)
#
# NOTE: These tests model ONGOING recipients (is_tanf_enrolled: true)
#       who receive the 50% earned income disregard.

- name: Case 1, no income is eligible.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_cash_assets: 1_000
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_income_eligible: true
    # Countable income ($0) < Need standard ($741)
    ne_adc_eligible: true

- name: Case 2, income below threshold is eligible.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 12_000  # $1,000/month gross
      person2:
        age: 10
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_cash_assets: 2_000
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2, person3]
        state_code: NE
  output:
    ne_adc_countable_earned_income: 500
    # After 50% disregard: $1,000 * 0.50 = $500
    # Countable income = $500
    ne_adc_income_eligible: true
    # Countable income ($500) < Need standard ($881)
    ne_adc_eligible: true

- name: Case 3, income above threshold is ineligible.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 24_000  # $2,000/month gross
      person2:
        age: 10
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_cash_assets: 1_000
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2, person3]
        state_code: NE
  output:
    ne_adc_countable_earned_income: 1_000
    # After 50% disregard: $2,000 * 0.50 = $1,000
    # Countable income = $1,000
    ne_adc_income_eligible: false
    # Countable income ($1,000) > Need standard ($881)
    ne_adc_eligible: false

- name: Case 4, income exactly at threshold.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 17_640  # $1,470/month -> $735 countable
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_cash_assets: 1_000
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_countable_earned_income: 735
    # After 50% disregard: $1,470 * 0.50 = $735
    # Countable income = $735
    ne_adc_income_eligible: true
    # Countable income ($735) < Need standard ($741)
    ne_adc_eligible: true

- name: Case 5, income just above threshold.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 17_880  # $1,490/month -> $745 countable
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_cash_assets: 1_000
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_countable_earned_income: 745
    # After 50% disregard: $1,490 * 0.50 = $745
    # Countable income = $745
    ne_adc_income_eligible: false
    # Countable income ($745) > Need standard ($741)
    ne_adc_eligible: false

# =============================================================================
# EDGE CASES - RESOURCE BOUNDARIES (SINGLE PERSON $4,000 LIMIT)
# =============================================================================

- name: Edge case, resources exactly at $4,000 limit for single person.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_assets: 4_000
    households:
      household:
        members: [person1]
        state_code: NE
  output:
    spm_unit_size: 1
    ne_adc_resources_eligible: true
    # Resources ($4,000) <= Limit ($4,000) -> true

- name: Edge case, resources one dollar above $4,000 limit for single person.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_assets: 4_001
    households:
      household:
        members: [person1]
        state_code: NE
  output:
    spm_unit_size: 1
    ne_adc_resources_eligible: false
    # Resources ($4,001) <= Limit ($4,000) -> false
    ne_adc_eligible: false

- name: Edge case, resources one dollar below $4,000 limit for single person.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_assets: 3_999
    households:
      household:
        members: [person1]
        state_code: NE
  output:
    spm_unit_size: 1
    ne_adc_resources_eligible: true
    # Resources ($3,999) <= Limit ($4,000) -> true

# =============================================================================
# EDGE CASES - RESOURCE BOUNDARIES (TWO+ PERSONS $6,000 LIMIT)
# =============================================================================

- name: Edge case, resources exactly at $6,000 limit for family of 2.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 6_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    spm_unit_size: 2
    ne_adc_resources_eligible: true
    # Resources ($6,000) <= Limit ($6,000) -> true
    ne_adc_eligible: true

- name: Edge case, resources one dollar above $6,000 limit for family of 2.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 6_001
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    spm_unit_size: 2
    ne_adc_resources_eligible: false
    # Resources ($6,001) <= Limit ($6,000) -> false
    ne_adc_eligible: false

- name: Edge case, resources one dollar below $6,000 limit for family of 2.
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 5_999
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    spm_unit_size: 2
    ne_adc_resources_eligible: true
    # Resources ($5,999) <= Limit ($6,000) -> true
    ne_adc_eligible: true

# =============================================================================
# EDGE CASES - DEMOGRAPHIC ELIGIBILITY
# =============================================================================

- name: Edge case, household with only adults fails demographic eligibility.
  # Two adults (ages 30 and 35) with no children or pregnant persons
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        is_pregnant: false
        employment_income_before_lsr: 0
      person2:
        age: 35
        is_pregnant: false
        employment_income_before_lsr: 0
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    is_demographic_tanf_eligible: false
    # No eligible children (both adults over age limit) and no pregnant persons
    ne_adc_eligible: false
    ne_adc: 0
