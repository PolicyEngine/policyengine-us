# Nebraska ADC Eligibility Tests
# Eligibility requires:
# 1. Demographic eligibility (children or pregnant)
# 2. Immigration eligibility (citizen or legal immigrant)
# 3. Income eligibility (countable income < need standard)
# 4. Resource eligibility ($4,000 for 1 person, $6,000 for 2+)
#
# NOTE: These tests focus on COMBINED eligibility checks.
# Individual component tests are in their respective files.

- name: Case 1, no income is eligible.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_cash_assets: 1_000
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_income_eligible: true
    ne_adc_resources_eligible: true
    ne_adc_eligible: true

- name: Case 2, income ineligible fails overall.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 24_000  # $2,000/month -> $1,000 countable
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_cash_assets: 1_000
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_income_eligible: false
    ne_adc_resources_eligible: true
    ne_adc_eligible: false

- name: Case 3, resources ineligible fails overall.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 7_000  # Above $6,000 limit
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_income_eligible: true
    ne_adc_resources_eligible: false
    ne_adc_eligible: false

# =============================================================================
# EDGE CASES - INITIAL VS ONGOING RECIPIENT DISREGARD
# =============================================================================

- name: Edge case, initial applicant fails but ongoing recipient would pass.
  # Same income: initial applicant (80% countable) fails, ongoing (50% countable) passes
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 14_400  # $1,200/month gross
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_cash_assets: 1_000
        is_tanf_enrolled: false  # Initial applicant
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_countable_earned_income: 960
    # After 20% disregard: $1,200 * 0.80 = $960
    ne_adc_income_eligible: false
    # Countable ($960) > Need Standard ($741) -> FAILS
    ne_adc_eligible: false

- name: Edge case, ongoing recipient passes with same income as failing initial applicant.
  # Same income as above: ongoing recipient (50% countable) passes
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 14_400  # $1,200/month gross
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_cash_assets: 1_000
        is_tanf_enrolled: true  # Ongoing recipient
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_countable_earned_income: 600
    # After 50% disregard: $1,200 * 0.50 = $600
    ne_adc_income_eligible: true
    # Countable ($600) < Need Standard ($741) -> PASSES
    ne_adc_eligible: true

# =============================================================================
# EDGE CASES - DEMOGRAPHIC ELIGIBILITY
# =============================================================================

- name: Edge case, household with only adults fails demographic eligibility.
  # Two adults (ages 30 and 35) with no children or pregnant persons
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        is_pregnant: false
        employment_income_before_lsr: 0
      person2:
        age: 35
        is_pregnant: false
        employment_income_before_lsr: 0
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    is_demographic_tanf_eligible: false
    # No eligible children (both adults over age limit) and no pregnant persons
    ne_adc_eligible: false
    ne_adc: 0
