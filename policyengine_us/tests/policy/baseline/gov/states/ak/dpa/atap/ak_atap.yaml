# Unit tests for Alaska ATAP final benefit amount
# 7 AAC 45.525 - Determining the amount of payment
# https://www.law.cornell.edu/regulations/alaska/7-AAC-45.525
# Formula: (Need Standard - Countable Income) * (Max Payment / Need Standard)
# The ratio (Max Payment / Need Standard) is the "ratable reduction" (~43% for 2026)

- name: Ineligible receives zero
  period: 2026-01
  input:
    people:
      adult:
        age: 30
      child1:
        age: 5
    spm_units:
      spm_unit:
        members: [adult, child1]
        ak_atap_eligible: false
        ak_atap_need_standard: 1_908
        ak_atap_countable_income: 0
        ak_atap_maximum_payment: 821
    households:
      household:
        members: [adult, child1]
        state_code: AK
  output:
    ak_atap: 0

- name: Zero income receives maximum payment
  period: 2026-01
  input:
    people:
      adult:
        age: 30
      child1:
        age: 5
    spm_units:
      spm_unit:
        members: [adult, child1]
        ak_atap_eligible: true
        ak_atap_need_standard: 1_908
        ak_atap_countable_income: 0
        ak_atap_maximum_payment: 821
    households:
      household:
        members: [adult, child1]
        state_code: AK
  output:
    # ($1,908 - $0) * ($821 / $1,908) = $1,908 * 0.4303 = $821
    ak_atap: 821

- name: Partial income reduces benefit
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      adult:
        age: 30
      child1:
        age: 5
    spm_units:
      spm_unit:
        members: [adult, child1]
        ak_atap_eligible: true
        ak_atap_need_standard: 1_908
        ak_atap_countable_income: 1_000
    households:
      household:
        members: [adult, child1]
        state_code: AK
  output:
    # ($1,908 - $1,000) * ($821 / $1,908) = $908 * 0.4303 = $390.67
    ak_atap: 390.67

- name: Income at need standard receives zero
  period: 2026-01
  input:
    people:
      adult:
        age: 30
      child1:
        age: 5
    spm_units:
      spm_unit:
        members: [adult, child1]
        ak_atap_eligible: true
        ak_atap_need_standard: 1_908
        ak_atap_countable_income: 1_908
        ak_atap_maximum_payment: 821
    households:
      household:
        members: [adult, child1]
        state_code: AK
  output:
    # ($1,908 - $1,908) * ratio = $0
    ak_atap: 0

- name: Family of 3 zero income
  period: 2026-01
  input:
    people:
      adult:
        age: 30
      child1:
        age: 8
      child2:
        age: 5
    spm_units:
      spm_unit:
        members: [adult, child1, child2]
        ak_atap_eligible: true
        ak_atap_need_standard: 2_149
        ak_atap_countable_income: 0
        ak_atap_maximum_payment: 923
    households:
      household:
        members: [adult, child1, child2]
        state_code: AK
  output:
    # ($2,149 - $0) * ($923 / $2,149) = $2,149 * 0.4295 = $923
    ak_atap: 923

- name: Family of 3 with $500 countable income
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      adult:
        age: 30
      child1:
        age: 8
      child2:
        age: 5
    spm_units:
      spm_unit:
        members: [adult, child1, child2]
        ak_atap_eligible: true
        ak_atap_need_standard: 2_149
        ak_atap_countable_income: 500
        ak_atap_maximum_payment: 923
    households:
      household:
        members: [adult, child1, child2]
        state_code: AK
  output:
    # ($2,149 - $500) * ($923 / $2,149) = $1,649 * 0.4295 = $708.26
    ak_atap: 708.26
