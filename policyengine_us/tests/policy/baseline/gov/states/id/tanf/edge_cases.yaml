# Idaho TAFI Edge Case Tests
# Comprehensive boundary and edge case testing per IDAPA 16.03.08
# These tests verify correct behavior at critical boundaries

# ============================================================================
# MINIMUM PAYMENT THRESHOLD EDGE CASES ($10)
# Per IDAPA 16.03.08.254: "When the grant amount is less than ten dollars
# ($10), a payment is not made"
# ============================================================================

- name: Case 1, grant exactly at $9 minimum threshold minus one.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        social_security: 3_600  # $300/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: ID
  output:
    id_tafi_grant_standard: 9
    # Unearned only: 309 - 300 = 9
    id_tafi: 0
    # $9 < $10 minimum -> no payment

- name: Case 2, grant exactly at $11 minimum threshold plus one.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        social_security: 3_576  # $298/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: ID
  output:
    id_tafi_grant_standard: 11
    # Unearned only: 309 - 298 = 11
    id_tafi: 11
    # $11 >= $10 minimum -> payment made

- name: Case 3, grant exactly at $10 threshold.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        social_security: 3_588  # $299/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: ID
  output:
    id_tafi_grant_standard: 10
    # Unearned only: 309 - 299 = 10
    id_tafi: 10
    # $10 >= $10 minimum -> payment made

# ============================================================================
# MAXIMUM GRANT CAP EDGE CASES ($309)
# Per IDAPA 16.03.08.248: Maximum Grant Amount is $309
# ============================================================================

- name: Case 4, grant exactly at maximum cap no capping needed.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: ID
  output:
    id_tafi_grant_standard: 309
    # No income -> Maximum Grant = $309
    id_tafi: 309
    # Grant exactly at cap -> no capping needed

- name: Case 5, grant one dollar over cap must be capped.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 600  # $50/month
      person2:
        age: 10
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: ID
  output:
    id_tafi_work_incentive_amount: 389
    id_tafi_countable_earned_income: 30
    # 50 * 0.60 = 30
    id_tafi_grant_standard: 359
    # Work Incentive: 389 - 30 = 359
    id_tafi: 309
    # $359 > $309 cap -> capped at 309

- name: Case 6, grant well over cap large family.
  period: 2025-01
  input:
    people:
      person1:
        age: 35
      person2:
        age: 33
      person3:
        age: 16
      person4:
        age: 14
      person5:
        age: 12
      person6:
        age: 10
      person7:
        age: 8
      person8:
        age: 6
      person9:
        age: 4
      person10:
        age: 2
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10]
    households:
      household:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10]
        state_code: ID
  output:
    id_tafi_work_incentive_amount: 947
    # Size 10 -> $947
    id_tafi_grant_standard: 309
    # No income -> would get max grant ($309), not work incentive
    id_tafi: 309

# ============================================================================
# ZERO INCOME SCENARIOS
# ============================================================================

- name: Case 7, family of 2 with zero income.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: ID
  output:
    id_tafi_countable_earned_income: 0
    id_tafi_countable_unearned_income: 0
    id_tafi_grant_standard: 309
    id_tafi: 309

- name: Case 8, family with explicit zero income values.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
        social_security: 0
        child_support_received: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: ID
  output:
    id_tafi_countable_earned_income: 0
    id_tafi_countable_unearned_income: 0
    id_tafi_grant_standard: 309
    id_tafi: 309

# ============================================================================
# VERY HIGH INCOME -> ZERO BENEFIT
# ============================================================================

- name: Case 9, extremely high earned income zero benefit.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 60_000  # $5,000/month
      person2:
        age: 10
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: ID
  output:
    id_tafi_countable_earned_income: 3_000
    # $5,000 * 0.60 = $3,000
    id_tafi_grant_standard: -2_611
    # Work Incentive: 389 - 3,000 = -2,611
    id_tafi: 0
    # Floored to 0, below minimum

- name: Case 10, very high unearned income zero benefit.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        social_security: 12_000  # $1,000/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: ID
  output:
    id_tafi_countable_unearned_income: 1_000
    id_tafi_grant_standard: -691
    # Unearned only: 309 - 1,000 = -691
    id_tafi: 0
    # Floored to 0, below minimum

# ============================================================================
# ROUNDING EDGE CASES
# Per IDAPA 16.03.08.252: Grant is rounded down to next lowest dollar
# ============================================================================

- name: Case 11, grant with fractional cents rounds down.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 4_440  # $370/month
      person2:
        age: 10
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: ID
  output:
    id_tafi_countable_earned_income: 222
    # $370 * 0.60 = $222
    id_tafi_grant_standard: 167
    # Work Incentive: 389 - 222 = 167
    id_tafi: 167

# ============================================================================
# RESOURCES INELIGIBILITY COMBINED WITH INCOME
# ============================================================================

- name: Case 12, income eligible but resources ineligible.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 10_000  # Over $5,000 limit
    households:
      household:
        members: [person1, person2]
        state_code: ID
  output:
    id_tafi_resources_eligible: false
    id_tafi_grant_standard: 309
    # Would qualify income-wise
    id_tafi: 0
    # But resources over limit -> no benefit

# ============================================================================
# LARGE HOUSEHOLD WITH INCOME EDGE CASES
# ============================================================================

- name: Case 13, size 11 household with earned income.
  period: 2025-01
  input:
    people:
      person1:
        age: 35
        employment_income_before_lsr: 6_000  # $500/month
      person2:
        age: 33
      person3:
        age: 17
      person4:
        age: 15
      person5:
        age: 13
      person6:
        age: 11
      person7:
        age: 9
      person8:
        age: 7
      person9:
        age: 5
      person10:
        age: 3
      person11:
        age: 1
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10, person11]
    households:
      household:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10, person11]
        state_code: ID
  output:
    id_tafi_work_incentive_amount: 1_027
    # Size 11: 947 + 80 = 1,027
    id_tafi_countable_earned_income: 300
    # 500 * 0.60 = 300
    id_tafi_grant_standard: 727
    # 1,027 - 300 = 727
    id_tafi: 309
    # Capped at maximum $309

- name: Case 14, size 12 household with high income still ineligible.
  period: 2025-01
  input:
    people:
      person1:
        age: 40
        employment_income_before_lsr: 24_000  # $2,000/month
      person2:
        age: 38
      person3:
        age: 17
      person4:
        age: 16
      person5:
        age: 14
      person6:
        age: 12
      person7:
        age: 10
      person8:
        age: 8
      person9:
        age: 6
      person10:
        age: 4
      person11:
        age: 2
      person12:
        age: 0
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10, person11, person12]
    households:
      household:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10, person11, person12]
        state_code: ID
  output:
    id_tafi_work_incentive_amount: 1_107
    # Size 12: 947 + (80 * 2) = 1,107
    id_tafi_countable_earned_income: 1_200
    # 2,000 * 0.60 = 1,200
    id_tafi_grant_standard: -93
    # 1,107 - 1,200 = -93
    id_tafi: 0
    # Floored to 0, below minimum

# ============================================================================
# MIXED INCOME BOUNDARY CONDITIONS
# ============================================================================

- name: Case 15, earned income triggers work incentive over unearned only path.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 12  # $1/month
        social_security: 3_000  # $250/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: ID
  output:
    id_tafi_countable_earned_income: 0.6
    # 1 * 0.60 = 0.6
    id_tafi_countable_unearned_income: 250
    id_tafi_work_incentive_amount: 309
    id_tafi_grant_standard: 58.4
    # Work Incentive path: 309 - 0.6 - 250 = 58.4
    id_tafi: 58
    # Floored to 58
