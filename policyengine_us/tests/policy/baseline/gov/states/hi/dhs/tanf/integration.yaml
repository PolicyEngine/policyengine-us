# Integration tests for Hawaii TANF
# Tests the complete pipeline from gross income through benefit calculation
#
# Hawaii TANF Key Values:
# - Standard of Need (SON): 100% of 2006 Hawaii FPL (frozen)
# - Gross Income Limit: 185% of SON
# - Reduced Standard of Assistance (SOA): 80% of full SOA (48% of SON)
#
# Income Standards by Household Size:
# | Size | SON    | Gross Limit (185%) | Reduced SOA |
# |------|--------|-------------------|-------------|
# | 1    | $939   | $1,737            | $360        |
# | 2    | $1,265 | $2,340            | $485        |
# | 3    | $1,590 | $2,941            | $610        |
# | 4    | $1,916 | $3,544            | $735        |
# | 5    | $2,242 | $4,147            | $860        |
#
# Earned Income Deductions (applied in order):
# 1. 20% standard deduction from gross earned
# 2. $200 flat rate deduction
# 3. 55% earned income disregard
#
# Source: HRS Section 346-53; Hawaii TANF State Plan

- name: Case 1, family of 2 with no income gets maximum benefit.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        tanf_gross_earned_income: 0
        tanf_gross_unearned_income: 0
      person2:
        age: 5
        is_tax_unit_dependent: true
        tanf_gross_earned_income: 0
        tanf_gross_unearned_income: 0
    spm_units:
      spm_unit:
        members: [person1, person2]
    tax_units:
      tax_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: HI
  output:
    hi_tanf_gross_income: 0
    hi_tanf_gross_income_eligible: true
    hi_tanf_countable_earned_income: 0
    hi_tanf_countable_income: 0
    # 1265 × 0.48 × 0.80 = 485.76
    hi_tanf_maximum_benefit: 485.76
    hi_tanf_eligible: true
    hi_tanf: 485.76

- name: Case 2, single parent with child, moderate earned income.
  period: 2024-01
  input:
    people:
      person1:
        age: 28
        tanf_gross_earned_income: 1_500
        tanf_gross_unearned_income: 0
      person2:
        age: 8
        is_tax_unit_dependent: true
        tanf_gross_earned_income: 0
        tanf_gross_unearned_income: 0
    spm_units:
      spm_unit:
        members: [person1, person2]
    tax_units:
      tax_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: HI
  output:
    # Gross income = $1,500
    hi_tanf_gross_income: 1_500
    # Below gross limit of $2,340 for family of 2
    hi_tanf_gross_income_eligible: true
    # Earned income deductions for $1,500:
    # Step 1: 20% = 1_500 * 0.20 = 300, After: 1_500 - 300 = 1_200
    # Step 2: $200 flat, After: 1_200 - 200 = 1_000
    # Step 3: 55% = 1_000 * 0.55 = 550, After: 1_000 - 550 = 450
    hi_tanf_countable_earned_income: 450
    hi_tanf_countable_income: 450
    # 1265 × 0.48 × 0.80 = 485.76
    hi_tanf_maximum_benefit: 485.76
    hi_tanf_eligible: true
    # Benefit = 485.76 - 450 = 35.76
    hi_tanf: 35.76

- name: Case 3, family of 3 with income exceeding SOA.
  period: 2024-01
  input:
    people:
      person1:
        age: 35
        tanf_gross_earned_income: 2_500
        tanf_gross_unearned_income: 0
      person2:
        age: 32
        tanf_gross_earned_income: 0
        tanf_gross_unearned_income: 0
      person3:
        age: 10
        is_tax_unit_dependent: true
        tanf_gross_earned_income: 0
        tanf_gross_unearned_income: 0
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    tax_units:
      tax_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: HI
  output:
    hi_tanf_gross_income: 2_500
    # Under gross limit of $2,941.50 for family of 3
    hi_tanf_gross_income_eligible: true
    # Earned deductions for $2,500:
    # Step 1: 20% = 500, After: 2_000
    # Step 2: $200 flat, After: 1_800
    # Step 3: 55% = 990, After: 810
    hi_tanf_countable_earned_income: 810
    hi_tanf_countable_income: 810
    # 1590 × 0.48 × 0.80 = 610.56
    hi_tanf_maximum_benefit: 610.56
    hi_tanf_eligible: true
    # Benefit = max(610.56 - 810, 0) = 0 (countable income exceeds SOA)
    hi_tanf: 0

- name: Case 4, family of 3 over gross income limit.
  period: 2024-01
  input:
    people:
      person1:
        age: 40
        tanf_gross_earned_income: 3_000
        tanf_gross_unearned_income: 0
      person2:
        age: 38
        tanf_gross_earned_income: 0
        tanf_gross_unearned_income: 0
      person3:
        age: 12
        is_tax_unit_dependent: true
        tanf_gross_earned_income: 0
        tanf_gross_unearned_income: 0
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    tax_units:
      tax_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: HI
  output:
    hi_tanf_gross_income: 3_000
    # Over gross limit of $2,941.50 for family of 3
    hi_tanf_gross_income_eligible: false
    hi_tanf_eligible: false
    hi_tanf: 0

- name: Case 5, family with unearned income only.
  period: 2024-01
  input:
    people:
      person1:
        age: 45
        tanf_gross_earned_income: 0
        tanf_gross_unearned_income: 400
      person2:
        age: 6
        is_tax_unit_dependent: true
        tanf_gross_earned_income: 0
        tanf_gross_unearned_income: 0
    spm_units:
      spm_unit:
        members: [person1, person2]
    tax_units:
      tax_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: HI
  output:
    hi_tanf_gross_income: 400
    hi_tanf_gross_income_eligible: true
    hi_tanf_countable_earned_income: 0
    hi_tanf_countable_income: 400
    # 1265 × 0.48 × 0.80 = 485.76
    hi_tanf_maximum_benefit: 485.76
    hi_tanf_eligible: true
    # Benefit = 485.76 - 400 = 85.76
    hi_tanf: 85.76

- name: Case 6, family with both earned and unearned income.
  period: 2024-01
  input:
    people:
      person1:
        age: 33
        tanf_gross_earned_income: 1_000
        tanf_gross_unearned_income: 300
      person2:
        age: 4
        is_tax_unit_dependent: true
        tanf_gross_earned_income: 0
        tanf_gross_unearned_income: 0
      person3:
        age: 2
        is_tax_unit_dependent: true
        tanf_gross_earned_income: 0
        tanf_gross_unearned_income: 0
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    tax_units:
      tax_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: HI
  output:
    # Gross = $1,000 + $300 = $1,300
    hi_tanf_gross_income: 1_300
    hi_tanf_gross_income_eligible: true
    # Earned deductions for $1,000:
    # Step 1: 20% = 200, After: 800
    # Step 2: $200 flat, After: 600
    # Step 3: 55% = 330, After: 270
    hi_tanf_countable_earned_income: 270
    # Total countable = 270 + 300 = 570
    hi_tanf_countable_income: 570
    # 1590 × 0.48 × 0.80 = 610.56
    hi_tanf_maximum_benefit: 610.56
    hi_tanf_eligible: true
    # Benefit = 610.56 - 570 = 40.56
    hi_tanf: 40.56
