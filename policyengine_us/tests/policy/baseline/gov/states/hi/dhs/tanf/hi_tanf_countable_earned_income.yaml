# Unit tests for hi_tanf_countable_earned_income variable
# Tests earned income deductions applied in order:
# 1. 20% standard deduction
# 2. $200 flat rate deduction
# 3. 55% earned income disregard (for first 24 months, assumed default)
# Source: HAR 17-676-72; Hawaii TANF State Plan

- name: Case 1, no earned income.
  period: 2024-01
  input:
    people:
      person1:
        tanf_gross_earned_income: 0
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: HI
  output:
    hi_tanf_countable_earned_income: 0

- name: Case 2, low earned income fully offset by deductions.
  period: 2024-01
  input:
    people:
      person1:
        # $250 gross earned income
        # Step 1: 20% deduction = 250 * 0.20 = 50
        # After 20%: 250 - 50 = 200
        # Step 2: $200 flat deduction
        # After flat: 200 - 200 = 0
        # Step 3: 55% disregard of 0 = 0
        # Final: 0
        tanf_gross_earned_income: 250
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: HI
  output:
    hi_tanf_countable_earned_income: 0

- name: Case 3, earned income with all deductions applied.
  period: 2024-01
  input:
    people:
      person1:
        # $1_000 gross earned income
        # Step 1: 20% deduction = 1_000 * 0.20 = 200
        # After 20%: 1_000 - 200 = 800
        # Step 2: $200 flat deduction
        # After flat: 800 - 200 = 600
        # Step 3: 55% disregard = 600 * 0.55 = 330
        # After 55%: 600 - 330 = 270
        # Final: 270
        tanf_gross_earned_income: 1_000
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: HI
  output:
    hi_tanf_countable_earned_income: 270

- name: Case 4, higher earned income.
  period: 2024-01
  input:
    people:
      person1:
        # $2_000 gross earned income
        # Step 1: 20% deduction = 2_000 * 0.20 = 400
        # After 20%: 2_000 - 400 = 1_600
        # Step 2: $200 flat deduction
        # After flat: 1_600 - 200 = 1_400
        # Step 3: 55% disregard = 1_400 * 0.55 = 770
        # After 55%: 1_400 - 770 = 630
        # Final: 630
        tanf_gross_earned_income: 2_000
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: HI
  output:
    hi_tanf_countable_earned_income: 630

- name: Case 5, multiple earners in household.
  period: 2024-01
  input:
    people:
      person1:
        tanf_gross_earned_income: 1_500
      person2:
        tanf_gross_earned_income: 500
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: HI
  output:
    # Deductions applied at unit level (total income first, then deductions):
    # Total gross = 1_500 + 500 = 2_000
    # Step 1: 20% = 2_000 * 0.20 = 400, After: 2_000 - 400 = 1_600
    # Step 2: $200 flat, After: 1_600 - 200 = 1_400
    # Step 3: 55% = 1_400 * 0.55 = 770, After: 1_400 - 770 = 630
    hi_tanf_countable_earned_income: 630

- name: Case 6, small earned income where flat deduction creates floor at zero.
  period: 2024-01
  input:
    people:
      person1:
        # $100 gross earned income
        # Step 1: 20% deduction = 100 * 0.20 = 20
        # After 20%: 100 - 20 = 80
        # Step 2: $200 flat deduction would make it negative
        # After flat: max(80 - 200, 0) = 0
        # Step 3: 55% disregard of 0 = 0
        # Final: 0
        tanf_gross_earned_income: 100
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: HI
  output:
    hi_tanf_countable_earned_income: 0
