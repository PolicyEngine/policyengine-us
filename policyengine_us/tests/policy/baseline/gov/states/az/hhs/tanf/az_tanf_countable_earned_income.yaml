# Unit tests for Arizona TANF countable earned income at SPMUnit level
# Sums person-level earned income after disregards, minus dependent care deduction
# Reference: https://dbmefaapolicy.azdes.gov/index.html#page/FAA5/CA_Benefit_Determination.html

- name: Case 1, no earned income.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AZ
  output:
    az_tanf_countable_earned_income: 0

- name: Case 2, single earner.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 6_000  # $500/month annual
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AZ
  output:
    # Person1: $500 - $90 flat = $410, * 0.70 = $287
    # No dependent care deduction
    az_tanf_countable_earned_income: 287

- name: Case 3, two earners.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 6_000  # $500/month annual
      person2:
        age: 28
        employment_income_before_lsr: 4_800  # $400/month annual
      person3:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: AZ
  output:
    # Person1: $500 - $90 = $410, * 0.70 = $287
    # Person2: $400 - $90 = $310, * 0.70 = $217
    # Total: $287 + $217 = $504
    az_tanf_countable_earned_income: 504

- name: Case 4, single earner with dependent care.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 6_000  # $500/month annual
      person2:
        age: 1
        is_child: true
    spm_units:
      spm_unit:
        members: [person1, person2]
        childcare_expenses: 3_600  # $300/month annual
    households:
      household:
        members: [person1, person2]
        state_code: AZ
  output:
    # Person1: $500 - $90 = $410, * 0.70 = $287
    # Dependent care: min($300, $200) = $200 (child under 2)
    # Countable earned: $287 - $200 = $87
    az_tanf_countable_earned_income: 87

- name: Case 5, earned income less than dependent care deduction.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 1_200  # $100/month annual
      person2:
        age: 1
        is_child: true
    spm_units:
      spm_unit:
        members: [person1, person2]
        childcare_expenses: 3_600  # $300/month annual
    households:
      household:
        members: [person1, person2]
        state_code: AZ
  output:
    # Person1: $100 - $90 = $10, * 0.70 = $7
    # Dependent care: min($300, $200) = $200
    # Countable earned: max($7 - $200, 0) = $0
    az_tanf_countable_earned_income: 0
