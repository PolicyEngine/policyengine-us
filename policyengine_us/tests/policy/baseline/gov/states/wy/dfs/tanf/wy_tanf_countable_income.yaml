# Wyoming TANF Countable Income Tests
# Tests the total countable income calculation
# Formula: max_(Earned - Disregard, 0) + Unearned
# Source: Wyoming DFS Policy Manual Section 1101

- name: Case 1, earned income only.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 12_000  # $1,000/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # Countable earned: max(1000 - 600, 0) = $400
    # Unearned: $0
    # Total countable: 400 + 0 = $400
    wy_tanf_countable_income: 400

- name: Case 2, unearned income only.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        social_security: 9_600  # $800/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # Countable earned: $0 (no earned income)
    # Unearned: $800/month
    # Total countable: 0 + 800 = $800
    # Note: No disregard applies to unearned income
    wy_tanf_countable_income: 800

- name: Case 3, mixed earned and unearned income.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 9_600  # $800/month
        social_security: 3_600  # $300/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # Countable earned: max(800 - 600, 0) = $200
    # Unearned: $300/month
    # Total countable: 200 + 300 = $500
    wy_tanf_countable_income: 500

- name: Case 4, married couple with mixed income.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 18_000  # $1,500/month
      person2:
        age: 28
        social_security: 2_400  # $200/month
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_is_married: true
    households:
      household:
        members: [person1, person2, person3]
        state_code: WY
  output:
    # Countable earned: max(1500 - 1200, 0) = $300
    # Unearned: $200/month
    # Total countable: 300 + 200 = $500
    wy_tanf_countable_income: 500

- name: Case 5, earned income below disregard with unearned income.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 4_800  # $400/month
        social_security: 4_800  # $400/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # Countable earned: max(400 - 600, 0) = $0 (disregard exceeds earned)
    # Unearned: $400/month
    # Total countable: 0 + 400 = $400
    wy_tanf_countable_income: 400

# =============================================================================
# EDGE CASES
# =============================================================================

- name: Edge case 1, zero income results in zero countable income.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # Countable earned: max(0 - 600, 0) = $0
    # Unearned: $0
    # Total countable: 0 + 0 = $0
    wy_tanf_countable_income: 0

- name: Edge case 2, earned income exactly at single disregard ($600).
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 7_200  # $600/month exactly
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # Countable earned: max(600 - 600, 0) = $0 (exactly at disregard)
    # Unearned: $0
    # Total countable: 0 + 0 = $0
    wy_tanf_countable_income: 0

- name: Edge case 3, earned income exactly at married disregard ($1,200).
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 14_400  # $1,200/month exactly
      person2:
        age: 28
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_is_married: true
    households:
      household:
        members: [person1, person2, person3]
        state_code: WY
  output:
    # Countable earned: max(1200 - 1200, 0) = $0 (exactly at disregard)
    # Unearned: $0
    # Total countable: 0 + 0 = $0
    wy_tanf_countable_income: 0

- name: Edge case 4, earned income one dollar above single disregard.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 7_212  # $601/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # Countable earned: max(601 - 600, 0) = $1
    # Unearned: $0
    # Total countable: 1 + 0 = $1
    wy_tanf_countable_income: 1

- name: Edge case 5, self-employment income.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        self_employment_income_before_lsr: 18_000  # $1,500/month net profit
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # Countable earned: max(1500 - 600, 0) = $900
    # Unearned: $0
    # Total countable: 900 + 0 = $900
    wy_tanf_countable_income: 900

- name: Edge case 6, both parents working (multiple earners).
  period: 2025-01
  input:
    people:
      person1:
        age: 35
        employment_income_before_lsr: 12_000  # $1,000/month
      person2:
        age: 33
        employment_income_before_lsr: 9_600  # $800/month
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_is_married: true
    households:
      household:
        members: [person1, person2, person3]
        state_code: WY
  output:
    # Combined gross earned: $1,000 + $800 = $1,800/month
    # Disregard (married with child): $1,200
    # Countable earned: max(1800 - 1200, 0) = $600
    # Unearned: $0
    # Total countable: 600 + 0 = $600
    wy_tanf_countable_income: 600

- name: Edge case 7, very high earned income with unearned income.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 60_000  # $5,000/month
        social_security: 6_000  # $500/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # Countable earned: max(5000 - 600, 0) = $4,400
    # Unearned: $500/month
    # Total countable: 4400 + 500 = $4,900
    wy_tanf_countable_income: 4_900

- name: Edge case 8, mixed employment and self-employment income.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 6_000  # $500/month wages
        self_employment_income_before_lsr: 6_000  # $500/month net profit
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # Combined gross earned: $500 + $500 = $1,000/month
    # Disregard (single parent): $600
    # Countable earned: max(1000 - 600, 0) = $400
    # Unearned: $0
    # Total countable: 400 + 0 = $400
    wy_tanf_countable_income: 400

- name: Edge case 9, disregard does not apply to unearned income only.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        social_security: 3_600  # $300/month
        pension_income: 6_000  # $500/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # Countable earned: max(0 - 600, 0) = $0
    # Unearned: $300 + $500 = $800/month
    # Total countable: 0 + 800 = $800
    # NOTE: $600 disregard does NOT reduce unearned income
    wy_tanf_countable_income: 800
