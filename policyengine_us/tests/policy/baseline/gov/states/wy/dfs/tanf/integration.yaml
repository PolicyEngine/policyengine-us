# Wyoming TANF (POWER Program) Integration Tests
# Comprehensive scenarios testing the complete benefit calculation pipeline
# Sources:
# - Wyoming Statute 42-2-103 (earned income disregard)
# - Wyoming DFS Policy Manual Section 1101 (payment computation)
# - Wyoming DFS Table II POWER Income Limits (benefit schedules)

- name: Case 1, single parent with no income receives full benefit.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
        wy_tanf_shelter_qualified: true
        spm_unit_assets: 2_000
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # ======== EARNED INCOME CALCULATION ========
    # Gross earned income: $0

    wy_tanf_earned_income_disregard: 600
    # Single parent -> $600 flat disregard

    # ======== TOTAL COUNTABLE INCOME ========
    wy_tanf_countable_income: 0
    # max(0 - 600, 0) = $0 countable earned + $0 unearned = $0

    # ======== ELIGIBILITY CHECKS ========
    wy_tanf_income_eligible: true
    # Countable income ($0) < Income limit ($1,447 for size 2) -> Pass

    wy_tanf_resource_eligible: true
    # Assets ($2,000) < Resource limit ($5,000) -> Pass

    wy_tanf_eligible: true
    # Income eligible AND Resources eligible -> Pass

    # ======== BENEFIT CALCULATION ========
    wy_tanf_payment_standard: 847
    # Size 2, shelter qualified -> $847

    wy_tanf: 847
    # max(847 - 0, 0) = $847

- name: Case 2, single parent with earned income and disregard applied.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 12_000  # $1,000/month
      person2:
        age: 10
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_is_married: false
        wy_tanf_shelter_qualified: true
        spm_unit_assets: 1_500
    households:
      household:
        members: [person1, person2, person3]
        state_code: WY
  output:
    # ======== EARNED INCOME CALCULATION ========
    # Gross earned income: $1,000/month

    wy_tanf_earned_income_disregard: 600
    # Single parent -> $600 flat disregard

    # ======== TOTAL COUNTABLE INCOME ========
    wy_tanf_countable_income: 400
    # max(1000 - 600, 0) = $400 countable earned + $0 unearned = $400

    # ======== ELIGIBILITY CHECKS ========
    wy_tanf_income_eligible: true
    # Countable income ($400) < Income limit ($1,502 for size 3) -> Pass

    wy_tanf_resource_eligible: true
    # Assets ($1,500) < Resource limit ($5,000) -> Pass

    wy_tanf_eligible: true

    # ======== BENEFIT CALCULATION ========
    wy_tanf_payment_standard: 902
    # Size 3, shelter qualified -> $902

    wy_tanf: 502
    # max(902 - 400, 0) = $502

- name: Case 3, married couple with child receives $1,200 disregard.
  period: 2025-01
  input:
    people:
      person1:
        age: 35
        employment_income_before_lsr: 24_000  # $2,000/month
      person2:
        age: 32
      person3:
        age: 10
      person4:
        age: 7
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4]
        spm_unit_is_married: true
        wy_tanf_shelter_qualified: true
        spm_unit_assets: 3_000
    households:
      household:
        members: [person1, person2, person3, person4]
        state_code: WY
  output:
    # ======== EARNED INCOME CALCULATION ========
    # Gross earned income: $2,000/month

    wy_tanf_earned_income_disregard: 1_200
    # Married couple with child in common -> $1,200 flat disregard

    # ======== TOTAL COUNTABLE INCOME ========
    wy_tanf_countable_income: 800
    # max(2000 - 1200, 0) = $800 countable earned + $0 unearned = $800

    # ======== ELIGIBILITY CHECKS ========
    wy_tanf_income_eligible: true
    # Countable income ($800) < Income limit ($1,502 for size 4) -> Pass

    wy_tanf_resource_eligible: true
    # Assets ($3,000) < Resource limit ($5,000) -> Pass

    wy_tanf_eligible: true

    # ======== BENEFIT CALCULATION ========
    wy_tanf_payment_standard: 902
    # Size 4, shelter qualified -> $902 (same as size 3)

    wy_tanf: 102
    # max(902 - 800, 0) = $102

- name: Case 4, family with unearned income only (no disregard).
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        social_security: 7_200  # $600/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
        wy_tanf_shelter_qualified: true
        spm_unit_assets: 500
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # ======== EARNED INCOME CALCULATION ========
    # Gross earned income: $0

    wy_tanf_earned_income_disregard: 600
    # Single parent -> $600 (but no earned income to apply it to)

    # ======== TOTAL COUNTABLE INCOME ========
    wy_tanf_countable_income: 600
    # max(0 - 600, 0) = $0 countable earned + $600 unearned = $600
    # Note: Earned income disregard does NOT apply to unearned income

    # ======== ELIGIBILITY CHECKS ========
    wy_tanf_income_eligible: true
    # Countable income ($600) < Income limit ($1,447 for size 2) -> Pass

    wy_tanf_resource_eligible: true
    # Assets ($500) < Resource limit ($5,000) -> Pass

    wy_tanf_eligible: true

    # ======== BENEFIT CALCULATION ========
    wy_tanf_payment_standard: 847
    # Size 2, shelter qualified -> $847

    wy_tanf: 247
    # max(847 - 600, 0) = $247

- name: Case 5, shelter disqualified family receives reduced benefit.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
      person2:
        age: 10
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_is_married: false
        wy_tanf_shelter_qualified: false  # Living with relatives, no shelter cost
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2, person3]
        state_code: WY
  output:
    # ======== EARNED INCOME CALCULATION ========
    wy_tanf_earned_income_disregard: 600

    # ======== TOTAL COUNTABLE INCOME ========
    wy_tanf_countable_income: 0

    # ======== ELIGIBILITY CHECKS ========
    wy_tanf_income_eligible: true
    wy_tanf_resource_eligible: true
    wy_tanf_eligible: true

    # ======== BENEFIT CALCULATION ========
    wy_tanf_payment_standard: 576
    # Size 3, shelter DISQUALIFIED -> $576 (vs $902 for shelter qualified)

    wy_tanf: 576
    # max(576 - 0, 0) = $576

- name: Case 6, family exceeds income limit is ineligible.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 30_000  # $2,500/month
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
        wy_tanf_shelter_qualified: true
        spm_unit_assets: 2_000
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # ======== EARNED INCOME CALCULATION ========
    wy_tanf_earned_income_disregard: 600

    # ======== TOTAL COUNTABLE INCOME ========
    wy_tanf_countable_income: 1_900
    # max(2500 - 600, 0) = $1,900

    # ======== ELIGIBILITY CHECKS ========
    wy_tanf_income_eligible: false
    # Countable income ($1,900) > Income limit ($1,447 for size 2) -> FAIL

    wy_tanf_resource_eligible: true
    # Assets ($2,000) < Resource limit ($5,000) -> Pass

    wy_tanf_eligible: false
    # Income NOT eligible -> Overall NOT eligible

    # ======== BENEFIT CALCULATION ========
    wy_tanf_payment_standard: 847
    # Would be $847 if eligible

    wy_tanf: 0
    # Not eligible -> $0 benefit

- name: Case 7, family exceeds resource limit is ineligible.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
        wy_tanf_shelter_qualified: true
        spm_unit_assets: 6_000  # Exceeds $5,000 limit
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # ======== EARNED INCOME CALCULATION ========
    wy_tanf_earned_income_disregard: 600

    # ======== TOTAL COUNTABLE INCOME ========
    wy_tanf_countable_income: 0

    # ======== ELIGIBILITY CHECKS ========
    wy_tanf_income_eligible: true
    # Countable income ($0) < Income limit ($1,447) -> Pass

    wy_tanf_resource_eligible: false
    # Assets ($6,000) > Resource limit ($5,000) -> FAIL

    wy_tanf_eligible: false
    # Resources NOT eligible -> Overall NOT eligible

    # ======== BENEFIT CALCULATION ========
    wy_tanf_payment_standard: 847

    wy_tanf: 0
    # Not eligible -> $0 benefit

# =============================================================================
# EDGE CASE INTEGRATION TESTS
# =============================================================================

- name: Edge case 1, income exactly at threshold results in $0 benefit but eligible.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 17_364  # $1,447/month -> countable = $847
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
        wy_tanf_shelter_qualified: true
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    # ======== CALCULATION CHAIN ========
    wy_tanf_earned_income_disregard: 600
    wy_tanf_countable_income: 847
    # max(1447 - 600, 0) = $847

    # ======== ELIGIBILITY ========
    wy_tanf_income_eligible: true
    # $847 < $1,447 income limit -> PASS
    wy_tanf_resource_eligible: true
    wy_tanf_eligible: true

    # ======== BENEFIT ========
    wy_tanf_payment_standard: 847
    wy_tanf: 0
    # max(847 - 847, 0) = $0
    # They ARE eligible but benefit is $0 because countable = payment standard

- name: Edge case 2, resources exactly at $5,000 limit is eligible.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
        wy_tanf_shelter_qualified: true
        spm_unit_assets: 5_000  # Exactly at limit
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    wy_tanf_earned_income_disregard: 600
    wy_tanf_countable_income: 0
    wy_tanf_income_eligible: true
    wy_tanf_resource_eligible: true  # At limit = eligible (<=)
    wy_tanf_eligible: true
    wy_tanf_payment_standard: 847
    wy_tanf: 847

- name: Edge case 3, resources one dollar over $5,000 limit is ineligible.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
        wy_tanf_shelter_qualified: true
        spm_unit_assets: 5_001
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    wy_tanf_earned_income_disregard: 600
    wy_tanf_countable_income: 0
    wy_tanf_income_eligible: true
    wy_tanf_resource_eligible: false  # Over limit = ineligible
    wy_tanf_eligible: false
    wy_tanf_payment_standard: 847
    wy_tanf: 0

- name: Edge case 4, earned income exactly at disregard amount.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 7_200  # $600/month - exactly at disregard
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
        wy_tanf_shelter_qualified: true
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    wy_tanf_earned_income_disregard: 600
    wy_tanf_countable_income: 0
    # max(600 - 600, 0) = $0 countable earned
    wy_tanf_income_eligible: true
    wy_tanf_resource_eligible: true
    wy_tanf_eligible: true
    wy_tanf_payment_standard: 847
    wy_tanf: 847
    # Full benefit because disregard wipes out all earned income

- name: Edge case 5, large household size 12 at max_unit_size.
  period: 2025-01
  input:
    people:
      person1:
        age: 45
        employment_income_before_lsr: 12_000  # $1,000/month
      person2:
        age: 17
      person3:
        age: 16
      person4:
        age: 14
      person5:
        age: 12
      person6:
        age: 10
      person7:
        age: 9
      person8:
        age: 8
      person9:
        age: 6
      person10:
        age: 5
      person11:
        age: 3
      person12:
        age: 1
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10, person11, person12]
        spm_unit_is_married: false
        wy_tanf_shelter_qualified: true
        spm_unit_assets: 2_000
    households:
      household:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10, person11, person12]
        state_code: WY
  output:
    wy_tanf_earned_income_disregard: 600
    wy_tanf_countable_income: 400
    # max(1000 - 600, 0) = $400
    wy_tanf_income_eligible: true
    # $400 < $1,839 (size 12 limit)
    wy_tanf_resource_eligible: true
    wy_tanf_eligible: true
    wy_tanf_payment_standard: 1_243
    # Size 12, shelter qualified
    wy_tanf: 843
    # max(1243 - 400, 0) = $843

- name: Edge case 6, married couple without child gets $600 disregard.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        is_pregnant: true  # Qualifies for TANF due to pregnancy
        employment_income_before_lsr: 18_000  # $1,500/month
      person2:
        age: 28
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: true  # Married but no child yet
        wy_tanf_shelter_qualified: true
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    wy_tanf_earned_income_disregard: 600
    # Married but no child under 18 -> $600 disregard (not $1,200)
    wy_tanf_countable_income: 900
    # max(1500 - 600, 0) = $900
    wy_tanf_income_eligible: true
    # $900 < $1,447 (size 2 limit)
    wy_tanf_resource_eligible: true
    wy_tanf_eligible: true
    wy_tanf_payment_standard: 847
    wy_tanf: 0
    # max(847 - 900, 0) = $0
    # Eligible but countable income exceeds payment standard

- name: Edge case 7, both parents working with combined income.
  period: 2025-01
  input:
    people:
      person1:
        age: 35
        employment_income_before_lsr: 12_000  # $1,000/month
      person2:
        age: 33
        employment_income_before_lsr: 9_600  # $800/month
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_is_married: true
        wy_tanf_shelter_qualified: true
        spm_unit_assets: 2_000
    households:
      household:
        members: [person1, person2, person3]
        state_code: WY
  output:
    wy_tanf_earned_income_disregard: 1_200
    # Married couple with child -> $1,200 disregard
    wy_tanf_countable_income: 600
    # Combined earned: $1,000 + $800 = $1,800
    # max(1800 - 1200, 0) = $600
    wy_tanf_income_eligible: true
    # $600 < $1,502 (size 3 limit)
    wy_tanf_resource_eligible: true
    wy_tanf_eligible: true
    wy_tanf_payment_standard: 902
    wy_tanf: 302
    # max(902 - 600, 0) = $302

- name: Edge case 8, income exactly at income limit is NOT eligible.
  period: 2025-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 24_564  # $2,047/month -> countable = $1,447
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_is_married: false
        wy_tanf_shelter_qualified: true
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: WY
  output:
    wy_tanf_earned_income_disregard: 600
    wy_tanf_countable_income: 1_447
    # max(2047 - 600, 0) = $1,447
    wy_tanf_income_eligible: false
    # $1,447 = $1,447 limit -> NOT eligible (must be strictly less than)
    wy_tanf_resource_eligible: true
    wy_tanf_eligible: false
    wy_tanf_payment_standard: 847
    wy_tanf: 0
