# Unit tests for ut_tanf_earned_income_deduction (earned income deductions)
# Utah applies two earned income deductions:
#   1. Work expense allowance: $100 per employed person
#   2. 50% earned income disregard on remaining earned income
# Formula: work_expense + 0.50 * max(earned_income - work_expense, 0)
# Reference: Utah Admin. Code R986-200-239(2)(a) and R986-200-239(2)(b)

- name: No earned income - zero deduction.
  period: 2024-01
  input:
    people:
      person1:
        tanf_gross_earned_income: 0
      person2:
        tanf_gross_earned_income: 0
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: UT
  output:
    # No earnings = no deduction
    ut_tanf_earned_income_deduction: 0

- name: Single employed person with $500 earnings.
  period: 2024-01
  input:
    people:
      person1:
        tanf_gross_earned_income: 500
      person2:
        tanf_gross_earned_income: 0
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: UT
  output:
    # 1 employed person: work_expense = $100
    # After work expense = max(500 - 100, 0) = 400
    # 50% disregard = 400 * 0.50 = 200
    # Total deduction = 100 + 200 = 300
    ut_tanf_earned_income_deduction: 300

- name: Single employed person with $1,000 earnings.
  period: 2024-01
  input:
    people:
      person1:
        tanf_gross_earned_income: 1_000
      person2:
        tanf_gross_earned_income: 0
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: UT
  output:
    # 1 employed person: work_expense = $100
    # After work expense = max(1,000 - 100, 0) = 900
    # 50% disregard = 900 * 0.50 = 450
    # Total deduction = 100 + 450 = 550
    ut_tanf_earned_income_deduction: 550

- name: Two employed persons with earnings.
  period: 2024-01
  input:
    people:
      person1:
        tanf_gross_earned_income: 600
      person2:
        tanf_gross_earned_income: 400
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: UT
  output:
    # 2 employed persons: work_expense = $200 (100 * 2)
    # Total earnings = 600 + 400 = 1,000
    # After work expense = max(1,000 - 200, 0) = 800
    # 50% disregard = 800 * 0.50 = 400
    # Total deduction = 200 + 400 = 600
    ut_tanf_earned_income_deduction: 600

- name: Earnings less than work expense deduction.
  period: 2024-01
  input:
    people:
      person1:
        tanf_gross_earned_income: 80
      person2:
        tanf_gross_earned_income: 0
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: UT
  output:
    # 1 employed person: work_expense = $100
    # After work expense = max(80 - 100, 0) = 0
    # 50% disregard = 0 * 0.50 = 0
    # Total deduction = 80 (capped at earnings, cannot exceed earnings)
    ut_tanf_earned_income_deduction: 80

- name: Earnings exactly equal to work expense.
  period: 2024-01
  input:
    people:
      person1:
        tanf_gross_earned_income: 100
      person2:
        tanf_gross_earned_income: 0
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: UT
  output:
    # 1 employed person: work_expense = $100
    # After work expense = max(100 - 100, 0) = 0
    # 50% disregard = 0 * 0.50 = 0
    # Total deduction = 100
    ut_tanf_earned_income_deduction: 100
