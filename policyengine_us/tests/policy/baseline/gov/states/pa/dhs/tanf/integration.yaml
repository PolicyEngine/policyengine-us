# Pennsylvania TANF Integration Tests
# Tests complete benefit calculation pipeline from inputs to final benefit
# Based on 55 Pa. Code Chapter 183 and Pennsylvania TANF documentation

# TEST 1: Single parent with one child - eligible with low earned income
- name: Single parent with one child - low earned income eligible
  period: 2024-01
  input:
    people:
      parent:
        age: 30
        employment_income: 12_000  # $1,000/month
      child:
        age: 5
    spm_units:
      spm_unit:
        members: [parent, child]
    households:
      household:
        members: [parent, child]
        state_code: PA
  output:
    # Age eligibility: Child under 18
    pa_tanf_has_minor_child: true
    # Resources eligible (assume under $1,000 limit)
    pa_tanf_resources_eligible: true
    # Income calculation for 2-person household:
    # Gross earned: $12,000/year = $1,000/month
    # Less $90 standard deduction: $910
    # Apply 50% disregard: $910 * 0.5 = $455
    # Less $200 work expense: $455 - $200 = $255 countable/month
    # FSA for 2: $316/month
    # Countable < FSA, so eligible
    # Benefit: $316 - $255 = $61/month = $732/year
    pa_tanf_countable_income: [3_060, 3_060]  # $255 * 12
    pa_tanf_income_eligible: true
    pa_tanf_eligible: true
    pa_tanf: 732  # Annual benefit

# TEST 2: Two-parent family with three children - low income eligible
- name: Two-parent family with three children - low income eligible
  period: 2024-01
  input:
    people:
      parent1:
        age: 32
        employment_income: 15_000  # $1,250/month
      parent2:
        age: 30
        employment_income: 0
      child1:
        age: 2
      child2:
        age: 6
      child3:
        age: 10
    spm_units:
      spm_unit:
        members: [parent1, parent2, child1, child2, child3]
    households:
      household:
        members: [parent1, parent2, child1, child2, child3]
        state_code: PA
  output:
    # Age eligibility: Children under 18
    pa_tanf_has_minor_child: true
    pa_tanf_resources_eligible: true
    # Income calculation for 5-person household:
    # Gross earned: $15,000/year = $1,250/month
    # Less $90 standard deduction: $1,160
    # Apply 50% disregard: $1,160 * 0.5 = $580
    # Less $200 work expense: $580 - $200 = $380 countable/month
    # FSA for 5: $589/month
    # Countable < FSA, so eligible
    # Benefit: $589 - $380 = $209/month = $2,508/year
    pa_tanf_countable_income: [4_560, 4_560, 4_560, 4_560, 4_560]  # $380 * 12
    pa_tanf_income_eligible: true
    pa_tanf_eligible: true
    pa_tanf: 2_508  # Annual benefit

# TEST 3: Pregnant woman with no children - categorically eligible
- name: Pregnant woman with no other children - categorical eligibility
  period: 2024-01
  input:
    people:
      woman:
        age: 25
        is_pregnant: true
        employment_income: 10_000  # $833/month
    spm_units:
      spm_unit:
        members: [woman]
    households:
      household:
        members: [woman]
        state_code: PA
  output:
    # Pregnancy makes person categorically eligible
    pa_tanf_has_pregnant_member: true
    pa_tanf_resources_eligible: true
    # Income calculation for 1-person household:
    # Gross earned: $10,000/year = $833/month
    # Less $90 standard deduction: $743
    # Apply 50% disregard: $743 * 0.5 = $371.50
    # Less $200 work expense: $371.50 - $200 = $171.50 countable/month
    # FSA for 1: $205/month
    # Countable < FSA, so eligible
    # Benefit: $205 - $171.50 = $33.50/month = $402/year
    pa_tanf_countable_income: 2_058  # $171.50 * 12
    pa_tanf_income_eligible: true
    pa_tanf_eligible: true
    pa_tanf: 402  # Annual benefit

# TEST 4: Family with mixed earned and unearned income - ineligible (over income)
- name: Single parent with child receiving Social Security - over income limit
  period: 2024-01
  input:
    people:
      parent:
        age: 35
        employment_income: 8_000  # $667/month earned
        social_security: 6_000  # $500/month unearned
      child:
        age: 8
    spm_units:
      spm_unit:
        members: [parent, child]
    households:
      household:
        members: [parent, child]
        state_code: PA
  output:
    # Age eligibility: Child under 18
    pa_tanf_has_minor_child: true
    pa_tanf_resources_eligible: true
    # Income calculation for 2-person household:
    # Earned income: $8,000/year = $667/month
    # Less $90 standard deduction: $577
    # Apply 50% disregard: $577 * 0.5 = $288.50
    # Less $200 work expense: $288.50 - $200 = $88.50 countable earned/month
    # Unearned income: $500/month (fully countable)
    # Total countable: $88.50 + $500 = $588.50/month
    # FSA for 2: $316/month
    # Countable > FSA, so ineligible
    pa_tanf_countable_income: [7_062, 7_062]  # ($88.50 + $500) * 12
    pa_tanf_income_eligible: false
    pa_tanf_eligible: false
    pa_tanf: 0

# TEST 5: No income - maximum benefit scenario
- name: Single parent with one child - no income maximum benefit
  period: 2024-01
  input:
    people:
      parent:
        age: 22
        employment_income: 0
      child:
        age: 1
    spm_units:
      spm_unit:
        members: [parent, child]
    households:
      household:
        members: [parent, child]
        state_code: PA
  output:
    # Age eligibility: Child under 18
    pa_tanf_has_minor_child: true
    pa_tanf_resources_eligible: true
    # Income calculation for 2-person household:
    # No earned or unearned income
    # Countable income: $0
    # FSA for 2: $316/month
    # Benefit: $316/month = $3,792/year
    pa_tanf_countable_income: [0, 0]
    pa_tanf_income_eligible: true
    pa_tanf_eligible: true
    pa_tanf: 3_792  # Maximum benefit for 2-person household
