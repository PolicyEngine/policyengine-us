# Kentucky TANF (K-TAP) Integration Tests
# Per 921 KAR 2:016 - Standards of need and amount for KTAP
# Tests the complete benefit calculation pipeline
# Note: Tests use YEAR period; MONTH variables are automatically annualized
#
# Key Formulas (monthly):
#   Countable Earned = max(sum_gross_earned - $175, 0)
#   Countable Unearned = max(gross_unearned - min(child_support, $50), 0)
#   Countable Income = countable_earned + countable_unearned
#   Benefit = min(0.55 * max(need_standard - countable_income, 0), payment_standard)

- name: Case 1, single parent with two children, no income.
  period: 2024
  input:
    people:
      person1:
        age: 30
        employment_income: 0
        self_employment_income: 0
      person2:
        age: 8
      person3:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_assets: 0
    households:
      household:
        members: [person1, person2, person3]
        state_code: KY
  output:
    # Family size 3
    # Monthly values annualized (* 12)
    ky_ktap_need_standard: 631 * 12
    ky_ktap_payment_standard: 524 * 12
    # Earned: max($0 - $175, 0) = $0/month
    ky_ktap_countable_earned_income: 0
    ky_ktap_countable_unearned_income: 0
    ky_ktap_countable_income: 0
    # Income eligibility: $0 < $1,169 limit
    ky_ktap_income_eligible: true
    # Resource eligibility: $0 < $10,000 limit
    ky_ktap_resource_eligible: true
    ky_ktap_eligible: true
    # Monthly benefit: min(0.55 * $631, $524) = min($347.05, $524) = $347.05
    # Annual benefit: $347.05 * 12 = $4164.60
    ky_ktap: 347.05 * 12

- name: Case 2, adults only household, no eligible children.
  period: 2024
  input:
    people:
      person1:
        age: 45
        employment_income: 0
      person2:
        age: 42
        employment_income: 0
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 0
    households:
      household:
        members: [person1, person2]
        state_code: KY
  output:
    # Family size 2
    ky_ktap_need_standard: 552 * 12
    ky_ktap_payment_standard: 450 * 12
    ky_ktap_countable_earned_income: 0
    ky_ktap_countable_unearned_income: 0
    ky_ktap_countable_income: 0
    # Income eligible but demographically ineligible (no children)
    ky_ktap_income_eligible: true
    ky_ktap_resource_eligible: true
    ky_ktap_eligible: false
    ky_ktap: 0

- name: Case 3, single parent with one child, with earned income.
  period: 2024
  input:
    people:
      parent:
        age: 28
        # Monthly income: $600, Annual: $7,200
        # Use employment_income_before_lsr for TANF calculations
        employment_income_before_lsr: 7_200
      child:
        age: 6
    spm_units:
      spm_unit:
        members: [parent, child]
        spm_unit_assets: 500
    households:
      household:
        members: [parent, child]
        state_code: KY
  output:
    # Family size 2
    ky_ktap_need_standard: 552 * 12
    ky_ktap_payment_standard: 450 * 12
    # Monthly earned: $600, minus $175 deduction = $425
    # Annual: $425 * 12 = $5,100
    ky_ktap_countable_earned_income: 425 * 12
    ky_ktap_countable_unearned_income: 0
    # Total countable: $425/month * 12 = $5,100/year
    ky_ktap_countable_income: 425 * 12
    # Gross income: $600/month vs limit $1,021/month = eligible
    ky_ktap_income_eligible: true
    # Resources: $500 < $10,000 limit
    ky_ktap_resource_eligible: true
    ky_ktap_eligible: true
    # Deficit: $552 need - $425 countable = $127
    # Benefit: min(0.55 * $127, $450) = min($69.85, $450) = $69.85/month
    # Annual: $69.85 * 12 = $838.20
    ky_ktap: 69.85 * 12

- name: Case 4, family with child support income.
  period: 2024
  input:
    people:
      parent:
        age: 35
        employment_income: 0
        # Monthly child support: $200, Annual: $2,400
        child_support_received: 2_400
      child1:
        age: 10
      child2:
        age: 7
    spm_units:
      spm_unit:
        members: [parent, child1, child2]
        spm_unit_assets: 0
    households:
      household:
        members: [parent, child1, child2]
        state_code: KY
  output:
    # Family size 3
    ky_ktap_need_standard: 631 * 12
    ky_ktap_payment_standard: 524 * 12
    ky_ktap_countable_earned_income: 0
    # Monthly child support $200, pass-through exclusion $50
    # Countable: $200 - $50 = $150/month
    # Annual: $150 * 12 = $1,800
    ky_ktap_countable_unearned_income: 150 * 12
    ky_ktap_countable_income: 150 * 12
    # Gross income: $200/month < $1,169 limit
    ky_ktap_income_eligible: true
    ky_ktap_resource_eligible: true
    ky_ktap_eligible: true
    # Deficit: $631 - $150 = $481
    # Benefit: min(0.55 * $481, $524) = min($264.55, $524) = $264.55/month
    # Annual: $264.55 * 12 = $3,174.60
    ky_ktap: 264.55 * 12
