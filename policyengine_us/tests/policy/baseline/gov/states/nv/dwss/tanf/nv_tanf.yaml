# Nevada TANF Unit Tests
# Reference: https://dss.nv.gov/TANF/TANF_FAQ/
#
# Key Policy Rules:
# - Gross income limit: 130% of FPL
# - Resource limit: $10,000
# - Work expense deduction: max($90, 20% of gross earned income)
# - Benefit = payment_standard - countable_income

- name: Case 1, family of 3 with no income.
  period: 2025
  input:
    people:
      person1:
        age: 30
      person2:
        age: 30
      child:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, child]
    tax_units:
      tax_unit:
        members: [person1, person2, child]
    households:
      household:
        members: [person1, person2, child]
        state_code: NV
  output:
    # Family of 3 payment standard = $386/month = $4,632/year
    nv_tanf_payment_standard: 4_632
    nv_tanf_countable_income: 0
    nv_tanf_income_eligible: true
    nv_tanf_resource_eligible: true
    nv_tanf_eligible: true
    # Full benefit with no income: $386 x 12 = $4,632
    nv_tanf: 4_632

- name: Case 2, assets over limit (ineligible).
  period: 2025
  input:
    people:
      person1:
        age: 30
      person2:
        age: 30
      child:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, child]
        spm_unit_assets: 15_000
    tax_units:
      tax_unit:
        members: [person1, person2, child]
    households:
      household:
        members: [person1, person2, child]
        state_code: NV
  output:
    # Assets $15,000 > $10,000 limit
    nv_tanf_resource_eligible: false
    nv_tanf_eligible: false
    nv_tanf: 0

- name: Case 3, earned income with flat $90 deduction.
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 3_600
      person2:
        age: 30
      child:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, child]
    tax_units:
      tax_unit:
        members: [person1, person2, child]
    households:
      household:
        members: [person1, person2, child]
        state_code: NV
  output:
    # Monthly earned: $3,600/12 = $300
    # Work expense: max($90, $300 x 0.2) = max($90, $60) = $90
    # Countable earned: $300 - $90 = $210/month = $2,520/year
    nv_tanf_countable_earned_income: 2_520
    nv_tanf_countable_income: 2_520
    nv_tanf_income_eligible: true
    # Benefit: $4,632 - $2,520 = $2,112
    nv_tanf: 2_112

- name: Case 4, earned income with 20% deduction (higher income).
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 5_400
      person2:
        age: 30
      child:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, child]
    tax_units:
      tax_unit:
        members: [person1, person2, child]
    households:
      household:
        members: [person1, person2, child]
        state_code: NV
  output:
    # Monthly earned: $5,400/12 = $450 (crossover point)
    # Work expense: max($90, $450 x 0.2) = max($90, $90) = $90
    # Countable earned: $450 - $90 = $360/month = $4,320/year
    nv_tanf_countable_earned_income: 4_320
    nv_tanf_countable_income: 4_320
    nv_tanf_income_eligible: true
    # Benefit: $4,632 - $4,320 = $312
    nv_tanf: 312

- name: Case 5, earned income above crossover uses 20% deduction.
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 6_000
      person2:
        age: 30
      child:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, child]
    tax_units:
      tax_unit:
        members: [person1, person2, child]
    households:
      household:
        members: [person1, person2, child]
        state_code: NV
  output:
    # Monthly earned: $6,000/12 = $500
    # Work expense: max($90, $500 x 0.2) = max($90, $100) = $100
    # Countable earned: $500 - $100 = $400/month = $4,800/year
    nv_tanf_countable_earned_income: 4_800
    nv_tanf_countable_income: 4_800
    # Net income test: $4,800 > $4,632 (payment standard) - FAILS
    nv_tanf_income_eligible: false
    nv_tanf_eligible: false
    nv_tanf: 0

- name: Case 6, gross income test failure (income above 130% FPL).
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 36_000
      person2:
        age: 30
      child:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, child]
    tax_units:
      tax_unit:
        members: [person1, person2, child]
    households:
      household:
        members: [person1, person2, child]
        state_code: NV
  output:
    # FPL for 3: $15,650 + 2 x $5,500 = $26,650
    # 130% FPL: $26,650 x 1.3 = $34,645
    # Gross income: $36,000 > $34,645 - FAILS gross income test
    nv_tanf_income_eligible: false
    nv_tanf_eligible: false
    nv_tanf: 0

- name: Case 7, large household (size 6) eligible.
  period: 2025
  input:
    people:
      person1:
        age: 30
      person2:
        age: 30
      child1:
        age: 15
      child2:
        age: 12
      child3:
        age: 8
      child4:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2, child1, child2, child3, child4]
    tax_units:
      tax_unit:
        members: [person1, person2, child1, child2, child3, child4]
    households:
      household:
        members: [person1, person2, child1, child2, child3, child4]
        state_code: NV
  output:
    # Payment standard (size 6): $572/month = $6,864/year
    nv_tanf_payment_standard: 6_864
    nv_tanf_income_eligible: true
    nv_tanf_eligible: true
    nv_tanf: 6_864

- name: Case 8, large household with income.
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 4_800
      person2:
        age: 30
      child1:
        age: 15
      child2:
        age: 12
      child3:
        age: 8
      child4:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2, child1, child2, child3, child4]
    tax_units:
      tax_unit:
        members: [person1, person2, child1, child2, child3, child4]
    households:
      household:
        members: [person1, person2, child1, child2, child3, child4]
        state_code: NV
  output:
    # Monthly earned: $4,800/12 = $400
    # Work expense: max($90, $400 x 0.2) = max($90, $80) = $90
    # Countable earned: $400 - $90 = $310/month = $3,720/year
    nv_tanf_countable_earned_income: 3_720
    nv_tanf_payment_standard: 6_864
    # Benefit: $6,864 - $3,720 = $3,144
    nv_tanf: 3_144

- name: Case 9, edge case at gross income threshold.
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 34_645
      person2:
        age: 30
      child:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, child]
    tax_units:
      tax_unit:
        members: [person1, person2, child]
    households:
      household:
        members: [person1, person2, child]
        state_code: NV
  output:
    # FPL for 3: $26,650; 130% FPL = $34,645
    # Gross income: $34,645 <= $34,645 - PASSES gross test
    # Monthly earned: $34,645/12 = $2,887.08
    # Work expense: max($90, $2,887.08 x 0.2) = max($90, $577.42) = $577.42
    # Countable earned: $2,887.08 - $577.42 = $2,309.67/month = $27,716/year
    # Net income: $27,716 > $4,632 - FAILS net test
    nv_tanf_income_eligible: false
    nv_tanf_eligible: false
    nv_tanf: 0

- name: Case 10, edge case at net income threshold (exactly at payment standard).
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 5_790
      person2:
        age: 30
      child:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, child]
    tax_units:
      tax_unit:
        members: [person1, person2, child]
    households:
      household:
        members: [person1, person2, child]
        state_code: NV
  output:
    # Monthly earned: $5,790/12 = $482.50
    # Work expense: max($90, $482.50 x 0.2) = max($90, $96.50) = $96.50
    # Countable earned: $482.50 - $96.50 = $386/month = $4,632/year
    # Net income: $4,632 <= $4,632 - PASSES (at threshold)
    nv_tanf_countable_earned_income: 4_632
    nv_tanf_income_eligible: true
    nv_tanf_eligible: true
    # Benefit: $4,632 - $4,632 = $0
    nv_tanf: 0

- name: Case 11, mixed income (earned and unearned).
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 2_400
        social_security: 1_200
      person2:
        age: 30
      child:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, child]
    tax_units:
      tax_unit:
        members: [person1, person2, child]
    households:
      household:
        members: [person1, person2, child]
        state_code: NV
  output:
    # Earned: $2,400/year = $200/month
    # Unearned: $1,200/year = $100/month (social_security is unearned)
    # Work expense: max($90, $200 x 0.2) = max($90, $40) = $90
    # Countable earned: $200 - $90 = $110/month = $1,320/year
    nv_tanf_countable_earned_income: 1_320
    # Countable income: $1,320 + $1,200 = $2,520/year
    nv_tanf_countable_income: 2_520
    nv_tanf_income_eligible: true
    # Benefit: $4,632 - $2,520 = $2,112
    nv_tanf: 2_112

- name: Case 12, single parent household (size 2).
  period: 2025
  input:
    people:
      person1:
        age: 30
      child:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, child]
    tax_units:
      tax_unit:
        members: [person1, child]
    households:
      household:
        members: [person1, child]
        state_code: NV
  output:
    # Payment standard (size 2): $324/month = $3,888/year
    nv_tanf_payment_standard: 3_888
    nv_tanf_income_eligible: true
    nv_tanf_eligible: true
    nv_tanf: 3_888

- name: Case 13, assets exactly at limit (eligible).
  period: 2025
  input:
    people:
      person1:
        age: 30
      person2:
        age: 30
      child:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, child]
        spm_unit_assets: 10_000
    tax_units:
      tax_unit:
        members: [person1, person2, child]
    households:
      household:
        members: [person1, person2, child]
        state_code: NV
  output:
    # Assets $10,000 = $10,000 limit (at threshold = eligible)
    nv_tanf_resource_eligible: true
    nv_tanf_eligible: true
    nv_tanf: 4_632
