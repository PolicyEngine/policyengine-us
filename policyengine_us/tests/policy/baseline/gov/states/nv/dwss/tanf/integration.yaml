# Nevada TANF Integration Tests
# Reference: Nevada DWSS Eligibility and Payments Manual, Section C-140.1
# https://dss.nv.gov/uploadedFiles/dwssnvgov/content/Home/Features/eligibility/Chapter%20C_140.pdf
#
# Key Policy Rules:
# - Gross income limit: 130% of FPL
# - Net income limit: 100% Need Standard
# - Resource limit: $10,000
# - Work expense deduction: max($90, 20% of gross earned income)
# - Benefit = Payment Allowance - Countable Income

- name: Single person household (size 1, pregnant)
  period: 2025
  input:
    people:
      person1:
        age: 25
        is_pregnant: true
    spm_units:
      spm_unit:
        members: [person1]
    tax_units:
      tax_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: NV
  output:
    # Payment allowance (size 1): $254/month = $3,048/year
    nv_tanf_payment_standard: 3_048
    # Need standard (size 1): $759/month = $9,108/year
    nv_tanf_need_standard: 9_108
    nv_tanf_countable_income: 0
    nv_tanf_income_eligible: true
    nv_tanf_resources_eligible: true
    nv_tanf_eligible: true
    nv_tanf: 3_048

- name: Family of 3 with no income
  period: 2025
  input:
    people:
      person1:
        age: 30
      person2:
        age: 30
      person3:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    tax_units:
      tax_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: NV
  output:
    # Payment allowance (size 3): $386/month = $4,632/year
    nv_tanf_payment_standard: 4_632
    # Need standard (size 3): $1,299/month = $15,588/year
    nv_tanf_need_standard: 15_588
    nv_tanf_countable_income: 0
    nv_tanf_income_eligible: true
    nv_tanf_resources_eligible: true
    nv_tanf_eligible: true
    nv_tanf: 4_632

- name: Assets over limit (ineligible)
  period: 2025
  input:
    people:
      person1:
        age: 30
      person2:
        age: 30
      person3:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_assets: 15_000
    tax_units:
      tax_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: NV
  output:
    # Assets $15,000 > $10,000 limit
    nv_tanf_resources_eligible: false
    nv_tanf_eligible: false
    nv_tanf: 0

- name: Earned income with 20% work expense deduction
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 6_000
      person2:
        age: 30
      person3:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    tax_units:
      tax_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: NV
  output:
    # Monthly earned: $6,000/12 = $500
    # Work expense: max($90, $500 x 0.2) = max($90, $100) = $100
    # Countable earned: $500 - $100 = $400/month = $4,800/year
    nv_tanf_countable_earned_income: 4_800
    nv_tanf_countable_income: 4_800
    nv_tanf_income_eligible: true
    nv_tanf_eligible: true
    # Benefit: $4,632 - $4,800 = -$168, capped at $0
    nv_tanf: 0

- name: Gross income test failure (above 130% FPL)
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 36_000
      person2:
        age: 30
      person3:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    tax_units:
      tax_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: NV
  output:
    # 130% FPL for size 3: $26,650 x 1.3 = $34,645
    # Gross income $36,000 > $34,645 - FAILS
    nv_tanf_income_eligible: false
    nv_tanf_eligible: false
    nv_tanf: 0

- name: Mixed income (earned and unearned)
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 2_400
        social_security: 1_200
      person2:
        age: 30
      person3:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    tax_units:
      tax_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: NV
  output:
    # Earned: $200/month, Work expense: max($90, $40) = $90
    # Countable earned: $200 - $90 = $110/month = $1,320/year
    nv_tanf_countable_earned_income: 1_320
    # Countable income: $1,320 + $1,200 = $2,520/year
    nv_tanf_countable_income: 2_520
    nv_tanf_income_eligible: true
    # Benefit: $4,632 - $2,520 = $2,112
    nv_tanf: 2_112

- name: Single parent household (size 2)
  period: 2025
  input:
    people:
      person1:
        age: 30
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    tax_units:
      tax_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: NV
  output:
    # Payment allowance (size 2): $320/month = $3,840/year
    nv_tanf_payment_standard: 3_840
    # Need standard (size 2): $1,029/month = $12,348/year
    nv_tanf_need_standard: 12_348
    nv_tanf_income_eligible: true
    nv_tanf_eligible: true
    nv_tanf: 3_840

- name: Large household (size 10) uses increment formula
  period: 2025
  input:
    people:
      person1:
        age: 30
      person2:
        age: 30
      person3:
        age: 17
      person4:
        age: 15
      person5:
        age: 13
      person6:
        age: 11
      person7:
        age: 9
      person8:
        age: 7
      person9:
        age: 5
      person10:
        age: 3
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10]
    tax_units:
      tax_unit:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10]
    households:
      household:
        members: [person1, person2, person3, person4, person5, person6, person7, person8, person9, person10]
        state_code: NV
  output:
    # Payment allowance: $716 (size 8) + 2 x $66 = $848/month = $10,176/year
    nv_tanf_payment_standard: 10_176
    # Need standard: $2,649 (size 8) + 2 x $270 = $3,189/month = $38,268/year
    nv_tanf_need_standard: 38_268
    nv_tanf_income_eligible: true
    nv_tanf_eligible: true
    nv_tanf: 10_176

- name: Two earners with separate work expense deductions
  period: 2025
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 4_800
      person2:
        age: 30
        employment_income_before_lsr: 7_200
      person3:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    tax_units:
      tax_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: NV
  output:
    # Person 1: $4,800/12 = $400/month
    #   Work expense: max($90, $400 x 0.2) = max($90, $80) = $90
    #   Earned after disregard: $400 - $90 = $310/month = $3,720/year
    # Person 2: $7,200/12 = $600/month
    #   Work expense: max($90, $600 x 0.2) = max($90, $120) = $120
    #   Earned after disregard: $600 - $120 = $480/month = $5,760/year
    nv_tanf_earned_income_after_disregard: [3_720, 5_760, 0]
    # Total countable earned: $3,720 + $5,760 = $9,480/year
    nv_tanf_countable_earned_income: 9_480
    nv_tanf_countable_income: 9_480
    nv_tanf_income_eligible: true
    nv_tanf_eligible: true
    # Benefit: $4,632 - $9,480 = -$4,848, capped at $0
    nv_tanf: 0
