# Unit tests for nj_staynj variable
# Tests benefit amounts for Stay NJ Property Tax Credit
# Formula: Stay NJ = min((property_taxes - ANCHOR) * 0.5, $6,500)
# Note: Stay NJ begins in 2026
# Note: Stay NJ is calculated AFTER subtracting ANCHOR benefits from property taxes
#
# ANCHOR benefit amounts for homeowners (income <= $250K):
#   - Senior (65+), income <= $150K: $1,750
#   - Senior (65+), income $150K-$250K: $1,250
#   - Non-senior, income <= $150K: $1,500
#   - Non-senior, income $150K-$250K: $1,000

- name: Case 1, eligible senior receives 50 percent of property tax after ANCHOR offset.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 100_000
        real_estate_taxes: 10_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34  # New Jersey
  output:
    # Senior (65+), income $100K <= $150K: ANCHOR = $1,750
    # Net property tax: $10,000 - $1,750 = $8,250
    # Stay NJ: 50% * $8,250 = $4,125 (under $6,500 max)
    nj_staynj: 4_125

- name: Case 2, benefit capped at maximum of $6,500.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 200_000
        real_estate_taxes: 20_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITHOUT_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Senior (65+), income $200K in $150K-$250K range: ANCHOR = $1,250
    # Net property tax: $20,000 - $1,250 = $18,750
    # 50% * $18,750 = $9,375
    # Capped at max: $6,500
    nj_staynj: 6_500

- name: Case 3, benefit under maximum with ANCHOR offset.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 150_000
        real_estate_taxes: 13_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Senior (65+), income $150K <= $150K: ANCHOR = $1,750
    # Net property tax: $13,000 - $1,750 = $11,250
    # 50% * $11,250 = $5,625 (under cap)
    nj_staynj: 5_625

- name: Case 4, low property tax results in low benefit after ANCHOR offset.
  period: 2026
  input:
    people:
      person1:
        age: 68
        employment_income: 80_000
        real_estate_taxes: 4_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Senior (65+), income $80K <= $150K: ANCHOR = $1,750
    # Net property tax: $4,000 - $1,750 = $2,250
    # 50% * $2,250 = $1,125
    nj_staynj: 1_125

- name: Case 5, ineligible due to age receives $0.
  period: 2026
  input:
    people:
      person1:
        age: 64
        employment_income: 100_000
        real_estate_taxes: 10_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Age 64 < 65 - ineligible for Stay NJ
    nj_staynj: 0

- name: Case 6, ineligible due to income receives $0.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 600_000
        real_estate_taxes: 15_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Income $600K >= $500K limit - ineligible for Stay NJ
    # (Also ineligible for ANCHOR due to income > $250K)
    nj_staynj: 0

- name: Case 7, ineligible renter receives $0.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 100_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: RENTER
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Renter - ineligible for Stay NJ
    nj_staynj: 0

- name: Case 8, zero property tax means zero benefit.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 100_000
        real_estate_taxes: 0
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITHOUT_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Property tax $0, no ANCHOR (not paying property taxes)
    # Net: $0 - $0 = $0
    # 50% * $0 = $0
    nj_staynj: 0

- name: Case 9, senior at income above ANCHOR limit but below Stay NJ limit.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 499_000
        real_estate_taxes: 12_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Income $499K > $250K ANCHOR limit - no ANCHOR benefit
    # Income $499K < $500K Stay NJ limit - eligible for Stay NJ
    # Net property tax: $12,000 - $0 = $12,000
    # 50% * $12,000 = $6,000
    nj_staynj: 6_000

# ==============================================================================
# EDGE CASES - Boundary conditions and corner cases
# ==============================================================================

- name: Edge case 1, property tax $13,000 with ANCHOR offset.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 100_000
        real_estate_taxes: 13_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Senior (65+), income $100K <= $150K: ANCHOR = $1,750
    # Net property tax: $13,000 - $1,750 = $11,250
    # 50% * $11,250 = $5,625
    nj_staynj: 5_625

- name: Edge case 2, property tax one dollar above previous cap threshold.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 100_000
        real_estate_taxes: 13_001
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Senior (65+), income $100K <= $150K: ANCHOR = $1,750
    # Net property tax: $13,001 - $1,750 = $11,251
    # 50% * $11,251 = $5,625.50
    nj_staynj: 5_625.5

- name: Edge case 3, property tax one dollar below previous cap threshold.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 100_000
        real_estate_taxes: 12_999
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Senior (65+), income $100K <= $150K: ANCHOR = $1,750
    # Net property tax: $12,999 - $1,750 = $11,249
    # 50% * $11,249 = $5,624.50
    nj_staynj: 5_624.5

- name: Edge case 4, very high property tax capped at maximum.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 200_000
        real_estate_taxes: 50_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Senior (65+), income $200K in $150K-$250K range: ANCHOR = $1,250
    # Net property tax: $50,000 - $1,250 = $48,750
    # 50% * $48,750 = $24,375
    # Capped at max: $6,500
    nj_staynj: 6_500

- name: Edge case 5, income exactly $499,999 one dollar below limit.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 499_999
        real_estate_taxes: 10_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Income $499,999 > $250K - no ANCHOR
    # Income $499,999 < $500,000 (strict less than) - eligible for Stay NJ
    # Net property tax: $10,000 - $0 = $10,000
    # 50% * $10,000 = $5,000
    nj_staynj: 5_000

- name: Edge case 6, income exactly at $500,000 limit is ineligible.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 500_000
        real_estate_taxes: 10_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Income $500,000 NOT < $500,000 (strict less than) - ineligible
    nj_staynj: 0

- name: Edge case 7, age exactly 65 at boundary.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 100_000
        real_estate_taxes: 8_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Age 65 >= 65 (uses >=) - eligible
    # Senior (65+), income $100K <= $150K: ANCHOR = $1,750
    # Net property tax: $8,000 - $1,750 = $6,250
    # 50% * $6,250 = $3,125
    nj_staynj: 3_125

- name: Edge case 8, zero income still receives benefit.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 0
        real_estate_taxes: 6_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Senior (65+), income $0 <= $150K: ANCHOR = $1,750
    # Net property tax: $6,000 - $1,750 = $4,250
    # 50% * $4,250 = $2,125
    nj_staynj: 2_125

- name: Edge case 9, very low property tax below ANCHOR amount.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 100_000
        real_estate_taxes: 100
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Senior (65+), income $100K <= $150K: ANCHOR = $1,750
    # Net property tax: max($100 - $1,750, 0) = $0
    # 50% * $0 = $0
    nj_staynj: 0

- name: Edge case 10, couple where only spouse is 65 plus.
  period: 2026
  input:
    people:
      person1:
        age: 50
        employment_income: 100_000
        real_estate_taxes: 14_000
        is_tax_unit_head: true
      person2:
        age: 66
        employment_income: 0
        is_tax_unit_spouse: true
    tax_units:
      tax_unit:
        members: [person1, person2]
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1, person2]
        state_fips: 34
  output:
    # Uses greater_age_head_spouse = max(50, 66) = 66 >= 65 - senior
    # Senior, income $100K <= $150K: ANCHOR = $1,750
    # Net property tax: $14,000 - $1,750 = $12,250
    # 50% * $12,250 = $6,125
    nj_staynj: 6_125

- name: Edge case 11, mixed household paying both rent and taxes receives $0.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 100_000
        real_estate_taxes: 5_000
        rent: 12_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Implementation: is_homeowner = pays_taxes & ~pays_rent
    # Pays both - is_homeowner = false - ineligible
    nj_staynj: 0

- name: Edge case 12, very high income senior is ineligible.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 1_000_000
        real_estate_taxes: 30_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Income $1M far exceeds $500K limit - ineligible
    nj_staynj: 0

- name: Edge case 13, property tax at $1 below ANCHOR gives zero benefit.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 100_000
        real_estate_taxes: 1
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Senior (65+), income $100K <= $150K: ANCHOR = $1,750
    # Net property tax: max($1 - $1,750, 0) = $0
    # 50% * $0 = $0
    nj_staynj: 0

- name: Edge case 14, property tax just under previous double cap.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 100_000
        real_estate_taxes: 12_998
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Senior (65+), income $100K <= $150K: ANCHOR = $1,750
    # Net property tax: $12,998 - $1,750 = $11,248
    # 50% * $11,248 = $5,624
    nj_staynj: 5_624

- name: Edge case 15, senior who neither owns nor rents is ineligible.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 50_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
        # No rent - defaults to 0
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: RENTER
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Not homeowner (no property taxes) and not renter (no rent paid)
    # Formula: is_homeowner = pays_taxes & ~pays_rent = false
    # Ineligible
    nj_staynj: 0
