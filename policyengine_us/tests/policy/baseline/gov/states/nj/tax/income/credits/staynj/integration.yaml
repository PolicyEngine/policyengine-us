# Integration tests for New Jersey Stay NJ Property Tax Credit
# Tests the full calculation pipeline from income to eligibility to benefit
# Stay NJ: 50% of property taxes paid, maximum $6,500, age 65+, income < $500K
# Note: Stay NJ begins in 2026

- name: Case 1, senior couple homeowner with moderate income and property tax.
  period: 2026
  input:
    people:
      person1:
        age: 68
        employment_income: 100_000
        real_estate_taxes: 10_000
        is_tax_unit_head: true
      person2:
        age: 66
        employment_income: 50_000
        is_tax_unit_spouse: true
    tax_units:
      tax_unit:
        members: [person1, person2]
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1, person2]
        state_fips: 34  # New Jersey
  output:
    # Combined income: $100K + $50K = $150K < $500K limit
    # At least one person age 68 >= 65
    # Homeowner with mortgage
    # Property tax: $10,000
    # Benefit: 50% * $10,000 = $5,000
    nj_staynj_eligible: true
    nj_staynj: 5_000

- name: Case 2, wealthy senior homeowner capped at maximum.
  period: 2026
  input:
    people:
      person1:
        age: 72
        employment_income: 400_000
        real_estate_taxes: 25_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITHOUT_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Income $400K < $500K limit
    # Age 72 >= 65
    # Property tax: $25,000
    # 50% * $25,000 = $12,500 > $6,500 max
    # Capped at: $6,500
    nj_staynj_eligible: true
    nj_staynj: 6_500

- name: Case 3, retiree with Social Security income and property tax.
  period: 2026
  input:
    people:
      person1:
        age: 75
        social_security: 36_000
        real_estate_taxes: 8_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Income: $36K (Social Security) < $500K
    # Age 75 >= 65
    # Property tax: $8,000
    # 50% * $8,000 = $4,000
    nj_staynj_eligible: true
    nj_staynj: 4_000

- name: Case 4, non-senior homeowner is ineligible.
  period: 2026
  input:
    people:
      person1:
        age: 60
        employment_income: 150_000
        real_estate_taxes: 12_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Age 60 < 65 - fails age requirement
    # Even though income and homeownership qualify
    # Ineligible
    nj_staynj_eligible: false
    nj_staynj: 0

- name: Case 5, senior renter is ineligible.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 80_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: RENTER
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Age 70 >= 65 - passes age
    # Income $80K < $500K - passes income
    # RENTER - fails homeowner requirement
    # Stay NJ is only for homeowners
    nj_staynj_eligible: false
    nj_staynj: 0

- name: Case 6, high-income senior homeowner is ineligible.
  period: 2026
  input:
    people:
      person1:
        age: 67
        employment_income: 550_000
        real_estate_taxes: 20_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Income $550K >= $500K limit
    # Fails income requirement
    nj_staynj_eligible: false
    nj_staynj: 0

- name: Case 7, couple where one spouse is 65 plus and one is under 65.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 80_000
        real_estate_taxes: 11_000
        is_tax_unit_head: true
      person2:
        age: 58
        employment_income: 70_000
        is_tax_unit_spouse: true
    tax_units:
      tax_unit:
        members: [person1, person2]
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1, person2]
        state_fips: 34
  output:
    # At least one spouse (person1) is 65+
    # Combined income: $80K + $70K = $150K < $500K
    # Homeowner
    # Property tax: $11,000
    # 50% * $11,000 = $5,500
    nj_staynj_eligible: true
    nj_staynj: 5_500
