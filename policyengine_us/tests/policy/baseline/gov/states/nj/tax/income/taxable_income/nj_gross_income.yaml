# Tests for NJ same-category loss rule (N.J.S. 54A:5-1)
# GitHub issue: https://github.com/PolicyEngine/policyengine-us/issues/7017

- name: NJ same-category rule disregards capital and S-corp losses
  period: 2024
  absolute_error_margin: 1
  input:
    people:
      person1:
        is_tax_unit_head: true
        age: 40
        employment_income: 136_639
        dividend_income: 1_661
        taxable_interest_income: 343
        short_term_capital_gains: -237_873
        long_term_capital_gains: -2_252
        partnership_s_corp_income: -29_134
      person2:
        is_tax_unit_spouse: true
        age: 40
    tax_units:
      tax_unit:
        members: [person1, person2]
        filing_status: JOINT
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: NJ
  output:
    # Same-category rule: losses in each category are disregarded
    # Capital gains: -237,873 + -2,252 = -240,125 -> 0
    # S-corp: -29,134 -> 0
    # Gross income = 136,639 + 1,661 + 343 = 138,643
    nj_gross_income: [138_643, 0]

- name: NJ same-category rule allows positive capital gains
  period: 2024
  input:
    employment_income: 50_000
    short_term_capital_gains: 10_000
    long_term_capital_gains: 5_000
    state_code: NJ
  output:
    # Capital gains net positive: 10,000 + 5,000 = 15,000 (included)
    nj_gross_income: 65_000

- name: NJ same-category rule with mixed positive and negative within category
  period: 2024
  input:
    employment_income: 50_000
    short_term_capital_gains: -20_000
    long_term_capital_gains: 10_000
    state_code: NJ
  output:
    # Capital gains net: -20,000 + 10,000 = -10,000 -> 0
    nj_gross_income: 50_000

- name: NJ same-category rule with self-employment loss
  period: 2024
  input:
    employment_income: 80_000
    self_employment_income: -15_000
    state_code: NJ
  output:
    # Self-employment loss disregarded
    nj_gross_income: 80_000

- name: NJ same-category rule with rental loss
  period: 2024
  input:
    employment_income: 100_000
    rental_income: -25_000
    state_code: NJ
  output:
    # Rental loss disregarded
    nj_gross_income: 100_000

- name: NJ same-category rule with farm loss
  period: 2024
  input:
    employment_income: 90_000
    self_employment_income: 10_000
    farm_income: -25_000
    state_code: NJ
  output:
    # Category b: 10,000 + (-25,000) = -15,000 -> 0
    nj_gross_income: 90_000
