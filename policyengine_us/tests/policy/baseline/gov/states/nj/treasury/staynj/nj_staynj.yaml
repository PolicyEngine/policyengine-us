# Unit tests for nj_staynj variable
# Tests benefit amounts for Stay NJ Property Tax Credit
# Benefit: 50% of property taxes paid, maximum $6,500
# Note: Stay NJ begins in 2026

- name: Case 1, eligible senior receives 50 percent of property tax.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 100_000
        real_estate_taxes: 10_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34  # New Jersey
  output:
    # Property tax: $10,000
    # Benefit: 50% * $10,000 = $5,000 (under $6,500 max)
    nj_staynj: 5_000

- name: Case 2, benefit capped at maximum of $6,500.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 200_000
        real_estate_taxes: 20_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITHOUT_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Property tax: $20,000
    # 50% * $20,000 = $10,000
    # Capped at max: $6,500
    nj_staynj: 6_500

- name: Case 3, benefit exactly at maximum threshold.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 150_000
        real_estate_taxes: 13_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Property tax: $13,000
    # 50% * $13,000 = $6,500 (exactly at max)
    nj_staynj: 6_500

- name: Case 4, low property tax results in low benefit.
  period: 2026
  input:
    people:
      person1:
        age: 68
        employment_income: 80_000
        real_estate_taxes: 4_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Property tax: $4,000
    # 50% * $4,000 = $2,000
    nj_staynj: 2_000

- name: Case 5, ineligible due to age receives $0.
  period: 2026
  input:
    people:
      person1:
        age: 64
        employment_income: 100_000
        real_estate_taxes: 10_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Age 64 < 65 - ineligible
    nj_staynj: 0

- name: Case 6, ineligible due to income receives $0.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 600_000
        real_estate_taxes: 15_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Income $600K >= $500K limit - ineligible
    nj_staynj: 0

- name: Case 7, ineligible renter receives $0.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 100_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: RENTER
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Renter - ineligible for Stay NJ
    nj_staynj: 0

- name: Case 8, zero property tax means zero benefit.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 100_000
        real_estate_taxes: 0
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITHOUT_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # 50% * $0 = $0
    nj_staynj: 0

- name: Case 9, senior at income just below limit is eligible.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 499_000
        real_estate_taxes: 12_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Income $499K < $500K limit - eligible
    # 50% * $12,000 = $6,000
    nj_staynj: 6_000

# ==============================================================================
# EDGE CASES - Boundary conditions and corner cases
# ==============================================================================

- name: Edge case 1, property tax exactly $13,000 where 50 percent equals cap.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 100_000
        real_estate_taxes: 13_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # 50% * $13,000 = $6,500 exactly at cap
    nj_staynj: 6_500

- name: Edge case 2, property tax one dollar above cap threshold.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 100_000
        real_estate_taxes: 13_001
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # 50% * $13,001 = $6,500.50 > $6,500 cap
    # Capped at $6,500
    nj_staynj: 6_500

- name: Edge case 3, property tax one dollar below cap threshold.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 100_000
        real_estate_taxes: 12_999
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # 50% * $12,999 = $6,499.50 (under cap)
    nj_staynj: 6_499.5

- name: Edge case 4, very high property tax capped at maximum.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 200_000
        real_estate_taxes: 50_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # 50% * $50,000 = $25,000
    # Capped at max: $6,500
    nj_staynj: 6_500

- name: Edge case 5, income exactly $499,999 one dollar below limit.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 499_999
        real_estate_taxes: 10_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Income $499,999 < $500,000 (strict less than) - eligible
    # 50% * $10,000 = $5,000
    nj_staynj: 5_000

- name: Edge case 6, income exactly at $500,000 limit is ineligible.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 500_000
        real_estate_taxes: 10_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Income $500,000 NOT < $500,000 (strict less than) - ineligible
    nj_staynj: 0

- name: Edge case 7, age exactly 65 at boundary.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 100_000
        real_estate_taxes: 8_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Age 65 >= 65 (uses >=) - eligible
    # 50% * $8,000 = $4,000
    nj_staynj: 4_000

- name: Edge case 8, zero income still receives benefit.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 0
        real_estate_taxes: 6_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Income $0 < $500K - eligible
    # 50% * $6,000 = $3,000
    nj_staynj: 3_000

- name: Edge case 9, very low property tax.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 100_000
        real_estate_taxes: 100
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # 50% * $100 = $50
    nj_staynj: 50

- name: Edge case 10, couple where only spouse is 65 plus.
  period: 2026
  input:
    people:
      person1:
        age: 50
        employment_income: 100_000
        real_estate_taxes: 14_000
        is_tax_unit_head: true
      person2:
        age: 66
        employment_income: 0
        is_tax_unit_spouse: true
    tax_units:
      tax_unit:
        members: [person1, person2]
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1, person2]
        state_fips: 34
  output:
    # Uses greater_age_head_spouse = max(50, 66) = 66 >= 65
    # 50% * $14,000 = $7,000 > $6,500 cap
    # Capped at $6,500
    nj_staynj: 6_500

- name: Edge case 11, mixed household paying both rent and taxes receives $0.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 100_000
        real_estate_taxes: 5_000
        rent: 12_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Implementation: is_homeowner = pays_taxes & ~pays_rent
    # Pays both - is_homeowner = false - ineligible
    nj_staynj: 0

- name: Edge case 12, very high income senior is ineligible.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 1_000_000
        real_estate_taxes: 30_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Income $1M far exceeds $500K limit - ineligible
    nj_staynj: 0

- name: Edge case 13, property tax at $1 gives minimal benefit.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 100_000
        real_estate_taxes: 1
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # 50% * $1 = $0.50
    nj_staynj: 0.5

- name: Edge case 14, property tax just under double cap triggers cap.
  period: 2026
  input:
    people:
      person1:
        age: 65
        employment_income: 100_000
        real_estate_taxes: 12_998
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: OWNER_WITH_MORTGAGE
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # 50% * $12,998 = $6,499 (under cap)
    nj_staynj: 6_499

- name: Edge case 15, senior who neither owns nor rents is ineligible.
  period: 2026
  input:
    people:
      person1:
        age: 70
        employment_income: 50_000
        is_tax_unit_head: true
    tax_units:
      tax_unit:
        members: [person1]
        # No rent - defaults to 0
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_tenure_type: RENTER
    households:
      household:
        members: [person1]
        state_fips: 34
  output:
    # Not homeowner (no property taxes) and not renter (no rent paid)
    # Formula: is_homeowner = pays_taxes & ~pays_rent = false
    # Ineligible
    nj_staynj: 0
