- name: Adjusted gross income under reduction threshold, single
  period: 2022
  input:
    state_code: CT
    tax_unit_taxable_social_security: 12_000
    adjusted_gross_income: 74_999
    tax_unit_ss_combined_income_excess: 5_000
    tax_unit_social_security: 20_000
    filing_status: SINGLE
  output:
    ct_social_security_benefit_adjustment: 12_000

- name: Adjusted gross income under reduction threshold, joint
  period: 2022
  input:
    state_code: CT
    tax_unit_taxable_social_security: 12_000
    adjusted_gross_income: 99_999
    tax_unit_ss_combined_income_excess: 5_000
    tax_unit_social_security: 20_000
    filing_status: JOINT
  output:
    ct_social_security_benefit_adjustment: 12_000

- name: Adjusted gross income at reduction threshold, joint
  period: 2022
  input:
    state_code: CT
    tax_unit_taxable_social_security: 12_000
    adjusted_gross_income: 100_000
    tax_unit_ss_combined_income_excess: 5_000
    tax_unit_social_security: 15_000
    filing_status: JOINT
  output:
    # Part C: min(15000, 5000) = 5000
    # Part D: 5000 * 0.25 = 1250
    # Part E: 12000 (actual federal taxable SS, not 15000 * 0.85)
    # Part F: max(12000 - 1250, 0) = 10750
    ct_social_security_benefit_adjustment: 10_750

- name: Integration test
  absolute_error_margin: 0.01
  period: 2021
  input:
    people:
      person1:
        age: 64
        employment_income: 43_010
        taxable_interest_income: 11_010
        taxable_private_pension_income: 11_000
        social_security_retirement: 15_000
    households:
      household:
        members: [person1]
        state_fips: 9  # CT
  output:  # expected results from patched TAXSIM35 2024-02-15 version
    ct_social_security_benefit_adjustment: 9_000

# Test case from GitHub issue #7019 - verifies fix for using actual federal
# taxable SS instead of 85% of gross SS
- name: CT SS adjustment uses actual federal taxable SS (issue 7019)
  period: 2024
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 75
        social_security_retirement: 46_718.91
        taxable_private_pension_income: 28_475.02
        is_tax_unit_head: true
      person2:
        age: 75
        social_security_retirement: 46_718.91
        taxable_private_pension_income: 28_475.02
        is_tax_unit_spouse: true
    tax_units:
      tax_unit:
        members: [person1, person2]
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_fips: 9
  output:
    ct_social_security_benefit_adjustment: 38_802
    ct_agi: 43_544
    ct_income_tax: 332
