# Unit tests for Alabama TANF benefit amount
# Reference: https://dhr.alabama.gov/wp-content/uploads/2022/04/Appendix-N-Sec-2-Public-Assistance-Payment-Manual.pdf#page=37
# Benefit = max(payment_standard - countable_income, 0)
# Payment standards: $264 (1), $304 (2), $344 (3), $392 (4), $440 (5), $488 (6), etc.

- name: Case 1, no income - full benefit.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    # Family of 2: payment standard = $304
    # Countable income: $0
    # Benefit: $304 - $0 = $304
    al_tanf: 304

- name: Case 2, partial benefit with earned income.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 2_400  # $200/month
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    # Monthly employment: $200
    # Work expense deduction (20%): $200 * 0.20 = $40
    # Countable earned: $200 - $40 = $160
    # Payment standard (2 persons): $304
    # Benefit: $304 - $160 = $144
    al_tanf: 144

- name: Case 3, income exceeds threshold - zero benefit.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 12_000  # $1,000/month
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    # Monthly employment: $1,000
    # Work expense deduction (20%): $1,000 * 0.20 = $200
    # Countable earned: $1,000 - $200 = $800
    # Payment standard (2 persons): $304
    # Ineligible: countable > payment standard
    # Benefit: $0
    al_tanf: 0

- name: Case 4, family of 3 with partial benefit.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 3_000  # $250/month
      person2:
        age: 5
      person3:
        age: 3
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: AL
  output:
    # Monthly employment: $250
    # Work expense deduction (20%): $250 * 0.20 = $50
    # Countable earned: $250 - $50 = $200
    # Payment standard (3 persons): $344
    # Benefit: $344 - $200 = $144
    al_tanf: 144

- name: Case 5, family of 4 full benefit.
  period: 2024-01
  input:
    people:
      person1:
        age: 35
      person2:
        age: 32
      person3:
        age: 10
      person4:
        age: 7
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4]
    households:
      household:
        members: [person1, person2, person3, person4]
        state_code: AL
  output:
    # No income
    # Payment standard (4 persons): $392
    # Benefit: $392
    al_tanf: 392

- name: Case 6, family of 5 partial benefit.
  period: 2024-01
  input:
    people:
      person1:
        age: 35
        employment_income_before_lsr: 3_600  # $300/month
      person2:
        age: 32
      person3:
        age: 10
      person4:
        age: 7
      person5:
        age: 3
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5]
    households:
      household:
        members: [person1, person2, person3, person4, person5]
        state_code: AL
  output:
    # Monthly employment: $300
    # Work expense deduction (20%): $300 * 0.20 = $60
    # Countable earned: $300 - $60 = $240
    # Payment standard (5 persons): $440
    # Benefit: $440 - $240 = $200
    al_tanf: 200

- name: Case 7, self-employment income.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        self_employment_income_before_lsr: 3_600  # $300/month
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    # Monthly self-employment: $300
    # Work expense deduction (20%): $300 * 0.20 = $60
    # Countable earned: $300 - $60 = $240
    # Payment standard (2 persons): $304
    # Benefit: $304 - $240 = $64
    al_tanf: 64

- name: Case 8, unearned income.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        child_support_received: 2_400  # $200/month
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    # Unearned (child support): $200/month
    # No deductions on unearned income
    # Countable income: $200
    # Payment standard (2 persons): $304
    # Benefit: $304 - $200 = $104
    al_tanf: 104

- name: Case 9, childcare expense deduction.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 6_000  # $500/month
      person2:
        age: 3
    spm_units:
      spm_unit:
        members: [person1, person2]
        childcare_expenses: 3_600  # $300/month
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    # Monthly employment: $500
    # Work expense deduction (20%): $500 * 0.20 = $100
    # After work expense: $400
    # Childcare deduction: $300
    # Countable earned: max($400 - $300, 0) = $100
    # Payment standard (2 persons): $304
    # Benefit: $304 - $100 = $204
    al_tanf: 204

- name: Case 10, single pregnant person full benefit.
  period: 2024-01
  input:
    people:
      person1:
        age: 25
        is_pregnant: true
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: AL
  output:
    # No income
    # Payment standard (1 person): $264
    # Benefit: $264
    al_tanf: 264

# ============================================================================
# Edge Case Tests
# ============================================================================

- name: Edge Case 1, childcare enabling larger benefit.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 5_400  # $450/month
      person2:
        age: 3
    spm_units:
      spm_unit:
        members: [person1, person2]
        childcare_expenses: 2_400  # $200/month
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    # Monthly employment: $450
    # Work expense deduction (20%): $450 * 0.20 = $90
    # After work expense: $450 - $90 = $360
    # Childcare deduction: $200
    # Countable earned: max($360 - $200, 0) = $160
    # Payment standard (2 persons): $304
    # Benefit: $304 - $160 = $144
    al_tanf: 144

- name: Edge Case 2, eligible with zero benefit.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 4_560  # $380/month
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    # Family of 2: payment standard = $304
    # Monthly employment: $380
    # Work expense deduction (20%): $380 * 0.20 = $76
    # Countable earned: $380 - $76 = $304
    # Countable income: $304
    # $304 <= $304, eligible (tests <= boundary)
    # Benefit: $304 - $304 = $0
    al_tanf: 0
