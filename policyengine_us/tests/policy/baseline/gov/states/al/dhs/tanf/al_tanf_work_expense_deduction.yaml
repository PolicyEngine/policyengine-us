# Unit tests for Alabama TANF work expense deduction
# Reference: https://dhr.alabama.gov/wp-content/uploads/2022/04/Appendix-N-Sec-2-Public-Assistance-Payment-Manual.pdf#page=30
# Work expense deduction is 20% of earned income (after 40% self-employment deduction)

- name: Case 1, no earned income.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income: 0
        self_employment_income: 0
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    al_tanf_work_expense_deduction: 0

- name: Case 2, employment income only.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income: 12_000  # $1,000/month
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    # Monthly employment income: $1,000
    # Work expense deduction: $1,000 * 0.20 = $200
    al_tanf_work_expense_deduction: 200

- name: Case 3, self-employment income only.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        self_employment_income: 12_000  # $1,000/month gross
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    # Monthly self-employment income: $1,000
    # Self-employment deduction (40%): $1,000 * 0.40 = $400
    # Net self-employment: $1,000 - $400 = $600
    # Work expense deduction: $600 * 0.20 = $120
    al_tanf_work_expense_deduction: 120

- name: Case 4, combined employment and self-employment.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        employment_income: 6_000  # $500/month
        self_employment_income: 6_000  # $500/month gross
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    # Monthly employment income: $500
    # Monthly self-employment gross: $500
    # Self-employment deduction (40%): $500 * 0.40 = $200
    # Net self-employment: $500 - $200 = $300
    # Total earned: $500 + $300 = $800
    # Work expense deduction: $800 * 0.20 = $160
    al_tanf_work_expense_deduction: 160

- name: Case 5, low self-employment income.
  period: 2024-01
  input:
    people:
      person1:
        age: 30
        self_employment_income: 1_200  # $100/month gross
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: AL
  output:
    # Monthly self-employment gross: $100
    # Self-employment deduction (40%): $100 * 0.40 = $40
    # Net self-employment: $100 - $40 = $60
    # Work expense deduction: $60 * 0.20 = $12
    al_tanf_work_expense_deduction: 12

- name: Case 6, two earners in household.
  period: 2024-01
  input:
    people:
      person1:
        age: 35
        employment_income: 12_000  # $1,000/month
      person2:
        age: 32
        employment_income: 6_000  # $500/month
      person3:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: AL
  output:
    # Person1 monthly income: $1,000
    # Person2 monthly income: $500
    # Total monthly earned: $1,500
    # Work expense deduction: $1,500 * 0.20 = $300
    al_tanf_work_expense_deduction: 300
