# Texas LIHEAP Integration Tests
# Based on official documentation from TDHCA (Texas Department of Housing and Community Affairs)
# Income limits effective January 27, 2025
# Tests comprehensive benefit calculation scenarios

- name: Single person household - very low income eligible
  period: 2025-02
  input:
    people:
      person1:
        age: 45
        employment_income: 12_000  # $1,000/month, well below $1,956 limit
        is_disabled: false
    spm_units:
      spm_unit:
        members: [person1]
        utility_expense: 1_200  # Standard utility expense for testing
    households:
      household:
        members: [person1]
        state_code: TX
  output:
    # Income: $12,000/year = $1,000/month
    # FPL for 1 person: $15,650/year (2025)
    # Income as % of FPL: 12,000 / 15,650 = 76.7%
    # Well below 150% FPL threshold ($23,475)
    tx_liheap_income: 1_000
    tx_liheap_income_eligible: true
    tx_liheap_priority_group: false  # No priority characteristics
    tx_liheap_eligible: true
    # Benefit should be in range $200-$1,000 for base, higher for very low income
    tx_liheap_regular_benefit: 650

- name: Single elderly person - priority group
  period: 2025-02
  input:
    people:
      person1:
        age: 65  # Elderly (60+ is priority)
        social_security: 18_000
        employment_income: 0
    spm_units:
      spm_unit:
        members: [person1]
        utility_expense: 1_200  # Standard utility expense for testing
    households:
      household:
        members: [person1]
        state_code: TX
  output:
    # Income: $18,000/year = $1,500/month
    # Below 150% FPL limit of $23,475
    tx_liheap_income: 1_500
    tx_liheap_income_eligible: true
    tx_liheap_priority_group: true  # Elderly priority
    tx_liheap_eligible: true
    # Priority group gets higher benefit
    tx_liheap_regular_benefit: 750

- name: Family with young child - priority group
  period: 2025-02
  input:
    people:
      parent1:
        age: 30
        employment_income: 25_000
      parent2:
        age: 28
        employment_income: 10_000
      child1:
        age: 4  # Child under 6 is priority
    spm_units:
      spm_unit:
        members: [parent1, parent2, child1]
        utility_expense: 1_200  # Standard utility expense for testing
    households:
      household:
        members: [parent1, parent2, child1]
        state_code: TX
  output:
    # Income: $35,000/year = $2,917/month
    # Limit for 3: $39,975/year = $3,331/month
    # 35,000 / 39,975 = 87.6% of limit
    tx_liheap_income: 2_917
    tx_liheap_income_eligible: true
    tx_liheap_priority_group: true  # Child under 6
    tx_liheap_eligible: true
    # 3-person household with priority, moderate income
    tx_liheap_regular_benefit: 550

- name: Income exactly at 150% FPL threshold
  period: 2025-02
  input:
    people:
      person1:
        age: 40
        employment_income: 23_475  # Exactly at annual limit
    spm_units:
      spm_unit:
        members: [person1]
        utility_expense: 1_200  # Standard utility expense for testing
    households:
      household:
        members: [person1]
        state_code: TX
  output:
    tx_liheap_income: 1_956  # Monthly
    tx_liheap_income_eligible: true  # At threshold = eligible
    tx_liheap_eligible: true
    # At income limit, minimum benefit
    tx_liheap_regular_benefit: 200

- name: Income one dollar over threshold - ineligible
  period: 2025-02
  input:
    people:
      person1:
        age: 40
        employment_income: 23_476  # $1 over annual limit
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: TX
  output:
    tx_liheap_income: 1_956  # Rounds to same monthly
    tx_liheap_income_eligible: false  # Over threshold
    tx_liheap_eligible: false
    tx_liheap_regular_benefit: 0

- name: SNAP recipient - categorical eligibility
  period: 2025-02
  input:
    people:
      person1:
        age: 35
        employment_income: 28_000  # Over income limit
    spm_units:
      spm_unit:
        members: [person1]
        utility_expense: 1_200  # Standard utility expense for testing
        snap: 200  # Receives SNAP benefits
    households:
      household:
        members: [person1]
        state_code: TX
  output:
    tx_liheap_income: 2_333
    tx_liheap_income_eligible: false  # Over income limit
    tx_liheap_categorical_eligible: true  # SNAP recipient
    tx_liheap_eligible: true  # Categorically eligible
    # Categorical eligibility with higher income
    tx_liheap_regular_benefit: 250

- name: Large family of 6 - testing household size adjustment
  period: 2025-02
  input:
    people:
      parent1:
        age: 40
        employment_income: 35_000
      parent2:
        age: 38
        employment_income: 15_000
      child1:
        age: 12
      child2:
        age: 10
      child3:
        age: 8
      child4:
        age: 3  # Under 6 - priority
    spm_units:
      spm_unit:
        members: [parent1, parent2, child1, child2, child3, child4]
        utility_expense: 1_200  # Standard utility expense for testing
    households:
      household:
        members: [parent1, parent2, child1, child2, child3, child4]
        state_code: TX
  output:
    # Income: $50,000/year = $4,167/month
    # Limit for 6: $64,725/year = $5,394/month
    # 50,000 / 64,725 = 77.2% of limit
    tx_liheap_income: 4_167
    tx_liheap_income_eligible: true
    tx_liheap_priority_group: true  # Child under 6
    tx_liheap_eligible: true
    # Large household with priority, well under limit
    # SMI adjustment: 132% of baseline
    tx_liheap_regular_benefit: 850

- name: Disabled person with SSI - priority group and categorical
  period: 2025-02
  input:
    people:
      person1:
        age: 50
        is_disabled: true
        ssi: 11_000  # SSI income
        employment_income: 0
    spm_units:
      spm_unit:
        members: [person1]
        utility_expense: 1_200  # Standard utility expense for testing
    households:
      household:
        members: [person1]
        state_code: TX
  output:
    tx_liheap_income: 917  # Monthly
    tx_liheap_income_eligible: true
    tx_liheap_categorical_eligible: true  # SSI recipient
    tx_liheap_priority_group: true  # Disabled
    tx_liheap_eligible: true
    # Very low income, disabled, SSI - maximum support
    tx_liheap_regular_benefit: 900

- name: Two person household - moderate income
  period: 2025-02
  input:
    people:
      person1:
        age: 35
        employment_income: 20_000
      person2:
        age: 33
        employment_income: 8_000
    spm_units:
      spm_unit:
        members: [person1, person2]
        utility_expense: 1_200  # Standard utility expense for testing
    households:
      household:
        members: [person1, person2]
        state_code: TX
  output:
    # Income: $28,000/year = $2,333/month
    # Limit for 2: $31,725/year = $2,644/month
    # 28,000 / 31,725 = 88.3% of limit
    tx_liheap_income: 2_333
    tx_liheap_income_eligible: true
    tx_liheap_priority_group: false
    tx_liheap_eligible: true
    # 2-person household, no priority, moderate income
    # SMI adjustment: 68% of baseline
    tx_liheap_regular_benefit: 400

- name: Household size 8 - testing large household
  period: 2025-02
  input:
    people:
      adult1:
        age: 45
        employment_income: 30_000
      adult2:
        age: 43
        employment_income: 25_000
      adult3:
        age: 70  # Elderly - priority
        social_security: 15_000
      child1:
        age: 16
      child2:
        age: 14
      child3:
        age: 12
      child4:
        age: 10
      child5:
        age: 8
    spm_units:
      spm_unit:
        members: [adult1, adult2, adult3, child1, child2, child3, child4, child5]
        utility_expense: 1_200  # Standard utility expense for testing
    households:
      household:
        members: [adult1, adult2, adult3, child1, child2, child3, child4, child5]
        state_code: TX
  output:
    # Income: $70,000/year = $5,833/month
    # Limit for 8: $81,225/year = $6,769/month
    # 70,000 / 81,225 = 86.2% of limit
    tx_liheap_income: 5_833
    tx_liheap_income_eligible: true
    tx_liheap_priority_group: true  # Elderly member
    tx_liheap_eligible: true
    # Very large household with priority
    tx_liheap_regular_benefit: 950

- name: TANF recipient family - categorical eligibility
  period: 2025-02
  input:
    people:
      parent1:
        age: 32
        employment_income: 18_000
      child1:
        age: 8
      child2:
        age: 5  # Under 6 - priority
    spm_units:
      spm_unit:
        members: [parent1, child1, child2]
        utility_expense: 1_200  # Standard utility expense for testing
        tanf: 300  # Receives TANF
    households:
      household:
        members: [parent1, child1, child2]
        state_code: TX
  output:
    tx_liheap_income: 1_500
    tx_liheap_income_eligible: true
    tx_liheap_categorical_eligible: true  # TANF recipient
    tx_liheap_priority_group: true  # Child under 6
    tx_liheap_eligible: true
    # Low income, TANF, priority group
    tx_liheap_regular_benefit: 700

- name: Mixed income sources - comprehensive test
  period: 2025-02
  input:
    people:
      person1:
        age: 62  # Elderly priority
        employment_income: 8_000
        self_employment_income: 4_000
        social_security: 10_000
    spm_units:
      spm_unit:
        members: [person1]
        utility_expense: 1_200  # Standard utility expense for testing
    households:
      household:
        members: [person1]
        state_code: TX
  output:
    # Total income: $22,000/year = $1,833/month
    # Below limit of $23,475
    tx_liheap_income: 1_833
    tx_liheap_income_eligible: true
    tx_liheap_priority_group: true  # Elderly
    tx_liheap_eligible: true
    tx_liheap_regular_benefit: 600

- name: Zero income household - maximum benefit
  period: 2025-02
  input:
    people:
      person1:
        age: 40
        employment_income: 0
    spm_units:
      spm_unit:
        members: [person1]
        utility_expense: 1_200  # Standard utility expense for testing
    households:
      household:
        members: [person1]
        state_code: TX
  output:
    tx_liheap_income: 0
    tx_liheap_income_eligible: true  # Zero income is eligible
    tx_liheap_eligible: true
    # Zero income gets maximum base benefit
    tx_liheap_regular_benefit: 1_000

- name: Crisis assistance scenario - high benefit
  period: 2025-02
  input:
    people:
      parent1:
        age: 35
        employment_income: 20_000
        is_disabled: true  # Priority
      child1:
        age: 2  # Priority - under 6
    spm_units:
      spm_unit:
        members: [parent1, child1]
        utility_expense: 1_200  # Standard utility expense for testing
    households:
      household:
        members: [parent1, child1]
        state_code: TX
  output:
    tx_liheap_income: 1_667
    tx_liheap_income_eligible: true
    tx_liheap_priority_group: true  # Both disabled and child under 6
    tx_liheap_eligible: true
    # Multiple priority factors, low income
    tx_liheap_regular_benefit: 800
    # Crisis assistance would be additional (up to $2,400)
    # but requires specific crisis situation variable

- name: High income household - ineligible
  period: 2025-02
  input:
    people:
      person1:
        age: 40
        employment_income: 50_000  # Well over limit
      person2:
        age: 38
        employment_income: 40_000
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: TX
  output:
    tx_liheap_income: 7_500  # $90k annual / 12
    tx_liheap_income_eligible: false
    tx_liheap_categorical_eligible: false
    tx_liheap_eligible: false
    tx_liheap_regular_benefit: 0
