# Unit tests for Oklahoma TANF countable income calculation
# OAC 340:10-3-31.1, OAC 340:10-3-33
# Formula: Countable Income = (Gross Earned - $120 Work Expense) * 0.50 + Gross Unearned
# Work expense: $120 (applicant rate - default for simplified implementation)
# https://oklahoma.gov/okdhs/library/policy/current/oac-340/chapter-10/subchapter-3/parts-3/earned-income-disregard.html

- name: No income results in zero countable income
  period: 2024-01
  input:
    people:
      person1:
        employment_income_before_lsr: 0
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: OK
  output:
    # (0 - 120) * 0.50 = max(0, -120) * 0.50 = 0
    ok_tanf_countable_income: 0

- name: Earnings only - $500 monthly
  period: 2024-01
  input:
    people:
      person1:
        employment_income_before_lsr: 6_000  # $500/month
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: OK
  output:
    # Gross earned: $500
    # After work expense: $500 - $120 = $380
    # 50% disregard: $380 * 0.50 = $190
    ok_tanf_countable_income: 190

- name: Earnings below work expense deduction
  period: 2024-01
  input:
    people:
      person1:
        employment_income_before_lsr: 1_200  # $100/month
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: OK
  output:
    # Gross earned: $100
    # After work expense: max($100 - $120, 0) = $0
    # 50% disregard: $0 * 0.50 = $0
    ok_tanf_countable_income: 0

- name: Unearned income only (counted at full amount)
  period: 2024-01
  input:
    people:
      person1:
        pension_income: 3_600  # $300/month
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: OK
  output:
    # No earned income, unearned at full: $300
    ok_tanf_countable_income: 300

- name: Combined earned and unearned income
  period: 2024-01
  input:
    people:
      person1:
        employment_income_before_lsr: 7_200  # $600/month
        pension_income: 2_400  # $200/month
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: OK
  output:
    # Gross earned: $600
    # After work expense: $600 - $120 = $480
    # 50% disregard: $480 * 0.50 = $240
    # Add unearned: $240 + $200 = $440
    ok_tanf_countable_income: 440

- name: Higher earnings - $1000 monthly
  period: 2024-01
  input:
    people:
      person1:
        employment_income_before_lsr: 12_000  # $1,000/month
        pension_income: 1_200  # $100/month
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: OK
  output:
    # Gross earned: $1,000
    # After work expense: $1,000 - $120 = $880
    # 50% disregard: $880 * 0.50 = $440
    # Add unearned: $440 + $100 = $540
    ok_tanf_countable_income: 540

- name: Edge case - earnings exactly equal to work expense
  period: 2024-01
  input:
    people:
      person1:
        employment_income_before_lsr: 1_440  # $120/month
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: OK
  output:
    # Gross earned: $120
    # After work expense: $120 - $120 = $0
    # 50% disregard: $0 * 0.50 = $0
    ok_tanf_countable_income: 0

- name: Documentation example - $700 earnings
  period: 2024-01
  input:
    people:
      person1:
        employment_income_before_lsr: 8_400  # $700/month
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: OK
  output:
    # Gross earned: $700
    # After work expense: $700 - $120 = $580
    # 50% disregard: $580 * 0.50 = $290
    ok_tanf_countable_income: 290
