# Unit tests for Oklahoma TANF dependent care deduction
# OAC 340:10-3-33(b): $200 for under age 2, $175 for age 2+
# https://www.law.cornell.edu/regulations/oklahoma/OAC-340-10-3-33
# NOTE: childcare_expenses is annual, so multiply monthly amount by 12

- name: No childcare expenses - no deduction
  period: 2024-01
  input:
    people:
      child:
        age: 1
        is_tax_unit_dependent: true
    spm_units:
      spm_unit:
        members: [child]
        childcare_expenses: 0
    households:
      household:
        members: [child]
        state_code: OK
  output:
    ok_tanf_dependent_care_deduction: 0

- name: Child under 2 - max $200 deduction
  period: 2024-01
  input:
    people:
      child:
        age: 1
        is_tax_unit_dependent: true
    spm_units:
      spm_unit:
        members: [child]
        childcare_expenses: 300 * 12  # $300/month annual
    households:
      household:
        members: [child]
        state_code: OK
  output:
    # Max deduction for child under 2 is $200/month
    # Expenses ($300/mo) > max ($200), so deduction = $200
    ok_tanf_dependent_care_deduction: 200

- name: Child age 2+ - max $175 deduction
  period: 2024-01
  input:
    people:
      child:
        age: 3
        is_tax_unit_dependent: true
    spm_units:
      spm_unit:
        members: [child]
        childcare_expenses: 300 * 12  # $300/month annual
    households:
      household:
        members: [child]
        state_code: OK
  output:
    # Max deduction for child age 2+ is $175/month
    # Expenses ($300/mo) > max ($175), so deduction = $175
    ok_tanf_dependent_care_deduction: 175

- name: Expenses less than max - deduct actual expenses
  period: 2024-01
  input:
    people:
      child:
        age: 1
        is_tax_unit_dependent: true
    spm_units:
      spm_unit:
        members: [child]
        childcare_expenses: 150 * 12  # $150/month annual
    households:
      household:
        members: [child]
        state_code: OK
  output:
    # Max deduction for child under 2 is $200/month
    # Expenses ($150/mo) < max ($200), so deduction = $150
    ok_tanf_dependent_care_deduction: 150

- name: Two children - combined deduction
  period: 2024-01
  input:
    people:
      adult:
        age: 30
      child1:
        age: 1
        is_tax_unit_dependent: true
      child2:
        age: 4
        is_tax_unit_dependent: true
    spm_units:
      spm_unit:
        members: [adult, child1, child2]
        childcare_expenses: 500 * 12  # $500/month annual
    households:
      household:
        members: [adult, child1, child2]
        state_code: OK
  output:
    # Child1 (under 2): max $200
    # Child2 (age 2+): max $175
    # Total max: $375
    # Expenses ($500/mo) > max ($375), so deduction = $375
    ok_tanf_dependent_care_deduction: 375
