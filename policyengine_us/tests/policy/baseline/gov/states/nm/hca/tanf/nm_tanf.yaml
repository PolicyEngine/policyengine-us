# New Mexico Works (TANF) Benefit Amount Unit Tests
# Tests the final benefit calculation
# Source: 8.102.620 NMAC - Benefit Determination
# Formula: Benefit = Payment Standard - Net Countable Income

- name: Case 1, ineligible receives zero benefit.
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: false
    nm_tanf_maximum_benefit: 439
    nm_tanf_countable_income: 0
  output:
    nm_tanf: 0

- name: Case 2, eligible with no countable income gets full payment standard.
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 439
    nm_tanf_countable_income: 0
  output:
    # $439 - $0 = $439
    nm_tanf: 439

- name: Case 3, eligible with countable income below payment standard.
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 549
    nm_tanf_countable_income: 300
  output:
    # $549 - $300 = $249
    nm_tanf: 249

- name: Case 4, eligible with countable income exactly at payment standard.
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 663
    nm_tanf_countable_income: 663
  output:
    # $663 - $663 = $0
    nm_tanf: 0

- name: Case 5, eligible with countable income exceeds payment standard (edge case).
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 439
    nm_tanf_countable_income: 500
  output:
    # $439 - $500 = -$61, but capped at $0
    nm_tanf: 0

- name: Case 6, larger family with higher payment standard.
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 775  # Size 5
    nm_tanf_countable_income: 400
  output:
    # $775 - $400 = $375
    nm_tanf: 375

- name: Case 7, single person household with small benefit.
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 327  # Size 1
    nm_tanf_countable_income: 250
  output:
    # $327 - $250 = $77
    nm_tanf: 77

# Edge Cases: Benefit floor and boundary scenarios

- name: Case 8, benefit exactly one dollar.
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 439
    nm_tanf_countable_income: 438
  output:
    # $439 - $438 = $1
    nm_tanf: 1

- name: Case 9, benefit exactly one cent (fractional benefit).
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 439
    nm_tanf_countable_income: 438.99
  output:
    # $439 - $438.99 = $0.01
    nm_tanf: 0.01

- name: Case 10, countable income one dollar above payment standard.
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 439
    nm_tanf_countable_income: 440
  output:
    # $439 - $440 = -$1, capped at $0
    nm_tanf: 0

- name: Case 11, countable income significantly exceeds payment standard.
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 327
    nm_tanf_countable_income: 1_000
  output:
    # $327 - $1,000 = -$673, capped at $0
    nm_tanf: 0

- name: Case 12, maximum household size 19 with full benefit.
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 2_355  # Size 19 maximum
    nm_tanf_countable_income: 0
  output:
    # $2,355 - $0 = $2,355
    nm_tanf: 2_355

- name: Case 13, maximum household size with partial benefit.
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 2_355  # Size 19 maximum
    nm_tanf_countable_income: 1_500
  output:
    # $2,355 - $1,500 = $855
    nm_tanf: 855

- name: Case 14, very small countable income.
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 439
    nm_tanf_countable_income: 0.01
  output:
    # $439 - $0.01 = $438.99
    nm_tanf: 438.99

- name: Case 15, zero payment standard (edge case).
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 0
    nm_tanf_countable_income: 0
  output:
    # $0 - $0 = $0
    nm_tanf: 0

- name: Case 16, negative countable income should not happen but handle gracefully.
  period: 2024-01
  input:
    state_code: NM
    nm_tanf_eligible: true
    nm_tanf_maximum_benefit: 439
    nm_tanf_countable_income: -100
  output:
    # $439 - (-$100) = $539
    # max_() ensures non-negative benefit but doesn't cap positive values
    nm_tanf: 539
