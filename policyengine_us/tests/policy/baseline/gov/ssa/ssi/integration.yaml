- name: SSI integration test
  period: 2023
  input:
    people:
      # Single person - eligible for SSI
      person1:
        age: 65
        is_disabled: true
        is_tax_unit_head: true
        ssi_earned_income: 0
        ssi_unearned_income: 0
      # Married couple - both eligible for SSI
      person2:
        age: 68
        is_disabled: true
        is_tax_unit_head: true
        ssi_earned_income: 0
        ssi_unearned_income: 0
      person3:
        age: 70
        is_disabled: true
        is_tax_unit_spouse: true
        ssi_earned_income: 0
        ssi_unearned_income: 0
      # Married couple - only one eligible for SSI
      person4:
        age: 72
        is_disabled: true
        is_tax_unit_head: true
        ssi_earned_income: 0
        ssi_unearned_income: 0
      person5:
        age: 50
        is_disabled: false
        is_tax_unit_spouse: true
        ssi_earned_income: 12000
        ssi_unearned_income: 0
    tax_units:
      tax_unit1:
        members: [person1]
      tax_unit2:
        members: [person2, person3]
      tax_unit3:
        members: [person4, person5]
    marital_units:
      marital_unit1:
        members: [person1]
      marital_unit2:
        members: [person2, person3]
      marital_unit3:
        members: [person4, person5]
  output:
    # Eligibility variables
    is_ssi_aged_blind_disabled: [true, true, true, true, false]
    is_ssi_eligible_individual: [true, true, false, true, false]
    
    # Joint claim status
    ssi_claim_is_joint: [false, true, true, false, false]

# Tests showing CORRECT SSI couple income handling per regulations
# These tests verify compliance with 20 CFR § 416.1163 which requires
# combining income BEFORE applying exclusions for eligible couples

- name: SSI eligible couple - income must be combined before exclusions
  period: 2024
  input:
    people:
      husband:
        age: 67
        employment_income: 1_560  # $130/month
      wife:
        age: 65
        employment_income: 0
    marital_units:
      unit:
        members: [husband, wife]
    tax_units:
      unit:
        members: [husband, wife]
    households:
      household:
        members: [husband, wife]
        state_code: CA
  output:
    # Per 20 CFR § 416.1163: "we combine the earned income of both members"
    # Step 1: Combine income: $1,560 (both see combined)
    # Step 2: Apply exclusions to COMBINED amount
    # Step 3: Calculate couple benefit
    # Step 4: Divide equally between spouses
    ssi_marital_earned_income: [1_560, 1_560]  # CORRECT per 20 CFR § 416.1163
    ssi_countable_income: [135, 135]
    ssi: [8_355, 8_355]

- name: SSI couple both earning - must combine then calculate
  period: 2024
  input:
    people:
      husband:
        age: 67
        employment_income: 780  # $65/month
      wife:
        age: 65
        employment_income: 780  # $65/month
    marital_units:
      unit:
        members: [husband, wife]
    tax_units:
      unit:
        members: [husband, wife]
    households:
      household:
        members: [husband, wife]
        state_code: CA
  output:
    # Per 20 CFR § 416.1163: "we combine the earned income of both members"
    # Total combined income = $780 + $780 = $1,560
    ssi_marital_earned_income: [1_560, 1_560]  # CORRECT: Combined per regulation
    ssi_countable_income: [135, 135]
    ssi: [8_355, 8_355]

- name: SSI couple with higher income - shows exclusion on combined amount
  period: 2024
  input:
    people:
      husband:
        age: 67
        employment_income: 3_000  # $250/month
      wife:
        age: 65
        employment_income: 0
    marital_units:
      unit:
        members: [husband, wife]
    tax_units:
      unit:
        members: [husband, wife]
    households:
      household:
        members: [husband, wife]
        state_code: CA
  output:
    # Per 20 CFR § 416.1163: "combine the earned income of both members"
    # Combined: $3,000
    # Apply exclusions to COMBINED $3,000
    # Each spouse gets half of couple's countable income
    ssi_marital_earned_income: [3_000, 3_000]  # CORRECT per regulation
    ssi_countable_income: [495, 495]
    ssi: [7_995, 7_995]
