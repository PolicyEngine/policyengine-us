# Unit tests for tob_revenue_medicare_hi
# Tests Medicare HI trust fund revenue allocation from SS benefit taxation
# Medicare HI receives revenue proportional to tier 2's share of total taxable SS

- name: No SS benefits - zero Medicare revenue
  period: 2024
  input:
    people:
      person1:
        age: 67
        social_security: 0
        employment_income: 100_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SINGLE
    households:
      household:
        members: [person1]
  output:
    tob_revenue_medicare_hi: 0

- name: Below threshold - zero Medicare revenue
  period: 2024
  input:
    people:
      person1:
        age: 67
        social_security: 20_000
        employment_income: 10_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SINGLE
    households:
      household:
        members: [person1]
  output:
    # No taxable SS → no TOB revenue → no Medicare share
    tob_revenue_medicare_hi: 0

- name: Tier 1 only - zero Medicare revenue
  period: 2024
  input:
    people:
      person1:
        age: 67
        social_security: 20_000
        employment_income: 20_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SINGLE
    households:
      household:
        members: [person1]
  output:
    # In tier 1 only: tier2 = $0 → 0% to Medicare
    tob_revenue_medicare_hi: 0

- name: In tier 2 - proportional split
  period: 2024
  absolute_error_margin: 100
  input:
    people:
      person1:
        age: 67
        social_security: 30_000
        employment_income: 50_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SINGLE
    households:
      household:
        members: [person1]
  output:
    # Tier 1 = $4,500, Tier 2 = $21,000, Total = $25,500
    # Medicare share = 21,000 / 25,500 = 82.4%
    # Total TOB ~$4,240 → Medicare = $4,240 * 0.824 = ~$3,492
    tob_revenue_medicare_hi: 3_492

- name: Joint filers in tier 2
  period: 2024
  absolute_error_margin: 200
  input:
    people:
      person1:
        age: 67
        social_security: 40_000
        employment_income: 60_000
      person2:
        age: 65
    tax_units:
      tax_unit:
        members: [person1, person2]
        filing_status: JOINT
    households:
      household:
        members: [person1, person2]
  output:
    # Tier 1 = $6,000, Tier 2 = $28,000, Total = $34,000
    # Medicare share = 28,000 / 34,000 = 82.4%
    taxable_social_security_tier_1: 6_000
    taxable_social_security_tier_2: 28_000
