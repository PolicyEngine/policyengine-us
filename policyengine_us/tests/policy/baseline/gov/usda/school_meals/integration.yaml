- name: No income, one parent, one child, contiguous_US
  period: 2022
  absolute_error_margin: 0.01 # Floating point issue.
  input:
    people:
      parent: {}
      child:
        is_in_k12_school: true
    spm_units:
      spm_unit:
        members: [parent, child]
        school_meal_fpg_ratio: 0
        snap: 0
    households:
      household:
        state_group: CONTIGUOUS_US
  output:
    school_meal_daily_subsidy: 3.66 + 1.97
    school_meal_paid_daily_subsidy: 0.35 + 0.33
    school_meal_net_subsidy: 180 * ((3.66 + 1.97) - (0.35 + 0.33))
    free_school_meals: 180 * (3.66 + 1.97 - 0.35 - 0.33)
    reduced_price_school_meals: 0

# 2024 Integration Tests - Contiguous US
- name: Low income family with two children - Contiguous US 2024 FREE tier
  period: 2024
  absolute_error_margin: 0.01
  input:
    people:
      parent1:
        employment_income: 20_000
      parent2:
        employment_income: 8_000
      child1:
        age: 8
        is_in_k12_school: true
      child2:
        age: 12
        is_in_k12_school: true
    spm_units:
      spm_unit:
        members: [parent1, parent2, child1, child2]
        school_meal_fpg_ratio: 0.8  # Below 1.30 threshold for free meals
        snap: 0
    households:
      household:
        members: [parent1, parent2, child1, child2]
        state_code: TX
  output:
    school_meal_tier: FREE
    school_meal_daily_subsidy: 6.53  # 4.25 + 2.28 (2023 rates active on Jan 1, 2024)
    school_meal_paid_daily_subsidy: 0.78  # 0.40 + 0.38 (2023 rates)
    school_meal_net_subsidy: 2 * 180 * (6.53 - 0.78)  # Two children
    free_school_meals: 2 * 180 * (6.53 - 0.78)  # 2,070
    reduced_price_school_meals: 0

- name: Moderate income family - Contiguous US 2024 REDUCED tier
  period: 2024
  absolute_error_margin: 0.01
  input:
    people:
      parent:
        employment_income: 40_000
      child:
        age: 10
        is_in_k12_school: true
    spm_units:
      spm_unit:
        members: [parent, child]
        school_meal_fpg_ratio: 1.6  # Between 1.30 and 1.85 for reduced
        snap: 0
    households:
      household:
        members: [parent, child]
        state_code: CA
  output:
    school_meal_tier: REDUCED
    school_meal_daily_subsidy: 5.83  # 3.85 + 1.98 (2023 rates active on Jan 1, 2024)
    school_meal_paid_daily_subsidy: 0.78  # 0.40 + 0.38 (2023 rates)
    school_meal_net_subsidy: 180 * (5.83 - 0.78)
    free_school_meals: 0
    reduced_price_school_meals: 180 * (5.83 - 0.78)  # 909

# 2025 Integration Tests - Contiguous US
- name: Categorical eligibility via SNAP - Contiguous US 2025 FREE tier
  period: 2025
  absolute_error_margin: 0.01
  input:
    people:
      parent:
        employment_income: 50_000  # Income would normally be PAID tier
      child1:
        age: 7
        is_in_k12_school: true
      child2:
        age: 14
        is_in_k12_school: true
    spm_units:
      spm_unit:
        members: [parent, child1, child2]
        school_meal_fpg_ratio: 2.5  # Above 1.85 threshold
        snap: 200  # Receives SNAP - categorical eligibility
    households:
      household:
        members: [parent, child1, child2]
        state_code: NY
  output:
    meets_school_meal_categorical_eligibility: true
    school_meal_tier: FREE
    school_meal_daily_subsidy: 7.06  # 4.60 + 2.46
    school_meal_paid_daily_subsidy: 0.86  # 0.46 + 0.40
    school_meal_net_subsidy: 2 * 180 * (7.06 - 0.86)
    free_school_meals: 2 * 180 * (7.06 - 0.86)  # 2,232
    reduced_price_school_meals: 0

# Alaska Integration Tests 2024
- name: Low income single parent - Alaska 2024 FREE tier
  period: 2024
  absolute_error_margin: 0.01
  input:
    people:
      parent:
        employment_income: 25_000
      child:
        age: 9
        is_in_k12_school: true
    spm_units:
      spm_unit:
        members: [parent, child]
        school_meal_fpg_ratio: 1.0
        snap: 0
    households:
      household:
        members: [parent, child]
        state_code: AK
  output:
    school_meal_tier: FREE
    school_meal_daily_subsidy: 10.56  # 6.90 + 3.66 (2023 rates active on Jan 1, 2024)
    school_meal_paid_daily_subsidy: 1.24  # 0.66 + 0.58 (2023 rates)
    school_meal_net_subsidy: 180 * (10.56 - 1.24)
    free_school_meals: 180 * (10.56 - 1.24)  # 1,677.6

# Alaska Integration Tests 2025
- name: Family with three children - Alaska 2025 REDUCED tier
  period: 2025
  absolute_error_margin: 0.01
  input:
    people:
      parent1:
        employment_income: 45_000
      parent2:
        employment_income: 30_000
      child1:
        age: 6
        is_in_k12_school: true
      child2:
        age: 10
        is_in_k12_school: true
      child3:
        age: 15
        is_in_k12_school: true
    spm_units:
      spm_unit:
        members: [parent1, parent2, child1, child2, child3]
        school_meal_fpg_ratio: 1.7  # Between 1.30 and 1.85
        snap: 0
    households:
      household:
        members: [parent1, parent2, child1, child2, child3]
        state_code: AK
  output:
    school_meal_tier: REDUCED
    school_meal_daily_subsidy: 10.70  # 7.05 + 3.65
    school_meal_paid_daily_subsidy: 1.33  # 0.71 + 0.62
    school_meal_net_subsidy: 3 * 180 * (10.70 - 1.33)
    free_school_meals: 0
    reduced_price_school_meals: 3 * 180 * (10.70 - 1.33)  # 5,059.8

# Hawaii Integration Tests 2024
- name: Two parent household - Hawaii 2024 PAID tier
  period: 2024
  absolute_error_margin: 0.01
  input:
    people:
      parent1:
        employment_income: 70_000
      parent2:
        employment_income: 60_000
      child:
        age: 11
        is_in_k12_school: true
    spm_units:
      spm_unit:
        members: [parent1, parent2, child]
        school_meal_fpg_ratio: 3.5  # Above 1.85 threshold
        snap: 0
    households:
      household:
        members: [parent1, parent2, child]
        state_code: HI
  output:
    school_meal_tier: PAID
    school_meal_daily_subsidy: 1.00  # 0.53 + 0.47 (2023 rates active on Jan 1, 2024)
    school_meal_paid_daily_subsidy: 1.00  # Same for PAID tier
    school_meal_net_subsidy: 0  # No subsidy for paid tier
    free_school_meals: 0
    reduced_price_school_meals: 0

# Hawaii Integration Tests 2025
- name: Single parent low income - Hawaii 2025 FREE tier
  period: 2025
  absolute_error_margin: 0.01
  input:
    people:
      parent:
        employment_income: 22_000
      child1:
        age: 5
        is_in_k12_school: true
      child2:
        age: 8
        is_in_k12_school: true
    spm_units:
      spm_unit:
        members: [parent, child1, child2]
        school_meal_fpg_ratio: 0.9
        snap: 0
    households:
      household:
        members: [parent, child1, child2]
        state_code: HI
  output:
    school_meal_tier: FREE
    school_meal_daily_subsidy: 9.16  # 5.98 + 3.18
    school_meal_paid_daily_subsidy: 1.08  # 0.57 + 0.51
    school_meal_net_subsidy: 2 * 180 * (9.16 - 1.08)
    free_school_meals: 2 * 180 * (9.16 - 1.08)  # 2,908.8

# Edge case - Different years' rates
- name: 2024 rates - Contiguous US
  period: 2024
  absolute_error_margin: 0.01
  input:
    people:
      parent: {}
      child:
        age: 10
        is_in_k12_school: true
    spm_units:
      spm_unit:
        members: [parent, child]
        school_meal_fpg_ratio: 1.2  # FREE tier
        snap: 0
    households:
      household:
        members: [parent, child]
        state_code: FL
  output:
    school_meal_tier: FREE
    school_meal_daily_subsidy: 6.53  # 4.25 + 2.28 (2023 rates active on Jan 1, 2024)

- name: 2025 new rates - Contiguous US
  period: 2025
  absolute_error_margin: 0.01
  input:
    people:
      parent: {}
      child:
        age: 10
        is_in_k12_school: true
    spm_units:
      spm_unit:
        members: [parent, child]
        school_meal_fpg_ratio: 1.2  # FREE tier
        snap: 0
    households:
      household:
        members: [parent, child]
        state_code: FL
  output:
    school_meal_tier: FREE
    school_meal_daily_subsidy: 7.06  # 4.60 + 2.46 (2025 rates)
