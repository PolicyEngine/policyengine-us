- name: Dependent care deduction with mixed eligible/ineligible household
  period: 2024
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 35
        immigration_status: CITIZEN
        employment_income: 2_000
      person2:
        age: 32
        immigration_status: UNDOCUMENTED
        employment_income: 1_500
      child1:
        age: 4
        immigration_status: CITIZEN
      child2:
        age: 6
        immigration_status: CITIZEN
    spm_units:
      spm_unit:
        members: [person1, person2, child1, child2]
        childcare_expenses: 600
    households:
      household:
        members: [person1, person2, child1, child2]
        state_code: CA
  output:
    # With 1 ineligible person in household of 4:
    # Prorate factor = 1 - (1/4)² = 1 - 0.0625 = 0.9375
    # Deduction = 600 * 0.9375 = 562.50
    snap_dependent_care_deduction: 562.50
    snap_applicable_share_of_expenses: 0.9375
    snap_ineligible_members_fraction: 0.25
    snap_unit_ineligible_people: 1

- name: Dependent care deduction with all eligible members
  period: 2024-01
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 35
        immigration_status: CITIZEN
        employment_income: 2_000
      person2:
        age: 32
        immigration_status: CITIZEN
        employment_income: 1_500
      child1:
        age: 4
        immigration_status: CITIZEN
      child2:
        age: 6
        immigration_status: CITIZEN
    spm_units:
      spm_unit:
        members: [person1, person2, child1, child2]
        childcare_expenses: 600 * 12  # $600/month childcare expenses
    households:
      household:
        members: [person1, person2, child1, child2]
        state_code: CA
  output:
    # All eligible - no proration
    snap_dependent_care_deduction: 600
    # Don't test YEAR variables in MONTH period as they get divided by 12
    # snap_applicable_share_of_expenses: 1.0  # Would return 0.0833
    # snap_ineligible_members_fraction: 0  # Would return 0
    # snap_unit_ineligible_people: 0  # Would return 0

- name: Dependent care deduction with two ineligible members
  period: 2024
  absolute_error_margin: 0.01
  input:
    people:
      person1:
        age: 35
        immigration_status: CITIZEN
        employment_income: 2_000
      person2:
        age: 32
        immigration_status: UNDOCUMENTED
        employment_income: 1_500
      person3:
        age: 60
        immigration_status: UNDOCUMENTED
        employment_income: 1_000
      child1:
        age: 4
        immigration_status: CITIZEN
    spm_units:
      spm_unit:
        members: [person1, person2, person3, child1]
        childcare_expenses: 800
    households:
      household:
        members: [person1, person2, person3, child1]
        state_code: CA
  output:
    # With 2 ineligible persons in household of 4:
    # Prorate factor = 1 - (2/4)² = 1 - 0.25 = 0.75
    # Deduction = 800 * 0.75 = 600
    snap_dependent_care_deduction: 600
    snap_applicable_share_of_expenses: 0.75
    snap_ineligible_members_fraction: 0.5
    snap_unit_ineligible_people: 2
